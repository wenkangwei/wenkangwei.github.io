<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>KKBox Music Recommendation System - Wenkang&#039;s Blog</title><meta description=""><meta property="og:type" content="article"><meta property="og:title" content="KKBox Music Recommendation System"><meta property="og:url" content="https://github.com/wenkangwei/"><meta property="og:site_name" content="Wenkang&#039;s Blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_38_1.png"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_39_1.png"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_41_1.png"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_44_1.png"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_56_1.png"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_60_0.png"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_62_0.png"><meta property="og:image" content="https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_63_0.png"><meta property="og:image" content="https://github.com/LianxinGao/kaggle/blob/master/pics/net.jpg?raw=true"><meta property="article:published_time" content="2020-12-01T20:13:14.000Z"><meta property="article:modified_time" content="2020-12-01T20:21:58.428Z"><meta property="article:author" content="Wenkang Wei"><meta property="article:tag" content="LGBM"><meta property="article:tag" content="Boosting Machine"><meta property="article:tag" content="Wide and Deep"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_38_1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/wenkangwei/wenkangwei.github.io%60/2020/12/01/kkboxmusicrecommendation-notebook-v4/"},"headline":"Wenkang's Blog","image":["https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_38_1.png","https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_39_1.png","https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_41_1.png","https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_44_1.png","https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_56_1.png","https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_60_0.png","https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_62_0.png","https://github.com/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_63_0.png"],"datePublished":"2020-12-01T20:13:14.000Z","dateModified":"2020-12-01T20:21:58.428Z","author":{"@type":"Person","name":"Wenkang Wei"},"description":""}</script><link rel="canonical" href="https://github.com/wenkangwei/wenkangwei.github.io%60/2020/12/01/kkboxmusicrecommendation-notebook-v4/"><link rel="icon" href="/images/icon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/icon.png" alt="Wenkang&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-12-01T20:13:14.000Z" title="2020-12-01T20:13:14.000Z">2020-12-01</time><span class="level-item"><a class="link-muted" href="/categories/Recommendation-System/">Recommendation System</a></span><span class="level-item">an hour read (About 12846 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">KKBox Music Recommendation System</h1><div class="content"><img src=https://miro.medium.com/max/2560/1*GMikfjbGYyPGDTYdJuMwhg.png>


<a id="more"></a>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> drive</span><br><span class="line">drive.mount(<span class="string">'/content/drive'</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install kaggle</span><br></pre></td></tr></table></figure>

<pre><code>Requirement already satisfied: kaggle in /usr/local/lib/python3.6/dist-packages (1.5.9)
Requirement already satisfied: python-slugify in /usr/local/lib/python3.6/dist-packages (from kaggle) (4.0.1)
Requirement already satisfied: python-dateutil in /usr/local/lib/python3.6/dist-packages (from kaggle) (2.8.1)
Requirement already satisfied: six&gt;=1.10 in /usr/local/lib/python3.6/dist-packages (from kaggle) (1.15.0)
Requirement already satisfied: certifi in /usr/local/lib/python3.6/dist-packages (from kaggle) (2020.11.8)
Requirement already satisfied: urllib3 in /usr/local/lib/python3.6/dist-packages (from kaggle) (1.24.3)
Requirement already satisfied: slugify in /usr/local/lib/python3.6/dist-packages (from kaggle) (0.0.1)
Requirement already satisfied: tqdm in /usr/local/lib/python3.6/dist-packages (from kaggle) (4.41.1)
Requirement already satisfied: requests in /usr/local/lib/python3.6/dist-packages (from kaggle) (2.23.0)
Requirement already satisfied: text-unidecode&gt;=1.3 in /usr/local/lib/python3.6/dist-packages (from python-slugify-&gt;kaggle) (1.3)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /usr/local/lib/python3.6/dist-packages (from requests-&gt;kaggle) (2.10)
Requirement already satisfied: chardet&lt;4,&gt;=3.0.2 in /usr/local/lib/python3.6/dist-packages (from requests-&gt;kaggle) (3.0.4)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!cp /content/drive/My\ Drive/Colab\ Notebooks/KKBox-MusicRecommendationSystem/kaggle.json .</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !!chmod 600 kaggle.json</span></span><br><span class="line">!mkdir -p ~/.kaggle</span><br><span class="line">!cp kaggle.json ~/.kaggle/</span><br><span class="line">!ls ~/.kaggle</span><br><span class="line">!mkdir -p ./kaggle/</span><br><span class="line">!chmod <span class="number">600</span> /root/.kaggle/kaggle.json</span><br><span class="line">!kaggle  competitions download kkbox-music-recommendation-challenge</span><br></pre></td></tr></table></figure>

<pre><code>kaggle.json
Warning: Looks like you&#39;re using an outdated API Version, please consider updating (server 1.5.9 / client 1.5.4)
song_extra_info.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
train.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
test.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
songs.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
members.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
sample_submission.csv.7z: Skipping, found more recently modified local copy (use --force to force download)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">!mkdir kaggle/working</span><br><span class="line">!mkdir kaggle/working/train</span><br><span class="line">!mkdir kaggle/working/train/data</span><br><span class="line">!apt-get install p7zip</span><br><span class="line">!apt-get install p7zip-full </span><br><span class="line">!<span class="number">7</span>za e members.csv<span class="number">.7</span>z </span><br><span class="line">!<span class="number">7</span>za e songs.csv<span class="number">.7</span>z </span><br><span class="line">!<span class="number">7</span>za e song_extra_info.csv<span class="number">.7</span>z </span><br><span class="line">!<span class="number">7</span>za e train.csv<span class="number">.7</span>z </span><br><span class="line">!<span class="number">7</span>za e sample_submission.csv<span class="number">.7</span>z </span><br><span class="line">!<span class="number">7</span>za e test.csv<span class="number">.7</span>z </span><br><span class="line">!mv *.csv kaggle/working/train/data</span><br></pre></td></tr></table></figure>

<pre><code>mkdir: cannot create directory ‘kaggle/working’: File exists
mkdir: cannot create directory ‘kaggle/working/train’: File exists
mkdir: cannot create directory ‘kaggle/working/train/data’: File exists
Reading package lists... Done
Building dependency tree       
Reading state information... Done
p7zip is already the newest version (16.02+dfsg-6).
0 upgraded, 0 newly installed, 0 to remove and 14 not upgraded.
Reading package lists... Done
Building dependency tree       
Reading state information... Done
p7zip-full is already the newest version (16.02+dfsg-6).
0 upgraded, 0 newly installed, 0 to remove and 14 not upgraded.

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7B12 (830F10),ASM,AES-NI)

Scanning the drive for archives:
  0M Scan         1 file, 1349856 bytes (1319 KiB)

Extracting archive: members.csv.7z
--
Path = members.csv.7z
Type = 7z
Physical Size = 1349856
Headers Size = 130
Method = LZMA2:3m
Solid = -
Blocks = 1

  0%    Everything is Ok

Size:       2503827
Compressed: 1349856

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7B12 (830F10),ASM,AES-NI)

Scanning the drive for archives:
  0M Scan         1 file, 105809525 bytes (101 MiB)

Extracting archive: songs.csv.7z
--
Path = songs.csv.7z
Type = 7z
Physical Size = 105809525
Headers Size = 122
Method = LZMA2:24
Solid = -
Blocks = 1

  0%      2% - songs.csv                  5% - songs.csv                  8% - songs.csv                 11% - songs.csv                 14% - songs.csv                 17% - songs.csv                 20% - songs.csv                 24% - songs.csv                 27% - songs.csv                 30% - songs.csv                 33% - songs.csv                 35% - songs.csv                 39% - songs.csv                 41% - songs.csv                 45% - songs.csv                 49% - songs.csv                 51% - songs.csv                 54% - songs.csv                 57% - songs.csv                 60% - songs.csv                 62% - songs.csv                 65% - songs.csv                 68% - songs.csv                 70% - songs.csv                 73% - songs.csv                 76% - songs.csv                 79% - songs.csv                 82% - songs.csv                 85% - songs.csv                 87% - songs.csv                 90% - songs.csv                 92% - songs.csv                 95% - songs.csv                 98% - songs.csv                Everything is Ok

Size:       221828666
Compressed: 105809525

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7B12 (830F10),ASM,AES-NI)

Scanning the drive for archives:
  0M Scan         1 file, 103608205 bytes (99 MiB)

Extracting archive: song_extra_info.csv.7z
--
Path = song_extra_info.csv.7z
Type = 7z
Physical Size = 103608205
Headers Size = 140
Method = LZMA:25
Solid = -
Blocks = 1

  0%      1% - song_extra_info.csv                            4% - song_extra_info.csv                            6% - song_extra_info.csv                            9% - song_extra_info.csv                           11% - song_extra_info.csv                           13% - song_extra_info.csv                           16% - song_extra_info.csv                           18% - song_extra_info.csv                           20% - song_extra_info.csv                           23% - song_extra_info.csv                           25% - song_extra_info.csv                           27% - song_extra_info.csv                           30% - song_extra_info.csv                           32% - song_extra_info.csv                           34% - song_extra_info.csv                           37% - song_extra_info.csv                           39% - song_extra_info.csv                           41% - song_extra_info.csv                           44% - song_extra_info.csv                           46% - song_extra_info.csv                           48% - song_extra_info.csv                           50% - song_extra_info.csv                           53% - song_extra_info.csv                           55% - song_extra_info.csv                           57% - song_extra_info.csv                           60% - song_extra_info.csv                           62% - song_extra_info.csv                           65% - song_extra_info.csv                           68% - song_extra_info.csv                           71% - song_extra_info.csv                           74% - song_extra_info.csv                           76% - song_extra_info.csv                           78% - song_extra_info.csv                           81% - song_extra_info.csv                           83% - song_extra_info.csv                           85% - song_extra_info.csv                           88% - song_extra_info.csv                           92% - song_extra_info.csv                           95% - song_extra_info.csv                           99% - song_extra_info.csv                          Everything is Ok

Size:       181010294
Compressed: 103608205

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7B12 (830F10),ASM,AES-NI)

Scanning the drive for archives:
  0M Scan         1 file, 106420688 bytes (102 MiB)

Extracting archive: train.csv.7z
--
Path = train.csv.7z
Type = 7z
Physical Size = 106420688
Headers Size = 122
Method = LZMA2:24
Solid = -
Blocks = 1

  0%      2% - train.csv                  4% - train.csv                  6% - train.csv                  9% - train.csv                 10% - train.csv                 13% - train.csv                 14% - train.csv                 17% - train.csv                 19% - train.csv                 21% - train.csv                 23% - train.csv                 25% - train.csv                 27% - train.csv                 29% - train.csv                 31% - train.csv                 33% - train.csv                 34% - train.csv                 36% - train.csv                 38% - train.csv                 41% - train.csv                 43% - train.csv                 46% - train.csv                 48% - train.csv                 50% - train.csv                 52% - train.csv                 54% - train.csv                 56% - train.csv                 58% - train.csv                 59% - train.csv                 62% - train.csv                 65% - train.csv                 68% - train.csv                 70% - train.csv                 73% - train.csv                 75% - train.csv                 76% - train.csv                 78% - train.csv                 80% - train.csv                 82% - train.csv                 84% - train.csv                 86% - train.csv                 88% - train.csv                 90% - train.csv                 91% - train.csv                 93% - train.csv                 95% - train.csv                 97% - train.csv                 99% - train.csv                Everything is Ok

Size:       971675848
Compressed: 106420688

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7B12 (830F10),ASM,AES-NI)

Scanning the drive for archives:
  0M Scan         1 file, 463688 bytes (453 KiB)

Extracting archive: sample_submission.csv.7z
--
Path = sample_submission.csv.7z
Type = 7z
Physical Size = 463688
Headers Size = 146
Method = LZMA2:24
Solid = -
Blocks = 1

  0%    Everything is Ok

Size:       29570380
Compressed: 463688

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7B12 (830F10),ASM,AES-NI)

Scanning the drive for archives:
  0M Scan         1 file, 43925208 bytes (42 MiB)

Extracting archive: test.csv.7z
--
Path = test.csv.7z
Type = 7z
Physical Size = 43925208
Headers Size = 122
Method = LZMA2:24
Solid = -
Blocks = 1

  0%      4% - test.csv                 8% - test.csv                13% - test.csv                18% - test.csv                22% - test.csv                28% - test.csv                34% - test.csv                42% - test.csv                49% - test.csv                55% - test.csv                61% - test.csv                67% - test.csv                74% - test.csv                80% - test.csv                86% - test.csv                90% - test.csv                96% - test.csv               Everything is Ok

Size:       347789925
Compressed: 43925208
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This Python 3 environment comes with many helpful analytics libraries installed</span></span><br><span class="line"><span class="comment"># It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python</span></span><br><span class="line"><span class="comment"># For example, here's several helpful packages to load</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment"># linear algebra</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment"># data processing, CSV file I/O (e.g. pd.read_csv)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Input data files are available in the read-only "../input/" directory</span></span><br><span class="line"><span class="comment"># For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">for</span> dirname, _, filenames <span class="keyword">in</span> os.walk(<span class="string">'./kaggle/input'</span>):</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        print(os.path.join(dirname, filename))</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using "Save &amp; Run All" </span></span><br><span class="line"><span class="comment"># You can also write temporary files to /kaggle/temp/, but they won't be saved outside of the current session</span></span><br></pre></td></tr></table></figure>

<h1 id="Use-7z-to-uncompress-the-csv-files"><a href="#Use-7z-to-uncompress-the-csv-files" class="headerlink" title="Use 7z to uncompress the csv files"></a>Use 7z to uncompress the csv files</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!ls ./kaggle/working/train/data/</span><br></pre></td></tr></table></figure>

<pre><code>members.csv           song_extra_info.csv  test.csv
sample_submission.csv  songs.csv        train.csv
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!du -h ./kaggle/working/train/data/</span><br></pre></td></tr></table></figure>

<pre><code>1.7G    ./kaggle/working/train/data/
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!cat /proc/cpuinfo</span><br></pre></td></tr></table></figure>

<pre><code>processor    : 0
vendor_id    : AuthenticAMD
cpu family    : 23
model        : 49
model name    : AMD EPYC 7B12
stepping    : 0
microcode    : 0x1000065
cpu MHz        : 2250.000
cache size    : 512 KB
physical id    : 0
siblings    : 2
core id        : 0
cpu cores    : 1
apicid        : 0
initial apicid    : 0
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid extd_apicid tsc_known_freq pni pclmulqdq ssse3 fma cx16 sse4_1 sse4_2 movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm cmp_legacy cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw topoext ssbd ibrs ibpb stibp vmmcall fsgsbase tsc_adjust bmi1 avx2 smep bmi2 rdseed adx smap clflushopt clwb sha_ni xsaveopt xsavec xgetbv1 clzero xsaveerptr arat npt nrip_save umip rdpid
bugs        : sysret_ss_attrs spectre_v1 spectre_v2 spec_store_bypass
bogomips    : 4500.00
TLB size    : 3072 4K pages
clflush size    : 64
cache_alignment    : 64
address sizes    : 48 bits physical, 48 bits virtual
power management:

processor    : 1
vendor_id    : AuthenticAMD
cpu family    : 23
model        : 49
model name    : AMD EPYC 7B12
stepping    : 0
microcode    : 0x1000065
cpu MHz        : 2250.000
cache size    : 512 KB
physical id    : 0
siblings    : 2
core id        : 0
cpu cores    : 1
apicid        : 1
initial apicid    : 1
fpu        : yes
fpu_exception    : yes
cpuid level    : 13
wp        : yes
flags        : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid extd_apicid tsc_known_freq pni pclmulqdq ssse3 fma cx16 sse4_1 sse4_2 movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm cmp_legacy cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw topoext ssbd ibrs ibpb stibp vmmcall fsgsbase tsc_adjust bmi1 avx2 smep bmi2 rdseed adx smap clflushopt clwb sha_ni xsaveopt xsavec xgetbv1 clzero xsaveerptr arat npt nrip_save umip rdpid
bugs        : sysret_ss_attrs spectre_v1 spectre_v2 spec_store_bypass
bogomips    : 4500.00
TLB size    : 3072 4K pages
clflush size    : 64
cache_alignment    : 64
address sizes    : 48 bits physical, 48 bits virtual
power management:
</code></pre>
<h1 id="KKBox-Music-Recommendation-System"><a href="#KKBox-Music-Recommendation-System" class="headerlink" title="KKBox-Music Recommendation System"></a>KKBox-Music Recommendation System</h1><h2 id="Goal-of-this-project"><a href="#Goal-of-this-project" class="headerlink" title="Goal of this project"></a>Goal of this project</h2><p>In this project, we are going to build a recommendation system to predict the chances of a user listening to a song repetitively after the first observable listening event within a time window was triggered. If there are recurring listening event(s) triggered within a month after the user’s very first observable listening event, its target is marked 1, and 0 otherwise in the training set. The same rule applies to the testing set.</p>
<h2 id="0-Data-Collection-and-Description"><a href="#0-Data-Collection-and-Description" class="headerlink" title="0. Data Collection and Description"></a>0. Data Collection and Description</h2><p>The KKBox dataset is composed of following files:</p>
<ol>
<li><p>train.csv</p>
<ul>
<li>msno: user id</li>
<li>song_id: song id</li>
<li>source_system_tab: the name of the tab where the event was triggered. System tabs are used to categorize KKBOX mobile apps functions. For example, tab my library contains functions to manipulate the local storage, and tab search contains functions relating to search.</li>
<li>source_screen_name: name of the layout a user sees.</li>
<li>source_type: an entry point a user first plays music on mobile apps. An entry point could be album, online-playlist, song .. etc.</li>
<li>target: this is the target variable. target=1 means there are recurring listening event(s) triggered within a month after the user’s very first observable listening event, target=0 otherwise .</li>
</ul>
</li>
<li><p>test.csv</p>
<ul>
<li>id: row id (will be used for submission)</li>
<li>msno: user id</li>
<li>song_id: song id</li>
<li>source_system_tab: the name of the tab where the event was triggered. System tabs are used to categorize KKBOX mobile apps functions. For example, tab my library contains functions to manipulate the local storage, and tab search contains functions relating to search.</li>
<li>source_screen_name: name of the layout a user sees.</li>
<li>source_type: an entry point a user first plays music on mobile apps. An entry point could be album, online-playlist, song .. etc.</li>
</ul>
</li>
<li><p>sample_submission.csv</p>
<ul>
<li>sample submission file in the format that we expect you to submit</li>
<li>id: same as id in test.csv</li>
<li>target: this is the target variable. target=1 means there are recurring listening event(s) triggered within a month after the user’s very first observable listening event, target=0 otherwise .</li>
</ul>
</li>
<li><p>songs.csv<br> The songs. Note that data is in unicode.</p>
<ul>
<li>song_id</li>
<li>song_length: in ms</li>
<li>genre_ids: genre category. Some songs have multiple genres and they are separated by |</li>
<li>artist_name</li>
<li>composer</li>
<li>lyricist</li>
<li>language</li>
</ul>
</li>
<li><p>members.csv<br> user information.</p>
<ul>
<li>msno</li>
<li>city</li>
<li>bd: age. Note: this column has outlier values, please use your judgement.</li>
<li>gender</li>
<li>registered_via: registration method</li>
<li>registration_init_time: format %Y%m%d</li>
<li>expiration_date: format %Y%m%d</li>
</ul>
</li>
<li><p>song_extra_info.csv</p>
<ul>
<li>song_id</li>
<li>song name - the name of the song.</li>
<li>isrc - International Standard Recording Code, theoretically can be used as an identity of a song. However, what worth to note is, ISRCs generated from providers have not been officially verified; therefore the information in ISRC, such as country code and reference year, can be misleading/incorrect. Multiple songs could share one ISRC since a single recording could be re-published several times.</li>
</ul>
</li>
</ol>
<h2 id="1-Data-Cleaning-and-Exploratory-Data-Analysis-EDA"><a href="#1-Data-Cleaning-and-Exploratory-Data-Analysis-EDA" class="headerlink" title="1. Data Cleaning and Exploratory Data Analysis (EDA)"></a>1. Data Cleaning and Exploratory Data Analysis (EDA)</h2><ol>
<li>Find the Description and summary of each CSV file and Determine Null object, categorical attributes, numerical attributes</li>
<li>Convert some attribute types to correct data type, like convert string to float, if necessary </li>
<li>Handle Missing values</li>
<li>Plot univariate, bivariate plots to visualize and analyze relationship between attributes and target</li>
<li>Analysis Summary in this section</li>
</ol>
<h2 id="2-Data-Preprocessing"><a href="#2-Data-Preprocessing" class="headerlink" title="2. Data Preprocessing"></a>2. Data Preprocessing</h2><p><strong>Note that</strong> This section is to give some examples to preprocess data like filling missing values and removing outliers. </p>
<p><strong>In order to train models, you should start from step 3 ETL to extract and transform data directly using integrated functions</strong></p>
<h2 id="3-Data-Pipeline-Extract-Transformation-Load-ETL"><a href="#3-Data-Pipeline-Extract-Transformation-Load-ETL" class="headerlink" title="3. Data Pipeline: Extract, Transformation, Load (ETL)"></a>3. Data Pipeline: Extract, Transformation, Load (ETL)</h2><h2 id="4-Machine-Learning-Modeling"><a href="#4-Machine-Learning-Modeling" class="headerlink" title="4. Machine Learning Modeling"></a>4. Machine Learning Modeling</h2><ul>
<li><p>LGBM Boosting machine<br>In the modeling part, we use LGBM model first, which is a light gradient boosting machine model using tree-based basic models for boosting. Since the dataset is large, 1.9 GB and the number of attributes can increase during transformation, LGBM provides a very fast way to train a machine model, so we try it here.</p>
<p>In this part, we try LGBM model with different max_depth of tree: [10, 15,20, 25, 30] and see how max_depth affects the accuracy on prediction</p>
</li>
<li><p>Wide and Deep Neural network model<br>In addition to LGBM model, we are also interested in trying the Wide and Deep Neural network model since it is one of the popular neural network model in recommendation system and we want to see if this can help us improve the accuracy.<br>In wide and deep model, It first uses a technique called embedding, which projects the sparse categorical features into dense features vectors with smaller dimension and extract the main features. Then it concatenates the embedded vectors with the numerical features together to train a traditional neural network classifier.</p>
</li>
</ul>
<h2 id="5-Model-Training-and-validation"><a href="#5-Model-Training-and-validation" class="headerlink" title="5. Model Training and validation"></a>5. Model Training and validation</h2><ul>
<li>In model training and validation step, we split the data set into training set(80% of dataset) and validation set (20% of dataset) and then use them to train and keep track of the performance of models.</li>
</ul>
<h2 id="6-Model-Evaluation"><a href="#6-Model-Evaluation" class="headerlink" title="6. Model Evaluation"></a>6. Model Evaluation</h2><p>In Model evaluation step, we simply use the validation set to validate the final trained models and then let models make predictions on testset from kaggle and submit predictions to kaggle to see the final evaluation scores.</p>
<h2 id="7-Summary"><a href="#7-Summary" class="headerlink" title="7. Summary"></a>7. Summary</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import necessary packages here</span></span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">'ignore'</span>)</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"><span class="comment"># print(check_output(["ls", "../input"]).decode("utf8"))</span></span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">2020</span>)</span><br></pre></td></tr></table></figure>

<h1 id="1-Exploratory-Data-Analysis"><a href="#1-Exploratory-Data-Analysis" class="headerlink" title="1. Exploratory Data Analysis"></a>1. Exploratory Data Analysis</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root = <span class="string">'./kaggle/working/train/data/'</span></span><br><span class="line"><span class="comment"># !ls ../input/kkbox-music-recommendation-challenge</span></span><br><span class="line">train_df = pd.read_csv(root+ <span class="string">"train.csv"</span>)</span><br><span class="line">test_df = pd.read_csv(root+ <span class="string">"test.csv"</span>)</span><br><span class="line">song_df = pd.read_csv(root+ <span class="string">"songs.csv"</span>)</span><br><span class="line">song_extra_df = pd.read_csv(root+ <span class="string">"song_extra_info.csv"</span>)</span><br><span class="line">members_df = pd.read_csv(root+ <span class="string">"members.csv"</span>)</span><br><span class="line"><span class="comment"># sample_df = pd.read_csv(root+ "sample_submission.csv")</span></span><br></pre></td></tr></table></figure>

<h2 id="1-1-Take-a-look-to-the-info-and-format-of-data"><a href="#1-1-Take-a-look-to-the-info-and-format-of-data" class="headerlink" title="1.1 Take a look to the info and format of data"></a>1.1 Take a look to the info and format of data</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 7377418 entries, 0 to 7377417
Data columns (total 6 columns):
 #   Column              Dtype 
---  ------              ----- 
 0   msno                object
 1   song_id             object
 2   source_system_tab   object
 3   source_screen_name  object
 4   source_type         object
 5   target              int64 
dtypes: int64(1), object(5)
memory usage: 337.7+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>msno                  7377418
song_id               7377418
source_system_tab     7352569
source_screen_name    6962614
source_type           7355879
target                7377418
dtype: int64
</code></pre>
<h2 id="We-can-see-that-attributes-source-system-tab-source-screen-name-source-type-contain-missing-values"><a href="#We-can-see-that-attributes-source-system-tab-source-screen-name-source-type-contain-missing-values" class="headerlink" title="We can see that attributes: source_system_tab, source_screen_name, source_type contain missing values"></a>We can see that attributes: source_system_tab, source_screen_name, source_type contain missing values</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>BBzumQNXUHKdEBOB7mAJuzok+IJA1c2Ryg/yzTF6tik=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>bhp/MpSNoqoxOIB+/l8WPqu6jldth4DIpCm3ayXnJqM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>JNWfrrC7zNN7BdMpsISKa4Mw+xVJYNnxXh3/Epw7QgY=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>2A87tzfnJTSWqD7gIZHisolhe4DMdzkbd6LzO1KHjNs=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>3qm6XTZ6MOCU11x8FIVbAGH5l5uMkT3/ZalWG1oo2Gc=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2556790 entries, 0 to 2556789
Data columns (total 6 columns):
 #   Column              Dtype 
---  ------              ----- 
 0   id                  int64 
 1   msno                object
 2   song_id             object
 3   source_system_tab   object
 4   source_screen_name  object
 5   source_type         object
dtypes: int64(1), object(5)
memory usage: 117.0+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>id                    2556790
msno                  2556790
song_id               2556790
source_system_tab     2548348
source_screen_name    2393907
source_type           2549493
dtype: int64
</code></pre>
<h2 id="In-test-dataset-We-can-see-that-attributes-that-contain-missing-values"><a href="#In-test-dataset-We-can-see-that-attributes-that-contain-missing-values" class="headerlink" title="In test dataset,  We can see that attributes that contain missing values:"></a>In test dataset,  We can see that attributes that contain missing values:</h2><ol>
<li>source_system_tab</li>
<li>source_screen_name</li>
<li>source_type </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>V8ruy7SGk7tDm3zA51DPpn6qutt+vmKMBKa21dp54uM=</td>
      <td>WmHKgKMlp1lQMecNdNvDMkvIycZYHnFwDT72I5sIssc=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>V8ruy7SGk7tDm3zA51DPpn6qutt+vmKMBKa21dp54uM=</td>
      <td>y/rsZ9DC7FwK5F2PK2D5mj+aOBUJAjuu3dZ14NgE0vM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>/uQAlrAkaczV+nWCd2sPF2ekvXPRipV7q0l+gbLuxjw=</td>
      <td>8eZLFOdGVdXBSqoAv5nsLigeH2BvKXzTQYtUM53I0k4=</td>
      <td>discover</td>
      <td>NaN</td>
      <td>song-based-playlist</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>1a6oo/iXKatxQx4eS9zTVD+KlSVaAFbTIqVvwLC1Y0k=</td>
      <td>ztCf8thYsS4YN3GcIL/bvoxLm/T5mYBVKOO4C9NiVfQ=</td>
      <td>radio</td>
      <td>Radio</td>
      <td>radio</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1a6oo/iXKatxQx4eS9zTVD+KlSVaAFbTIqVvwLC1Y0k=</td>
      <td>MKVMpslKcQhMaFEgcEQhEfi5+RZhMYlU3eRDpySrH8Y=</td>
      <td>radio</td>
      <td>Radio</td>
      <td>radio</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">song_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2296320 entries, 0 to 2296319
Data columns (total 7 columns):
 #   Column       Dtype  
---  ------       -----  
 0   song_id      object 
 1   song_length  int64  
 2   genre_ids    object 
 3   artist_name  object 
 4   composer     object 
 5   lyricist     object 
 6   language     float64
dtypes: float64(1), int64(1), object(5)
memory usage: 122.6+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">song_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>song_id        2296320
song_length    2296320
genre_ids      2202204
artist_name    2296320
composer       1224966
lyricist        351052
language       2296319
dtype: int64
</code></pre>
<h2 id="Attributes-that-contain-missing-values-are"><a href="#Attributes-that-contain-missing-values-are" class="headerlink" title="Attributes that contain missing values are"></a>Attributes that contain missing values are</h2><ol>
<li>composer</li>
<li>lyricist</li>
<li>genre_ids</li>
<li>language</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">song_df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>song_id</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CXoTN1eb7AI+DntdU1vbcwGRV4SCIDxZu+YD8JP8r4E=</td>
      <td>247640</td>
      <td>465</td>
      <td>張信哲 (Jeff Chang)</td>
      <td>董貞</td>
      <td>何啟弘</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>o0kFgae9QtnYgRkVPqLJwa05zIhRlUjfF7O1tDw0ZDU=</td>
      <td>197328</td>
      <td>444</td>
      <td>BLACKPINK</td>
      <td>TEDDY|  FUTURE BOUNCE|  Bekuh BOOM</td>
      <td>TEDDY</td>
      <td>31.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DwVvVurfpuz+XPuFvucclVQEyPqcpUkHR0ne1RQzPs0=</td>
      <td>231781</td>
      <td>465</td>
      <td>SUPER JUNIOR</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>dKMBWoZyScdxSkihKG+Vf47nc18N9q4m58+b4e7dSSE=</td>
      <td>273554</td>
      <td>465</td>
      <td>S.H.E</td>
      <td>湯小康</td>
      <td>徐世珍</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>W3bqWd3T+VeHFzHAUfARgW9AvVRaF4N5Yzm4Mr6Eo/o=</td>
      <td>140329</td>
      <td>726</td>
      <td>貴族精選</td>
      <td>Traditional</td>
      <td>Traditional</td>
      <td>52.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">song_extra_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2295971 entries, 0 to 2295970
Data columns (total 3 columns):
 #   Column   Dtype 
---  ------   ----- 
 0   song_id  object
 1   name     object
 2   isrc     object
dtypes: object(3)
memory usage: 52.6+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">song_extra_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>song_id    2295971
name       2295969
isrc       2159423
dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">song_extra_df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>song_id</th>
      <th>name</th>
      <th>isrc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LP7pLJoJFBvyuUwvu+oLzjT+bI+UeBPURCecJsX1jjs=</td>
      <td>我們</td>
      <td>TWUM71200043</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ClazTFnk6r0Bnuie44bocdNMM3rdlrq0bCGAsGUWcHE=</td>
      <td>Let Me Love You</td>
      <td>QMZSY1600015</td>
    </tr>
    <tr>
      <th>2</th>
      <td>u2ja/bZE3zhCGxvbbOB3zOoUjx27u40cf5g09UXMoKQ=</td>
      <td>原諒我</td>
      <td>TWA530887303</td>
    </tr>
    <tr>
      <th>3</th>
      <td>92Fqsy0+p6+RHe2EoLKjHahORHR1Kq1TBJoClW9v+Ts=</td>
      <td>Classic</td>
      <td>USSM11301446</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0QFmz/+rJy1Q56C1DuYqT9hKKqi5TUqx0sN0IwvoHrw=</td>
      <td>愛投羅網</td>
      <td>TWA471306001</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">members_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 34403 entries, 0 to 34402
Data columns (total 7 columns):
 #   Column                  Non-Null Count  Dtype 
---  ------                  --------------  ----- 
 0   msno                    34403 non-null  object
 1   city                    34403 non-null  int64 
 2   bd                      34403 non-null  int64 
 3   gender                  14501 non-null  object
 4   registered_via          34403 non-null  int64 
 5   registration_init_time  34403 non-null  int64 
 6   expiration_date         34403 non-null  int64 
dtypes: int64(5), object(2)
memory usage: 1.8+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df[<span class="string">'song_id'</span>].head()</span><br></pre></td></tr></table></figure>




<pre><code>0    BBzumQNXUHKdEBOB7mAJuzok+IJA1c2Ryg/yzTF6tik=
1    bhp/MpSNoqoxOIB+/l8WPqu6jldth4DIpCm3ayXnJqM=
2    JNWfrrC7zNN7BdMpsISKa4Mw+xVJYNnxXh3/Epw7QgY=
3    2A87tzfnJTSWqD7gIZHisolhe4DMdzkbd6LzO1KHjNs=
4    3qm6XTZ6MOCU11x8FIVbAGH5l5uMkT3/ZalWG1oo2Gc=
Name: song_id, dtype: object
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">song_df[<span class="string">'song_id'</span>].head()</span><br></pre></td></tr></table></figure>




<pre><code>0    CXoTN1eb7AI+DntdU1vbcwGRV4SCIDxZu+YD8JP8r4E=
1    o0kFgae9QtnYgRkVPqLJwa05zIhRlUjfF7O1tDw0ZDU=
2    DwVvVurfpuz+XPuFvucclVQEyPqcpUkHR0ne1RQzPs0=
3    dKMBWoZyScdxSkihKG+Vf47nc18N9q4m58+b4e7dSSE=
4    W3bqWd3T+VeHFzHAUfARgW9AvVRaF4N5Yzm4Mr6Eo/o=
Name: song_id, dtype: object
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Unique Song amount in trainset:"</span>,train_df[<span class="string">'song_id'</span>].nunique())</span><br><span class="line">print(<span class="string">"Unique Song amount in testset:"</span>, test_df[<span class="string">'song_id'</span>].nunique())</span><br><span class="line">print(<span class="string">"Unique Song amount in song list:"</span>,song_df[<span class="string">'song_id'</span>].nunique())</span><br></pre></td></tr></table></figure>

<pre><code>Unique Song amount in trainset: 359966
Unique Song amount in testset: 224753
Unique Song amount in song list: 2296320
</code></pre>
<h2 id="1-2-Explore-Song-information"><a href="#1-2-Explore-Song-information" class="headerlink" title="1.2 Explore Song information"></a>1.2 Explore Song information</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Merge two dataframe based on song_id so that we can analyze the song information together with training data</span></span><br><span class="line"></span><br><span class="line">user_music_df = train_df.merge(song_df,on=<span class="string">'song_id'</span>,how=<span class="string">"left"</span>, copy =<span class="literal">False</span>)</span><br><span class="line">user_music_df[<span class="string">"song_id"</span>] = user_music_df[<span class="string">"song_id"</span>].astype(<span class="string">"category"</span>)</span><br><span class="line">user_music_df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>target</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>BBzumQNXUHKdEBOB7mAJuzok+IJA1c2Ryg/yzTF6tik=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
      <td>206471.0</td>
      <td>359</td>
      <td>Bastille</td>
      <td>Dan Smith| Mark Crew</td>
      <td>NaN</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>bhp/MpSNoqoxOIB+/l8WPqu6jldth4DIpCm3ayXnJqM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>284584.0</td>
      <td>1259</td>
      <td>Various Artists</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>JNWfrrC7zNN7BdMpsISKa4Mw+xVJYNnxXh3/Epw7QgY=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>225396.0</td>
      <td>1259</td>
      <td>Nas</td>
      <td>N. Jones、W. Adams、J. Lordan、D. Ingle</td>
      <td>NaN</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>2A87tzfnJTSWqD7gIZHisolhe4DMdzkbd6LzO1KHjNs=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>255512.0</td>
      <td>1019</td>
      <td>Soundway</td>
      <td>Kwadwo Donkoh</td>
      <td>NaN</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>3qm6XTZ6MOCU11x8FIVbAGH5l5uMkT3/ZalWG1oo2Gc=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
      <td>187802.0</td>
      <td>1011</td>
      <td>Brett Young</td>
      <td>Brett Young| Kelly Archer| Justin Ebach</td>
      <td>NaN</td>
      <td>52.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_music_df[<span class="string">'song_id'</span>].nunique(), user_music_df[<span class="string">'genre_ids'</span>].nunique()</span><br></pre></td></tr></table></figure>




<pre><code>(359966, 572)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_music_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>msno                  7377418
song_id               7377418
source_system_tab     7352569
source_screen_name    6962614
source_type           7355879
target                7377418
song_length           7377304
genre_ids             7258963
artist_name           7377304
composer              5701712
lyricist              4198620
language              7377268
dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plot the top-20 frequent genre_ids </span></span><br><span class="line">df_genre = user_music_df.sample(n=<span class="number">5000</span>)</span><br><span class="line">df_genre = df_genre[<span class="string">"genre_ids"</span>].value_counts().sort_values(ascending=<span class="literal">False</span>)[:<span class="number">20</span>]</span><br><span class="line">df_genre = df_genre.sort_values(ascending=<span class="literal">True</span>)</span><br><span class="line">ax  = df_genre.plot.barh(figsize=(<span class="number">15</span>,<span class="number">8</span>))</span><br><span class="line">ax.set_ylabel(<span class="string">"song genre ids"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"Count"</span>)</span><br></pre></td></tr></table></figure>




<pre><code>Text(0.5, 0, &#39;Count&#39;)
</code></pre>
<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_38_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#selec the top-20 frequent artist_name</span></span><br><span class="line">df_artist = user_music_df[<span class="string">"artist_name"</span>].value_counts().sort_values(ascending=<span class="literal">False</span>)[:<span class="number">20</span>]</span><br><span class="line"><span class="comment">#plot in descending order in horizonal direction</span></span><br><span class="line">df_artist = df_artist.sort_values(ascending=<span class="literal">True</span>)</span><br><span class="line">ax  = df_artist.plot.barh(figsize=(<span class="number">15</span>,<span class="number">10</span>))</span><br><span class="line">ax.set_ylabel(<span class="string">"song artist_name"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"Count"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># artist_name    </span></span><br><span class="line"><span class="comment"># composer       </span></span><br><span class="line"><span class="comment"># lyricist</span></span><br></pre></td></tr></table></figure>




<pre><code>Text(0.5, 0, &#39;Count&#39;)
</code></pre>
<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_39_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_artist.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>




<pre><code>The Chainsmokers     44215
梁靜茹 (Fish Leong)     44290
丁噹 (Della)           45762
楊丞琳 (Rainie Yang)    46006
蘇打綠 (Sodagreen)      47177
蔡依林 (Jolin Tsai)     49055
Eric 周興哲             49426
A-Lin                52913
Maroon 5             55151
謝和弦 (R-chord)        57040
Name: artist_name, dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(<span class="number">1</span>, figsize=(<span class="number">15</span>,<span class="number">8</span>))</span><br><span class="line">df_composer = user_music_df[<span class="string">"composer"</span>].value_counts().sort_values(ascending=<span class="literal">False</span>)[:<span class="number">20</span>]</span><br><span class="line">ax  = sns.barplot([i <span class="keyword">for</span> i <span class="keyword">in</span> df_composer.index],df_composer,ax= ax)</span><br><span class="line">ax.set_xlabel(<span class="string">"song composer"</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"Count"</span>)</span><br></pre></td></tr></table></figure>




<pre><code>Text(0, 0.5, &#39;Count&#39;)
</code></pre>
<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_41_1.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_composer.head(<span class="number">20</span>).index</span><br></pre></td></tr></table></figure>




<pre><code>Index([&#39;周杰倫&#39;, &#39;阿信&#39;, &#39;林俊傑&#39;, &#39;陳皓宇&#39;, &#39;JJ Lin&#39;, &#39;張簡君偉&#39;, &#39;Eric Chou&#39;, &#39;韋禮安&#39;,
       &#39;八三夭 阿璞&#39;, &#39;R-chord&#39;, &#39;怪獸&#39;, &#39;吳青峰&#39;, &#39;周湯豪&#39;, &#39;G.E.M. 鄧紫棋&#39;, &#39;陳小霞&#39;, &#39;JerryC&#39;,
       &#39;吳克群&#39;, &#39;薛之謙&#39;, &#39;Rocoberry&#39;, &#39;李榮浩&#39;],
      dtype=&#39;object&#39;)
</code></pre>
<p>Analyse the relationship between target and song</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(<span class="number">3</span>,<span class="number">1</span>,figsize=(<span class="number">15</span>,<span class="number">18</span>))</span><br><span class="line"><span class="comment"># df = user_music_df[['source_system_tab','source_screen_name','source_type']]</span></span><br><span class="line"><span class="comment"># df['source_system_tab'].value_counts().plot.bar(rot=20,ax=ax[0])</span></span><br><span class="line"><span class="comment"># ax[0].set_xlabel("source_system_tab")</span></span><br><span class="line"><span class="comment"># ax[0].set_ylabel("count")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># df['source_screen_name'].value_counts().plot.bar(rot=30,ax=ax[1])</span></span><br><span class="line"><span class="comment"># ax[1].set_xlabel("source_screen_name")</span></span><br><span class="line"><span class="comment"># ax[1].set_ylabel("count")</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># df['source_type'].value_counts().plot.bar(rot=20,ax=ax[2])</span></span><br><span class="line"><span class="comment"># ax[2].set_xlabel("source_type")</span></span><br><span class="line"><span class="comment"># ax[2].set_ylabel("count")</span></span><br><span class="line"></span><br><span class="line">sns.countplot(y= <span class="string">'source_system_tab'</span>,hue=<span class="string">'target'</span>,</span><br><span class="line">              order = user_music_df[<span class="string">'source_system_tab'</span>].value_counts().index,</span><br><span class="line">              data=user_music_df,dodge=<span class="literal">True</span>, ax= ax[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">sns.countplot(y= <span class="string">'source_screen_name'</span>,hue=<span class="string">'target'</span>,</span><br><span class="line">              order = user_music_df[<span class="string">'source_screen_name'</span>].value_counts().index,</span><br><span class="line">              data=user_music_df,dodge=<span class="literal">True</span>, ax= ax[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sns.countplot(y= <span class="string">'source_type'</span>,hue=<span class="string">'target'</span>,</span><br><span class="line">              order = user_music_df[<span class="string">'source_type'</span>].value_counts().index,</span><br><span class="line">              data=user_music_df,dodge=<span class="literal">True</span>, ax= ax[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>




<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f269a90e128&gt;
</code></pre>
<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_44_1.png" alt="png"></p>
<h4 id="We-can-see-that-local-library-and-local-playlist-are-the-main-sources-that-users-repeat-playing-music-and-Most-of-users-more-prefer-to-play-music-from-local-library-than-to-play-music-online"><a href="#We-can-see-that-local-library-and-local-playlist-are-the-main-sources-that-users-repeat-playing-music-and-Most-of-users-more-prefer-to-play-music-from-local-library-than-to-play-music-online" class="headerlink" title="We can see that local library and local playlist are the main sources that users repeat playing music and Most of users more prefer to play music from local library than to play music online"></a>We can see that local library and local playlist are the main sources that users repeat playing music and Most of users more prefer to play music from local library than to play music online</h4><h1 id="Analyze-Relationship-between-Target-and-members-info"><a href="#Analyze-Relationship-between-Target-and-members-info" class="headerlink" title="Analyze Relationship between Target and members info"></a>Analyze Relationship between Target and members info</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">members_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 34403 entries, 0 to 34402
Data columns (total 7 columns):
 #   Column                  Non-Null Count  Dtype 
---  ------                  --------------  ----- 
 0   msno                    34403 non-null  object
 1   city                    34403 non-null  int64 
 2   bd                      34403 non-null  int64 
 3   gender                  14501 non-null  object
 4   registered_via          34403 non-null  int64 
 5   registration_init_time  34403 non-null  int64 
 6   expiration_date         34403 non-null  int64 
dtypes: int64(5), object(2)
memory usage: 1.8+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">members_df[<span class="string">"registration_init_time"</span>] = pd.to_datetime(members_df[<span class="string">"registration_init_time"</span>], format=<span class="string">"%Y%m%d"</span>)</span><br><span class="line">members_df[<span class="string">"expiration_date"</span>] = pd.to_datetime(members_df[<span class="string">"expiration_date"</span>], format=<span class="string">"%Y%m%d"</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Parse-the-datetime-data"><a href="#Parse-the-datetime-data" class="headerlink" title="Parse the datetime data"></a>Parse the datetime data</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">members_df[<span class="string">"registration_init_day"</span>] = members_df[<span class="string">"registration_init_time"</span>].dt.day</span><br><span class="line">members_df[<span class="string">"registration_init_month"</span>] = members_df[<span class="string">"registration_init_time"</span>].dt.month</span><br><span class="line">members_df[<span class="string">"registration_init_year"</span>] = members_df[<span class="string">"registration_init_time"</span>].dt.year</span><br><span class="line">members_df[<span class="string">"expiration_day"</span>] = members_df[<span class="string">"expiration_date"</span>].dt.day</span><br><span class="line">members_df[<span class="string">"expiration_month"</span>] = members_df[<span class="string">"expiration_date"</span>].dt.month</span><br><span class="line">members_df[<span class="string">"expiration_year"</span>] = members_df[<span class="string">"expiration_date"</span>].dt.year</span><br><span class="line">members_df = members_df.drop(columns = [<span class="string">"registration_init_time"</span>, <span class="string">"expiration_date"</span>],axis=<span class="number">1</span>)</span><br><span class="line">members_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 34403 entries, 0 to 34402
Data columns (total 11 columns):
 #   Column                   Non-Null Count  Dtype 
---  ------                   --------------  ----- 
 0   msno                     34403 non-null  object
 1   city                     34403 non-null  int64 
 2   bd                       34403 non-null  int64 
 3   gender                   14501 non-null  object
 4   registered_via           34403 non-null  int64 
 5   registration_init_day    34403 non-null  int64 
 6   registration_init_month  34403 non-null  int64 
 7   registration_init_year   34403 non-null  int64 
 8   expiration_day           34403 non-null  int64 
 9   expiration_month         34403 non-null  int64 
 10  expiration_year          34403 non-null  int64 
dtypes: int64(9), object(2)
memory usage: 2.9+ MB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">member_music_df = user_music_df.merge(members_df,on=<span class="string">'msno'</span>,how=<span class="string">"left"</span>, copy=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#after merging, the axis used to merge becomes object type,so need to convert it back to category type</span></span><br><span class="line">member_music_df[<span class="string">"msno"</span>] = member_music_df[<span class="string">"msno"</span>].astype(<span class="string">"category"</span>)</span><br><span class="line">member_music_df[<span class="string">"song_id"</span>] = member_music_df[<span class="string">"song_id"</span>].astype(<span class="string">"category"</span>)</span><br><span class="line">member_music_df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>target</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>BBzumQNXUHKdEBOB7mAJuzok+IJA1c2Ryg/yzTF6tik=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
      <td>206471.0</td>
      <td>359</td>
      <td>Bastille</td>
      <td>Dan Smith| Mark Crew</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>bhp/MpSNoqoxOIB+/l8WPqu6jldth4DIpCm3ayXnJqM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>284584.0</td>
      <td>1259</td>
      <td>Various Artists</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>13</td>
      <td>24</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>JNWfrrC7zNN7BdMpsISKa4Mw+xVJYNnxXh3/Epw7QgY=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>225396.0</td>
      <td>1259</td>
      <td>Nas</td>
      <td>N. Jones、W. Adams、J. Lordan、D. Ingle</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>13</td>
      <td>24</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>2A87tzfnJTSWqD7gIZHisolhe4DMdzkbd6LzO1KHjNs=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>255512.0</td>
      <td>1019</td>
      <td>Soundway</td>
      <td>Kwadwo Donkoh</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>13</td>
      <td>24</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>3qm6XTZ6MOCU11x8FIVbAGH5l5uMkT3/ZalWG1oo2Gc=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
      <td>187802.0</td>
      <td>1011</td>
      <td>Brett Young</td>
      <td>Brett Young| Kelly Archer| Justin Ebach</td>
      <td>NaN</td>
      <td>52.0</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 7377418 entries, 0 to 7377417
Data columns (total 22 columns):
 #   Column                   Dtype   
---  ------                   -----   
 0   msno                     category
 1   song_id                  category
 2   source_system_tab        object  
 3   source_screen_name       object  
 4   source_type              object  
 5   target                   int64   
 6   song_length              float64 
 7   genre_ids                object  
 8   artist_name              object  
 9   composer                 object  
 10  lyricist                 object  
 11  language                 float64 
 12  city                     int64   
 13  bd                       int64   
 14  gender                   object  
 15  registered_via           int64   
 16  registration_init_day    int64   
 17  registration_init_month  int64   
 18  registration_init_year   int64   
 19  expiration_day           int64   
 20  expiration_month         int64   
 21  expiration_year          int64   
dtypes: category(2), float64(2), int64(10), object(8)
memory usage: 1.2+ GB
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>msno                       7377418
song_id                    7377418
source_system_tab          7352569
source_screen_name         6962614
source_type                7355879
target                     7377418
song_length                7377304
genre_ids                  7258963
artist_name                7377304
composer                   5701712
lyricist                   4198620
language                   7377268
city                       7377418
bd                         7377418
gender                     4415939
registered_via             7377418
registration_init_day      7377418
registration_init_month    7377418
registration_init_year     7377418
expiration_day             7377418
expiration_month           7377418
expiration_year            7377418
dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df[<span class="string">'bd'</span>].describe()</span><br></pre></td></tr></table></figure>




<pre><code>count    7.377418e+06
mean     1.753927e+01
std      2.155447e+01
min     -4.300000e+01
25%      0.000000e+00
50%      2.100000e+01
75%      2.900000e+01
max      1.051000e+03
Name: bd, dtype: float64
</code></pre>
<h2 id="Visualize-distribution-of-age-bd-attribution"><a href="#Visualize-distribution-of-age-bd-attribution" class="headerlink" title="Visualize distribution of age: bd attribution"></a>Visualize distribution of age: bd attribution</h2><p>Note: Since this attribute has outliers, I use remove the data that lies outside range [0,100] </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(<span class="number">2</span>, figsize= (<span class="number">15</span>,<span class="number">8</span>))</span><br><span class="line">age_df = member_music_df[<span class="string">'bd'</span>].loc[(member_music_df[<span class="string">'bd'</span>]&gt;<span class="number">0</span>) &amp; (member_music_df[<span class="string">'bd'</span>]&lt;<span class="number">100</span>)]</span><br><span class="line">age_df.hist(ax = ax[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set_ylabel(<span class="string">"count"</span>)</span><br><span class="line"></span><br><span class="line">member_music_df[<span class="string">'bd'</span>].loc[(member_music_df[<span class="string">'bd'</span>]&lt;<span class="number">0</span>) | (member_music_df[<span class="string">'bd'</span>]&gt;<span class="number">100</span>)].hist(ax = ax[<span class="number">1</span>])</span><br><span class="line">ax[<span class="number">1</span>].set_xlabel(<span class="string">"age"</span>)</span><br><span class="line">ax[<span class="number">1</span>].set_ylabel(<span class="string">"count"</span>)</span><br></pre></td></tr></table></figure>




<pre><code>Text(0, 0.5, &#39;count&#39;)
</code></pre>
<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_56_1.png" alt="png"></p>
<h2 id="We-can-see-that-bd-age-has-outliers-outside-range-0-100-so-we-want-to-replace-the-incorrect-bd-with-NaN"><a href="#We-can-see-that-bd-age-has-outliers-outside-range-0-100-so-we-want-to-replace-the-incorrect-bd-with-NaN" class="headerlink" title="We can see that bd/age has outliers outside range [0,100], so we want to replace the incorrect bd with NaN"></a>We can see that bd/age has outliers outside range [0,100], so we want to replace the incorrect bd with NaN</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df[<span class="string">'bd'</span>].loc[(member_music_df[<span class="string">'bd'</span>]&lt;=<span class="number">0</span>) | (member_music_df[<span class="string">'bd'</span>]&gt;=<span class="number">100</span>)]= np.nan</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">member_music_df.describe()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
      <th>song_length</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7.377418e+06</td>
      <td>7.377304e+06</td>
      <td>7.377268e+06</td>
      <td>7.377418e+06</td>
      <td>4.430216e+06</td>
      <td>7.377418e+06</td>
      <td>7.377418e+06</td>
      <td>7.377418e+06</td>
      <td>7.377418e+06</td>
      <td>7.377418e+06</td>
      <td>7.377418e+06</td>
      <td>7.377418e+06</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5.035171e-01</td>
      <td>2.451210e+05</td>
      <td>1.860933e+01</td>
      <td>7.511399e+00</td>
      <td>2.872200e+01</td>
      <td>6.794068e+00</td>
      <td>1.581532e+01</td>
      <td>6.832306e+00</td>
      <td>2.012741e+03</td>
      <td>1.562338e+01</td>
      <td>8.341742e+00</td>
      <td>2.017072e+03</td>
    </tr>
    <tr>
      <th>std</th>
      <td>4.999877e-01</td>
      <td>6.734471e+04</td>
      <td>2.117681e+01</td>
      <td>6.641625e+00</td>
      <td>8.634326e+00</td>
      <td>2.275774e+00</td>
      <td>8.768549e+00</td>
      <td>3.700723e+00</td>
      <td>3.018861e+00</td>
      <td>9.107235e+00</td>
      <td>2.511360e+00</td>
      <td>3.982536e-01</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000e+00</td>
      <td>1.393000e+03</td>
      <td>-1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>2.000000e+00</td>
      <td>3.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>2.004000e+03</td>
      <td>1.000000e+00</td>
      <td>1.000000e+00</td>
      <td>1.970000e+03</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000e+00</td>
      <td>2.147260e+05</td>
      <td>3.000000e+00</td>
      <td>1.000000e+00</td>
      <td>2.300000e+01</td>
      <td>4.000000e+00</td>
      <td>8.000000e+00</td>
      <td>3.000000e+00</td>
      <td>2.011000e+03</td>
      <td>8.000000e+00</td>
      <td>9.000000e+00</td>
      <td>2.017000e+03</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000e+00</td>
      <td>2.418120e+05</td>
      <td>3.000000e+00</td>
      <td>5.000000e+00</td>
      <td>2.700000e+01</td>
      <td>7.000000e+00</td>
      <td>1.600000e+01</td>
      <td>7.000000e+00</td>
      <td>2.013000e+03</td>
      <td>1.500000e+01</td>
      <td>9.000000e+00</td>
      <td>2.017000e+03</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.000000e+00</td>
      <td>2.721600e+05</td>
      <td>5.200000e+01</td>
      <td>1.300000e+01</td>
      <td>3.300000e+01</td>
      <td>9.000000e+00</td>
      <td>2.300000e+01</td>
      <td>1.000000e+01</td>
      <td>2.015000e+03</td>
      <td>2.300000e+01</td>
      <td>1.000000e+01</td>
      <td>2.017000e+03</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000e+00</td>
      <td>1.085171e+07</td>
      <td>5.900000e+01</td>
      <td>2.200000e+01</td>
      <td>9.500000e+01</td>
      <td>1.300000e+01</td>
      <td>3.100000e+01</td>
      <td>1.200000e+01</td>
      <td>2.017000e+03</td>
      <td>3.100000e+01</td>
      <td>1.200000e+01</td>
      <td>2.020000e+03</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dataframe.corr() is used to find the pairwise correlation of all columns in the dataframe. </span></span><br><span class="line"><span class="comment">#Any na values are automatically excluded. For any non-numeric data type columns in the data frame it is ignored.</span></span><br><span class="line">corr_matrix = member_music_df.corr()</span><br><span class="line">_ = sns.heatmap(corr_matrix)</span><br></pre></td></tr></table></figure>


<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_60_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#print the top threee attributes that have the strongest correlation with "Target" and the corresponding correlation coefficients.</span></span><br><span class="line">corr = corr_matrix[<span class="string">'target'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line"><span class="comment">#print the top threee attributes that have the strongest correlation with "song_length" and the corresponding correlation coefficients.</span></span><br><span class="line">corr = corr_matrix[<span class="string">'song_length'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line"><span class="comment">#print the top threee attributes that have the strongest correlation with "language" and the corresponding correlation coefficients.</span></span><br><span class="line">corr = corr_matrix[<span class="string">'language'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line"><span class="comment">#print the top threee attributes that have the strongest correlation with "city" and the corresponding correlation coefficients.</span></span><br><span class="line">corr = corr_matrix[<span class="string">'city'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line"><span class="comment">#print the top threee attributes that have the strongest correlation with "bd" and the corresponding correlation coefficients.</span></span><br><span class="line">corr = corr_matrix[<span class="string">'bd'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line"><span class="comment">#print the top threee attributes that have the strongest correlation with "registered_via" and the corresponding correlation coefficients.</span></span><br><span class="line">corr = corr_matrix[<span class="string">'registered_via'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line">corr = corr_matrix[<span class="string">'registration_init_day'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line">corr = corr_matrix[<span class="string">'registration_init_month'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line">corr = corr_matrix[<span class="string">'registration_init_year'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line">corr = corr_matrix[<span class="string">'expiration_day'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line">corr = corr_matrix[<span class="string">'expiration_month'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br><span class="line">corr = corr_matrix[<span class="string">'expiration_year'</span>].sort_values(ascending= <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> corr.index[<span class="number">1</span>:<span class="number">4</span>].to_list():</span><br><span class="line">    print(<span class="string">"&#123;&#125; &#123;&#125;"</span>.format(x, corr[x]))</span><br><span class="line">print(<span class="string">""</span>)</span><br></pre></td></tr></table></figure>

<pre><code>expiration_year 0.042248332355979766
city 0.01211438566189457
expiration_month 0.011817072086387569

bd 0.009861302779254176
city 0.005184912771179072
expiration_year 0.00457185870016758

registration_init_year 0.009070490482763404
registration_init_day 0.001510510575428178
bd 0.001107978394135987

expiration_year 0.15014690465127595
registered_via 0.0737556175747622
target 0.01211438566189457

registered_via 0.1753390015877422
expiration_day 0.056335854806629254
expiration_month 0.032935904360496926

bd 0.1753390015877422
expiration_year 0.08413460079453493
city 0.0737556175747622

expiration_day 0.1493505099924221
registration_init_month 0.04443692475737983
registered_via 0.02554331305533987

expiration_month 0.056911114419175665
registration_init_day 0.04443692475737983
bd 0.005399463812914416

language 0.009070490482763404
target -0.00196242388069252
song_length -0.007434856516605977

registration_init_day 0.1493505099924221
registered_via 0.05695618668075027
bd 0.056335854806629254

registered_via 0.0647318000666518
registration_init_month 0.056911114419175665
bd 0.032935904360496926

city 0.15014690465127595
registered_via 0.08413460079453493
target 0.042248332355979766
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#graph</span></span><br><span class="line">fig, ax = plt.subplots(<span class="number">1</span>,<span class="number">1</span>,figsize=(<span class="number">10</span>,<span class="number">8</span>), sharex=<span class="literal">False</span>)</span><br><span class="line">plt.scatter(x = member_music_df[<span class="string">'city'</span>],y = member_music_df[<span class="string">'bd'</span>])</span><br><span class="line">ax.set_ylabel(<span class="string">"bd"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"city"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_62_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#graph</span></span><br><span class="line">fig, ax = plt.subplots(<span class="number">1</span>,<span class="number">1</span>,figsize=(<span class="number">10</span>,<span class="number">8</span>), sharex=<span class="literal">False</span>)</span><br><span class="line">plt.scatter(x = member_music_df[<span class="string">'target'</span>],y = member_music_df[<span class="string">'expiration_year'</span>])</span><br><span class="line">ax.set_ylabel(<span class="string">"expiration_year"</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"target"</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="/images/kkboxmusicrecommendation-notebook-v4_files/kkboxmusicrecommendation-notebook-v4_63_0.png" alt="png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user的musiclist里面可能重听的music </span></span><br><span class="line">print(train_df.target.value_counts()*<span class="number">100</span>/train_df.target.value_counts().sum())</span><br><span class="line">print(<span class="string">'unique songs '</span>,len(train_df.song_id.unique()))</span><br><span class="line"><span class="comment">#unique() = Return unique values of Series object.</span></span><br><span class="line"><span class="comment">#len() to find unqiue sound.</span></span><br></pre></td></tr></table></figure>

<pre><code>1    50.351708
0    49.648292
Name: target, dtype: float64
unique songs  359966
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repeats=train_df[train_df.target==<span class="number">1</span>]</span><br><span class="line">song_repeats=repeats.groupby(<span class="string">'song_id'</span>,as_index=<span class="literal">False</span>).msno.count()</span><br><span class="line">song_repeats.columns=[<span class="string">'song_id'</span>,<span class="string">'count'</span>]</span><br><span class="line"><span class="comment">##merge together 2 dataframe and create a new dataframe</span></span><br><span class="line">song_repeats=pd.DataFrame(song_repeats).merge(song_df,left_on=<span class="string">'song_id'</span>,right_on=<span class="string">'song_id'</span>)</span><br><span class="line">print(<span class="string">"Print top 50 songs repeated"</span>)</span><br><span class="line">repeats.song_id.value_counts().head(<span class="number">50</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Print top 50 songs repeated





reXuGcEWDDCnL0K3Th//3DFG4S1ACSpJMzA+CFipo1g=    10885
T86YHdD4C9JSc274b1IlMkLuNdz4BQRB50fWWE7hx9g=    10556
FynUyq0+drmIARmK1JZ/qcjNZ7DKkqTY6/0O0lTzNUI=     9808
wBTWuHbjdjxnG1lQcbqnK4FddV24rUhuyrYLd9c/hmk=     9411
PgRtmmESVNtWjoZHO5a1r21vIz9sVZmcJJpFCbRa1LI=     9004
U9kojfZSKaiWOW94PKh1Riyv/zUWxmBRmv0XInQWLGw=     8787
YN4T/yvvXtYrBVN8KTnieiQohHL3T9fnzUkbLWcgLro=     8780
M9rAajz4dYuRhZ7jLvf9RRayVA3os61X/XXHEuW4giA=     8403
43Qm2YzsP99P5wm37B1JIhezUcQ/1CDjYlQx6rBbz2U=     8112
J4qKkLIoW7aYACuTupHLAPZYmRp08en1AEux+GSUzdw=     7903
cy10N2j2sdY/X4BDUcMu2Iumfz7pV3tqE5iEaup2yGI=     7725
750RprmFfLV0bymtDH88g24pLZGVi5VpBAI300P6UOA=     7608
IKMFuL0f5Y8c63Hg9BXkeNJjE0z8yf3gMt/tOxF4QNE=     7224
+SstqMwhQPBQFTPBhLKPT642IiBDXzZFwlzsLl4cGXo=     7061
DLBDZhOoW7zd7GBV99bi92ZXYUS26lzV+jJKbHshP5c=     6901
v/3onppBGoSpGsWb8iaCIO8eX5+iacbH5a4ZUhT7N54=     6879
p/yR06j/RQ2J6yGCFL0K+1R06OeG+eXcwxRgOHDo/Tk=     6536
Xpjwi8UAE2Vv9PZ6cZnhc58MCtl3cKZEO1sdAkqJ4mo=     6399
OaEbZ6TJ1NePtNUeEgWsvFLeopkSln9WQu8PBR5B3+A=     6187
BITuBuNyXQydJcjDL2BUnCu4/IXaJg5IPOuycc/4dtY=     6160
BgqjNqzsyCpEGvxyUmktvHC8WO5+FQO/pQTaZ4broMU=     6140
3VkD5ekIf5duJm1hmYTZlXjyl0zqV8wCzuAh3uocfCg=     6012
8Ckw1wek5d6oEsNUoM4P5iag86TaEmyLwdtrckL0Re8=     6003
n+pMhj/jpCnpiUcSDl4k3i9FJODDddEXmpE48/HczTI=     5787
WL4ipO3Mx9pxd4FMs69ha6o9541+fLeOow67Qkrfnro=     5784
/70HjygVDhHsKBoV8mmsBg/WduSgs4+Zg6GfzhUQbdk=     5588
L6w2d0w84FjTvFr+BhMfgu7dZAsGiOqUGmvvxIG3gvQ=     5480
fEAIgFRWmhXmo6m3ukQeqRksZCcO/7CjkqNckRHiVQo=     5460
+Sm75wnBf/sjm/QMUAFx8N+Ae04kWCXGlgH50tTeM6c=     5412
VkDBgh89umc9m6uAEfD6LXngetyGhln4vh/ArCGO0nY=     5361
fCCmIa0Y5m+MCGbQga31MOLTIqi7ddgXvkjFPmfslGw=     5305
+LztcJcPEEwsikk6+K5udm06XJQMzR4+lzavKLUyE0k=     5298
o9HWMBZMeIPnYEpSuscGoORKE44sj3BYOdvGuIi0P68=     5233
QZBm8SOwnEjNfCpgsKBBGPMGET6y6XaQgnJiirspW7I=     5224
ClazTFnk6r0Bnuie44bocdNMM3rdlrq0bCGAsGUWcHE=     5202
wp1gSQ4LlMEF6bzvEaJl8VdHlAj/EJMTJ0ASrXeddbo=     5110
THqGcrzQyUhBn1NI/+Iptc1vKtxBIEg0uA8iaoJnO1Q=     5086
ys+EL8Sok4HC4i7sDY0+slDNGVZ8+uOQi6TQ6g8VSF4=     5012
zHqZ07gn+YvF36FWzv9+y8KiCMhYhdAUS+vSIKY3UZY=     5001
8f/T4ohROj1wa25YHMItOW2/wJhRXZM0+T5/2p86COc=     4982
G/4+VCRLpfjQJ4SAwMDcf+W8PTw0eOBRgFvg4fHUOO8=     4956
KZ5hwP74wRO6kRapVIprwodtNdVD2EVD3hkZmmyXFPk=     4888
MtFK4NN8Kv1k/xPA3wb8SQaP/jWee52FAaC1s9NFsU4=     4813
UQeOwfhcqgEcIwp3cgNiLGW1237Qjpvqzt/asQimVp0=     4778
JA6C0GEK1sSCVbHyqtruH/ARD1NKolYrw7HXy6EVNAc=     4766
8qWeDv6RTv+hYJxW94e7n6HBzHPGPEZW9FuGhj6pPhQ=     4761
35dx60z4m4+Lg+qIS0l2A8vspbthqnpTylWUu51jW+4=     4679
r4lUPUkz3tAgIWaEyrSYVCxX1yz8PnlVuQz+To0Pd+c=     4650
1PR/lVwL4VeYcZjexwBJ2NOSTfgh8JoVxWCunnbJO/8=     4592
7EnDBkQYJpipCyRd9JBsug4iKnfAunUXc14/96cNotg=     4571
Name: song_id, dtype: int64
</code></pre>
<h1 id="2-Data-Preprocessing-1"><a href="#2-Data-Preprocessing-1" class="headerlink" title="2. Data Preprocessing"></a>2. Data Preprocessing</h1><p>Note: This section is to show how to preprocess data. We can also directly start from Step 3 for data extract, transformation and load using integrated transformation function and skip this step if necessary</p>
<h2 id="2-1-Filling-missing-values"><a href="#2-1-Filling-missing-values" class="headerlink" title="2.1 Filling missing values"></a>2.1 Filling missing values</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">missing_value_cols = [c <span class="keyword">for</span> c <span class="keyword">in</span> member_music_df.columns <span class="keyword">if</span> member_music_df[c].isnull().any()]</span><br><span class="line">missing_value_cols</span><br></pre></td></tr></table></figure>




<pre><code>[&#39;source_system_tab&#39;,
 &#39;source_screen_name&#39;,
 &#39;source_type&#39;,
 &#39;song_length&#39;,
 &#39;genre_ids&#39;,
 &#39;artist_name&#39;,
 &#39;composer&#39;,
 &#39;lyricist&#39;,
 &#39;language&#39;,
 &#39;bd&#39;,
 &#39;gender&#39;]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>msno                       7377418
song_id                    7377418
source_system_tab          7352569
source_screen_name         6962614
source_type                7355879
target                     7377418
song_length                7377304
genre_ids                  7258963
artist_name                7377304
composer                   5701712
lyricist                   4198620
language                   7377268
city                       7377418
bd                         4430216
gender                     4415939
registered_via             7377418
registration_init_day      7377418
registration_init_month    7377418
registration_init_year     7377418
expiration_day             7377418
expiration_month           7377418
expiration_year            7377418
dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list of columns with missing values</span></span><br><span class="line"><span class="comment"># ['source_system_tab',</span></span><br><span class="line"><span class="comment">#  'source_screen_name',</span></span><br><span class="line"><span class="comment">#  'source_type',</span></span><br><span class="line"><span class="comment">#  'song_length',</span></span><br><span class="line"><span class="comment">#  'genre_ids',</span></span><br><span class="line"><span class="comment">#  'artist_name',</span></span><br><span class="line"><span class="comment">#  'composer',</span></span><br><span class="line"><span class="comment">#  'lyricist',</span></span><br><span class="line"><span class="comment">#  'language',</span></span><br><span class="line"><span class="comment">#  'bd',</span></span><br><span class="line"><span class="comment">#  'gender']</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill_missing_value_v1</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="comment"># fill missing values with the most frequent values</span></span><br><span class="line">    <span class="keyword">return</span> x.fillna(x.value_counts().sort_values(ascending=<span class="literal">False</span>).index[<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">categorical_ls = [<span class="string">'source_system_tab'</span>, <span class="string">'source_screen_name'</span>,<span class="string">'source_type'</span>,<span class="string">'genre_ids'</span>,<span class="string">'artist_name'</span>,<span class="string">'composer'</span>,</span><br><span class="line"> <span class="string">'lyricist'</span>,<span class="string">'gender'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">numerical_ls = [<span class="string">'song_length'</span>,<span class="string">'language'</span>,<span class="string">'bd'</span>]</span><br><span class="line"><span class="comment"># Fill missing values </span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> numerical_ls:</span><br><span class="line">    member_music_df[index].fillna(member_music_df[index].median(), inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> categorical_ls:</span><br><span class="line">    member_music_df[index].fillna(<span class="string">"no_data"</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.count()</span><br></pre></td></tr></table></figure>




<pre><code>msno                       7377418
song_id                    7377418
source_system_tab          7377418
source_screen_name         7377418
source_type                7377418
target                     7377418
song_length                7377418
genre_ids                  7377418
artist_name                7377418
composer                   7377418
lyricist                   7377418
language                   7377418
city                       7377418
bd                         7377418
gender                     7377418
registered_via             7377418
registration_init_day      7377418
registration_init_month    7377418
registration_init_year     7377418
expiration_day             7377418
expiration_month           7377418
expiration_year            7377418
dtype: int64
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">member_music_df[numerical_ls].head(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>song_length</th>
      <th>language</th>
      <th>bd</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>206471.0</td>
      <td>52.0</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>284584.0</td>
      <td>52.0</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>225396.0</td>
      <td>52.0</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>255512.0</td>
      <td>-1.0</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>187802.0</td>
      <td>52.0</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>333024.0</td>
      <td>3.0</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>288391.0</td>
      <td>3.0</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>279196.0</td>
      <td>3.0</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>240744.0</td>
      <td>3.0</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>221622.0</td>
      <td>3.0</td>
      <td>46.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 3 columns</p>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">member_music_df[categorical_ls].head(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>gender</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>359</td>
      <td>Bastille</td>
      <td>Dan Smith| Mark Crew</td>
      <td>no_data</td>
      <td>no_data</td>
    </tr>
    <tr>
      <th>1</th>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1259</td>
      <td>Various Artists</td>
      <td>no_data</td>
      <td>no_data</td>
      <td>female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1259</td>
      <td>Nas</td>
      <td>N. Jones、W. Adams、J. Lordan、D. Ingle</td>
      <td>no_data</td>
      <td>female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1019</td>
      <td>Soundway</td>
      <td>Kwadwo Donkoh</td>
      <td>no_data</td>
      <td>female</td>
    </tr>
    <tr>
      <th>4</th>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1011</td>
      <td>Brett Young</td>
      <td>Brett Young| Kelly Archer| Justin Ebach</td>
      <td>no_data</td>
      <td>no_data</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>my library</td>
      <td>no_data</td>
      <td>local-library</td>
      <td>458</td>
      <td>楊乃文 (Naiwen Yang)</td>
      <td>黃建為</td>
      <td>葛大為</td>
      <td>male</td>
    </tr>
    <tr>
      <th>96</th>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>458</td>
      <td>陳奕迅 (Eason Chan)</td>
      <td>Jun Jie Lin</td>
      <td>no_data</td>
      <td>female</td>
    </tr>
    <tr>
      <th>97</th>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>458</td>
      <td>周杰倫 (Jay Chou)</td>
      <td>周杰倫</td>
      <td>方文山</td>
      <td>female</td>
    </tr>
    <tr>
      <th>98</th>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>465</td>
      <td>范瑋琪 (Christine Fan)</td>
      <td>非非</td>
      <td>非非</td>
      <td>female</td>
    </tr>
    <tr>
      <th>99</th>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>465|1259</td>
      <td>玖壹壹</td>
      <td>陳皓宇</td>
      <td>廖建至|洪瑜鴻</td>
      <td>female</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 8 columns</p>
</div>



<h2 id="2-2-Data-Transformation"><a href="#2-2-Data-Transformation" class="headerlink" title="2.2 Data Transformation"></a>2.2 Data Transformation</h2><p>We can see that the columns like genre_ids, composer, lyricist have multiple values in a cell. In this case, the count of genres, composers, lyricist could be useful information as well</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.columns</span><br></pre></td></tr></table></figure>




<pre><code>Index([&#39;msno&#39;, &#39;song_id&#39;, &#39;source_system_tab&#39;, &#39;source_screen_name&#39;,
       &#39;source_type&#39;, &#39;target&#39;, &#39;song_length&#39;, &#39;genre_ids&#39;, &#39;artist_name&#39;,
       &#39;composer&#39;, &#39;lyricist&#39;, &#39;language&#39;, &#39;city&#39;, &#39;bd&#39;, &#39;gender&#39;,
       &#39;registered_via&#39;, &#39;registration_init_day&#39;, &#39;registration_init_month&#39;,
       &#39;registration_init_year&#39;, &#39;expiration_day&#39;, &#39;expiration_month&#39;,
       &#39;expiration_year&#39;],
      dtype=&#39;object&#39;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.genre_ids.nunique(), member_music_df.composer.nunique(), member_music_df.lyricist.nunique()</span><br></pre></td></tr></table></figure>




<pre><code>(573, 76065, 33889)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_items</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x ==<span class="string">"no_data"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> sum(map(x.count, [<span class="string">'|'</span>, <span class="string">'/'</span>, <span class="string">'\\'</span>, <span class="string">';'</span>,<span class="string">','</span>])) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">member_music_df[<span class="string">'genre_count'</span>]=  member_music_df[<span class="string">'genre_ids'</span>].apply(count_items)</span><br><span class="line">member_music_df[<span class="string">'composer_count'</span>]=  member_music_df[<span class="string">'composer'</span>].apply(count_items)</span><br><span class="line">member_music_df[<span class="string">'lyricist_count'</span>]=  member_music_df[<span class="string">'lyricist'</span>].apply(count_items)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>target</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
      <th>genre_count</th>
      <th>composer_count</th>
      <th>lyricist_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>BBzumQNXUHKdEBOB7mAJuzok+IJA1c2Ryg/yzTF6tik=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
      <td>206471.0</td>
      <td>359</td>
      <td>Bastille</td>
      <td>Dan Smith| Mark Crew</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>bhp/MpSNoqoxOIB+/l8WPqu6jldth4DIpCm3ayXnJqM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>284584.0</td>
      <td>1259</td>
      <td>Various Artists</td>
      <td>no_data</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>JNWfrrC7zNN7BdMpsISKa4Mw+xVJYNnxXh3/Epw7QgY=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>225396.0</td>
      <td>1259</td>
      <td>Nas</td>
      <td>N. Jones、W. Adams、J. Lordan、D. Ingle</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>2A87tzfnJTSWqD7gIZHisolhe4DMdzkbd6LzO1KHjNs=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>1</td>
      <td>255512.0</td>
      <td>1019</td>
      <td>Soundway</td>
      <td>Kwadwo Donkoh</td>
      <td>no_data</td>
      <td>-1.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>3qm6XTZ6MOCU11x8FIVbAGH5l5uMkT3/ZalWG1oo2Gc=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>1</td>
      <td>187802.0</td>
      <td>1011</td>
      <td>Brett Young</td>
      <td>Brett Young| Kelly Archer| Justin Ebach</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member_music_df.info()</span><br></pre></td></tr></table></figure>

<h1 id="3-Data-Extract-Transform-and-Load-ETL"><a href="#3-Data-Extract-Transform-and-Load-ETL" class="headerlink" title="3. Data Extract, Transform and Load (ETL)"></a>3. Data Extract, Transform and Load (ETL)</h1><p>We can skip Step 2 if we just want to transform data directly</p>
<h2 id="3-1-Transformation-Function-for-Data-cleaning"><a href="#3-1-Transformation-Function-for-Data-cleaning" class="headerlink" title="3.1 Transformation Function for Data cleaning"></a>3.1 Transformation Function for Data cleaning</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import necessary packages here</span></span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">'ignore'</span>)</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"><span class="comment"># print(check_output(["ls", "../input"]).decode("utf8"))</span></span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">2020</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transform_data</span><span class="params">(data, song_df, members_df)</span>:</span></span><br><span class="line">    <span class="comment"># Merge song data with data set</span></span><br><span class="line">    data = data.merge(song_df,on=<span class="string">'song_id'</span>,how=<span class="string">"left"</span>, copy =<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># preprocess member data</span></span><br><span class="line">    members_df[<span class="string">"registration_init_time"</span>] = pd.to_datetime(members_df[<span class="string">"registration_init_time"</span>], format=<span class="string">"%Y%m%d"</span>)</span><br><span class="line">    members_df[<span class="string">"expiration_date"</span>] = pd.to_datetime(members_df[<span class="string">"expiration_date"</span>], format=<span class="string">"%Y%m%d"</span>)</span><br><span class="line">    members_df[<span class="string">"registration_init_day"</span>] = members_df[<span class="string">"registration_init_time"</span>].dt.day</span><br><span class="line">    members_df[<span class="string">"registration_init_month"</span>] = members_df[<span class="string">"registration_init_time"</span>].dt.month</span><br><span class="line">    members_df[<span class="string">"registration_init_year"</span>] = members_df[<span class="string">"registration_init_time"</span>].dt.year</span><br><span class="line">    members_df[<span class="string">"expiration_day"</span>] = members_df[<span class="string">"expiration_date"</span>].dt.day</span><br><span class="line">    members_df[<span class="string">"expiration_month"</span>] = members_df[<span class="string">"expiration_date"</span>].dt.month</span><br><span class="line">    members_df[<span class="string">"expiration_year"</span>] = members_df[<span class="string">"expiration_date"</span>].dt.year</span><br><span class="line">    members_df = members_df.drop(columns = [<span class="string">"registration_init_time"</span>, <span class="string">"expiration_date"</span>],axis=<span class="number">1</span>)    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># merge member data with dataset</span></span><br><span class="line">    data = data.merge(members_df,on=<span class="string">'msno'</span>,how=<span class="string">"left"</span>, copy=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Remove outliers of bd age </span></span><br><span class="line">    data[<span class="string">'bd'</span>].loc[(data[<span class="string">'bd'</span>]&lt;=<span class="number">0</span>) | (data[<span class="string">'bd'</span>]&gt;=<span class="number">100</span>)]= np.nan</span><br><span class="line"></span><br><span class="line">    categorical_ls = [<span class="string">'source_system_tab'</span>, <span class="string">'source_screen_name'</span>,<span class="string">'source_type'</span>,<span class="string">'genre_ids'</span>,<span class="string">'artist_name'</span>,<span class="string">'composer'</span>,</span><br><span class="line">     <span class="string">'lyricist'</span>,<span class="string">'gender'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    numerical_ls = [<span class="string">'song_length'</span>,<span class="string">'language'</span>,<span class="string">'bd'</span>]</span><br><span class="line">    <span class="comment"># Fill missing values </span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> numerical_ls:</span><br><span class="line">        data[index].fillna(data[index].median(), inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> categorical_ls:</span><br><span class="line">        data[index].fillna(<span class="string">"no_data"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count_items</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x ==<span class="string">"no_data"</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> sum(map(x.count, [<span class="string">'|'</span>, <span class="string">'/'</span>, <span class="string">'\\'</span>, <span class="string">';'</span>,<span class="string">','</span>])) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    data[<span class="string">'genre_count'</span>]=  data[<span class="string">'genre_ids'</span>].apply(count_items)</span><br><span class="line">    data[<span class="string">'composer_count'</span>]=  data[<span class="string">'composer'</span>].apply(count_items)</span><br><span class="line">    data[<span class="string">'lyricist_count'</span>]=  data[<span class="string">'lyricist'</span>].apply(count_items)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Convert object type to categorical type</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> data.columns:</span><br><span class="line">        <span class="keyword">if</span> data[c].dtype==<span class="string">'O'</span>:</span><br><span class="line">            data[c] = data[c].astype(<span class="string">"category"</span>,copy=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'id'</span> <span class="keyword">in</span> data.columns:</span><br><span class="line">        ids = data[<span class="string">'id'</span>]</span><br><span class="line">        data.drop([<span class="string">'id'</span>], inplace=<span class="literal">True</span>,axis=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ids =<span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> ids, data</span><br></pre></td></tr></table></figure>

<h2 id="3-2-Transform-the-composer-artist-lyricist-to-counts-as-new-features"><a href="#3-2-Transform-the-composer-artist-lyricist-to-counts-as-new-features" class="headerlink" title="3.2 Transform the composer, artist, lyricist to counts as new features"></a>3.2 Transform the composer, artist, lyricist to counts as new features</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root = <span class="string">'./kaggle/working/train/data/'</span></span><br><span class="line">train_df = pd.read_csv(root+ <span class="string">"train.csv"</span>)</span><br><span class="line">test_df = pd.read_csv(root+ <span class="string">"test.csv"</span>)</span><br><span class="line">song_df = pd.read_csv(root+ <span class="string">"songs.csv"</span>)</span><br><span class="line"><span class="comment"># song_extra_df = pd.read_csv(root+ "song_extra_info.csv")</span></span><br><span class="line">members_df = pd.read_csv(root+ <span class="string">"members.csv"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-1-Transform-train-set"><a href="#3-2-1-Transform-train-set" class="headerlink" title="3.2.1 Transform train set"></a>3.2.1 Transform train set</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_, train_data = transform_data(train_df, song_df, members_df)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y_train = train_data[<span class="string">'target'</span>]</span><br><span class="line">train_data.drop([<span class="string">'target'</span>], axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">X_train = train_data</span><br></pre></td></tr></table></figure>

<p>Transform the name of  composer, artist, lyricist to new features like counts, number of intersection of names </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transform_names_intersection</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="comment">#This function finds the intersection of names in composer, artist, lyricist</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_name_list</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="comment">#convert string to name list dataframe</span></span><br><span class="line">        strings = <span class="literal">None</span></span><br><span class="line">        strings = x.str.split(<span class="string">r"//|/|;|、|\| "</span>)</span><br><span class="line">        <span class="keyword">return</span> strings</span><br><span class="line">    </span><br><span class="line">    df = data[[<span class="string">"composer"</span>,<span class="string">"artist_name"</span>, <span class="string">"lyricist"</span>]].apply(check_name_list)</span><br><span class="line">    data[<span class="string">"composer_artist_intersect"</span>] =[len(set(a) &amp; set(b)) <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(df.composer, df.artist_name)] </span><br><span class="line">    data[<span class="string">"composer_lyricist_intersect"</span>] =[len(set(a) &amp; set(b)) <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(df.composer, df.lyricist)] </span><br><span class="line">    data[<span class="string">"artist_lyricist_intersect"</span>] =[len(set(a) &amp; set(b)) <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(df.artist_name, df.lyricist)] </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">    </span><br><span class="line">_ = transform_names_intersection(X_train)</span><br><span class="line">X_train.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
      <th>genre_count</th>
      <th>composer_count</th>
      <th>lyricist_count</th>
      <th>composer_artist_intersect</th>
      <th>composer_lyricist_intersect</th>
      <th>artist_lyricist_intersect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>BBzumQNXUHKdEBOB7mAJuzok+IJA1c2Ryg/yzTF6tik=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>206471.0</td>
      <td>359</td>
      <td>Bastille</td>
      <td>Dan Smith| Mark Crew</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>bhp/MpSNoqoxOIB+/l8WPqu6jldth4DIpCm3ayXnJqM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>284584.0</td>
      <td>1259</td>
      <td>Various Artists</td>
      <td>no_data</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>JNWfrrC7zNN7BdMpsISKa4Mw+xVJYNnxXh3/Epw7QgY=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>225396.0</td>
      <td>1259</td>
      <td>Nas</td>
      <td>N. Jones、W. Adams、J. Lordan、D. Ingle</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>2A87tzfnJTSWqD7gIZHisolhe4DMdzkbd6LzO1KHjNs=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>255512.0</td>
      <td>1019</td>
      <td>Soundway</td>
      <td>Kwadwo Donkoh</td>
      <td>no_data</td>
      <td>-1.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>3qm6XTZ6MOCU11x8FIVbAGH5l5uMkT3/ZalWG1oo2Gc=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>187802.0</td>
      <td>1011</td>
      <td>Brett Young</td>
      <td>Brett Young| Kelly Archer| Justin Ebach</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="3-2-2-Transform-Testset"><a href="#3-2-2-Transform-Testset" class="headerlink" title="3.2.2 Transform Testset"></a>3.2.2 Transform Testset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ids, test_data = transform_data(test_df, song_df, members_df)</span><br><span class="line">_ = transform_names_intersection(test_data)</span><br><span class="line">test_data.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
      <th>genre_count</th>
      <th>composer_count</th>
      <th>lyricist_count</th>
      <th>composer_artist_intersect</th>
      <th>composer_lyricist_intersect</th>
      <th>artist_lyricist_intersect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>V8ruy7SGk7tDm3zA51DPpn6qutt+vmKMBKa21dp54uM=</td>
      <td>WmHKgKMlp1lQMecNdNvDMkvIycZYHnFwDT72I5sIssc=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>224130.0</td>
      <td>458</td>
      <td>梁文音 (Rachel Liang)</td>
      <td>Qi Zheng Zhang</td>
      <td>no_data</td>
      <td>3.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>19</td>
      <td>2</td>
      <td>2016</td>
      <td>18</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>V8ruy7SGk7tDm3zA51DPpn6qutt+vmKMBKa21dp54uM=</td>
      <td>y/rsZ9DC7FwK5F2PK2D5mj+aOBUJAjuu3dZ14NgE0vM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>320470.0</td>
      <td>465</td>
      <td>林俊傑 (JJ Lin)</td>
      <td>林俊傑</td>
      <td>孫燕姿/易家揚</td>
      <td>3.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>19</td>
      <td>2</td>
      <td>2016</td>
      <td>18</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>/uQAlrAkaczV+nWCd2sPF2ekvXPRipV7q0l+gbLuxjw=</td>
      <td>8eZLFOdGVdXBSqoAv5nsLigeH2BvKXzTQYtUM53I0k4=</td>
      <td>discover</td>
      <td>no_data</td>
      <td>song-based-playlist</td>
      <td>315899.0</td>
      <td>2022</td>
      <td>Yu Takahashi (高橋優)</td>
      <td>Yu Takahashi</td>
      <td>Yu Takahashi</td>
      <td>17.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>4</td>
      <td>17</td>
      <td>11</td>
      <td>2016</td>
      <td>24</td>
      <td>11</td>
      <td>2016</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1a6oo/iXKatxQx4eS9zTVD+KlSVaAFbTIqVvwLC1Y0k=</td>
      <td>ztCf8thYsS4YN3GcIL/bvoxLm/T5mYBVKOO4C9NiVfQ=</td>
      <td>radio</td>
      <td>Radio</td>
      <td>radio</td>
      <td>285210.0</td>
      <td>465</td>
      <td>U2</td>
      <td>The Edge| Adam Clayton| Larry Mullen| Jr.</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>3</td>
      <td>30.0</td>
      <td>male</td>
      <td>9</td>
      <td>25</td>
      <td>7</td>
      <td>2007</td>
      <td>30</td>
      <td>4</td>
      <td>2017</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1a6oo/iXKatxQx4eS9zTVD+KlSVaAFbTIqVvwLC1Y0k=</td>
      <td>MKVMpslKcQhMaFEgcEQhEfi5+RZhMYlU3eRDpySrH8Y=</td>
      <td>radio</td>
      <td>Radio</td>
      <td>radio</td>
      <td>197590.0</td>
      <td>873</td>
      <td>Yoga Mr Sound</td>
      <td>Neuromancer</td>
      <td>no_data</td>
      <td>-1.0</td>
      <td>3</td>
      <td>30.0</td>
      <td>male</td>
      <td>9</td>
      <td>25</td>
      <td>7</td>
      <td>2007</td>
      <td>30</td>
      <td>4</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
      <th>genre_count</th>
      <th>composer_count</th>
      <th>lyricist_count</th>
      <th>composer_artist_intersect</th>
      <th>composer_lyricist_intersect</th>
      <th>artist_lyricist_intersect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>BBzumQNXUHKdEBOB7mAJuzok+IJA1c2Ryg/yzTF6tik=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>206471.0</td>
      <td>359</td>
      <td>Bastille</td>
      <td>Dan Smith| Mark Crew</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>bhp/MpSNoqoxOIB+/l8WPqu6jldth4DIpCm3ayXnJqM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>284584.0</td>
      <td>1259</td>
      <td>Various Artists</td>
      <td>no_data</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>JNWfrrC7zNN7BdMpsISKa4Mw+xVJYNnxXh3/Epw7QgY=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>225396.0</td>
      <td>1259</td>
      <td>Nas</td>
      <td>N. Jones、W. Adams、J. Lordan、D. Ingle</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Xumu+NIjS6QYVxDS4/t3SawvJ7viT9hPKXmf0RtLNx8=</td>
      <td>2A87tzfnJTSWqD7gIZHisolhe4DMdzkbd6LzO1KHjNs=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-playlist</td>
      <td>255512.0</td>
      <td>1019</td>
      <td>Soundway</td>
      <td>Kwadwo Donkoh</td>
      <td>no_data</td>
      <td>-1.0</td>
      <td>13</td>
      <td>24.0</td>
      <td>female</td>
      <td>9</td>
      <td>25</td>
      <td>5</td>
      <td>2011</td>
      <td>11</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FGtllVqz18RPiwJj/edr2gV78zirAiY/9SmYvia+kCg=</td>
      <td>3qm6XTZ6MOCU11x8FIVbAGH5l5uMkT3/ZalWG1oo2Gc=</td>
      <td>explore</td>
      <td>Explore</td>
      <td>online-playlist</td>
      <td>187802.0</td>
      <td>1011</td>
      <td>Brett Young</td>
      <td>Brett Young| Kelly Archer| Justin Ebach</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>2</td>
      <td>1</td>
      <td>2012</td>
      <td>5</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_data.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
      <th>genre_count</th>
      <th>composer_count</th>
      <th>lyricist_count</th>
      <th>composer_artist_intersect</th>
      <th>composer_lyricist_intersect</th>
      <th>artist_lyricist_intersect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>V8ruy7SGk7tDm3zA51DPpn6qutt+vmKMBKa21dp54uM=</td>
      <td>WmHKgKMlp1lQMecNdNvDMkvIycZYHnFwDT72I5sIssc=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>224130.0</td>
      <td>458</td>
      <td>梁文音 (Rachel Liang)</td>
      <td>Qi Zheng Zhang</td>
      <td>no_data</td>
      <td>3.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>19</td>
      <td>2</td>
      <td>2016</td>
      <td>18</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>V8ruy7SGk7tDm3zA51DPpn6qutt+vmKMBKa21dp54uM=</td>
      <td>y/rsZ9DC7FwK5F2PK2D5mj+aOBUJAjuu3dZ14NgE0vM=</td>
      <td>my library</td>
      <td>Local playlist more</td>
      <td>local-library</td>
      <td>320470.0</td>
      <td>465</td>
      <td>林俊傑 (JJ Lin)</td>
      <td>林俊傑</td>
      <td>孫燕姿/易家揚</td>
      <td>3.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>7</td>
      <td>19</td>
      <td>2</td>
      <td>2016</td>
      <td>18</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>/uQAlrAkaczV+nWCd2sPF2ekvXPRipV7q0l+gbLuxjw=</td>
      <td>8eZLFOdGVdXBSqoAv5nsLigeH2BvKXzTQYtUM53I0k4=</td>
      <td>discover</td>
      <td>no_data</td>
      <td>song-based-playlist</td>
      <td>315899.0</td>
      <td>2022</td>
      <td>Yu Takahashi (高橋優)</td>
      <td>Yu Takahashi</td>
      <td>Yu Takahashi</td>
      <td>17.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>no_data</td>
      <td>4</td>
      <td>17</td>
      <td>11</td>
      <td>2016</td>
      <td>24</td>
      <td>11</td>
      <td>2016</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1a6oo/iXKatxQx4eS9zTVD+KlSVaAFbTIqVvwLC1Y0k=</td>
      <td>ztCf8thYsS4YN3GcIL/bvoxLm/T5mYBVKOO4C9NiVfQ=</td>
      <td>radio</td>
      <td>Radio</td>
      <td>radio</td>
      <td>285210.0</td>
      <td>465</td>
      <td>U2</td>
      <td>The Edge| Adam Clayton| Larry Mullen| Jr.</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>3</td>
      <td>30.0</td>
      <td>male</td>
      <td>9</td>
      <td>25</td>
      <td>7</td>
      <td>2007</td>
      <td>30</td>
      <td>4</td>
      <td>2017</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1a6oo/iXKatxQx4eS9zTVD+KlSVaAFbTIqVvwLC1Y0k=</td>
      <td>MKVMpslKcQhMaFEgcEQhEfi5+RZhMYlU3eRDpySrH8Y=</td>
      <td>radio</td>
      <td>Radio</td>
      <td>radio</td>
      <td>197590.0</td>
      <td>873</td>
      <td>Yoga Mr Sound</td>
      <td>Neuromancer</td>
      <td>no_data</td>
      <td>-1.0</td>
      <td>3</td>
      <td>30.0</td>
      <td>male</td>
      <td>9</td>
      <td>25</td>
      <td>7</td>
      <td>2007</td>
      <td>30</td>
      <td>4</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="3-2-3-Split-validation-set-and-trainset"><a href="#3-2-3-Split-validation-set-and-trainset" class="headerlink" title="3.2.3 Split validation set and trainset"></a>3.2.3 Split validation set and trainset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> StratifiedShuffleSplit, StratifiedKFold, train_test_split</span><br><span class="line">ss_split = StratifiedShuffleSplit(n_splits=<span class="number">1</span>, test_size=<span class="number">0.2</span>, random_state=<span class="number">2021</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Split training set and testing set</span></span><br><span class="line">train_index, valid_index ,test_index = <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> train_i, test_i <span class="keyword">in</span> ss_split.split(np.zeros(y_train.shape) ,y_train):</span><br><span class="line">    train_index = train_i</span><br><span class="line">    test_index = test_i</span><br><span class="line">    print(train_index.shape, test_index.shape)</span><br></pre></td></tr></table></figure>

<pre><code>(5901934,) (1475484,)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">X_validset = X_train.iloc[test_index]</span><br><span class="line">y_validset = y_train.iloc[test_index].values</span><br><span class="line"></span><br><span class="line">X_trainset = X_train.iloc[train_index]</span><br><span class="line">y_trainset = y_train.iloc[train_index].values</span><br><span class="line"></span><br><span class="line"><span class="comment">#delete dataframes to save space</span></span><br><span class="line"><span class="keyword">del</span> X_train, y_train</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_trainset.info()</span><br></pre></td></tr></table></figure>

<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 5901934 entries, 7066318 to 5275539
Data columns (total 27 columns):
 #   Column                       Dtype   
---  ------                       -----   
 0   msno                         category
 1   song_id                      category
 2   source_system_tab            category
 3   source_screen_name           category
 4   source_type                  category
 5   song_length                  float64 
 6   genre_ids                    category
 7   artist_name                  category
 8   composer                     category
 9   lyricist                     category
 10  language                     float64 
 11  city                         int64   
 12  bd                           float64 
 13  gender                       category
 14  registered_via               int64   
 15  registration_init_day        int64   
 16  registration_init_month      int64   
 17  registration_init_year       int64   
 18  expiration_day               int64   
 19  expiration_month             int64   
 20  expiration_year              int64   
 21  genre_count                  int64   
 22  composer_count               int64   
 23  lyricist_count               int64   
 24  composer_artist_intersect    int64   
 25  composer_lyricist_intersect  int64   
 26  artist_lyricist_intersect    int64   
dtypes: category(10), float64(3), int64(14)
memory usage: 966.0 MB
</code></pre>
<h1 id="4-LGBM-Modeling"><a href="#4-LGBM-Modeling" class="headerlink" title="4. LGBM Modeling"></a>4. LGBM Modeling</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br><span class="line">train_set = lgb.Dataset(X_trainset, y_trainset)</span><br><span class="line">valid_set = lgb.Dataset(X_validset, y_validset)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_leaves = <span class="number">110</span></span><br><span class="line">max_depths = [<span class="number">10</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">25</span>,<span class="number">30</span>]</span><br></pre></td></tr></table></figure>

<h2 id="5-Model-Training-and-Validation-on-LGBM-models"><a href="#5-Model-Training-and-Validation-on-LGBM-models" class="headerlink" title="5.Model Training and Validation on LGBM models"></a>5.Model Training and Validation on LGBM models</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">        <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">        <span class="string">'metric'</span>: <span class="string">'binary_logloss'</span>,</span><br><span class="line">        <span class="string">'boosting'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">        <span class="string">'learning_rate'</span>: <span class="number">0.3</span> ,</span><br><span class="line">        <span class="string">'verbose'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">'num_leaves'</span>: num_leaves,</span><br><span class="line">        <span class="string">'bagging_fraction'</span>: <span class="number">0.95</span>,</span><br><span class="line">        <span class="string">'bagging_freq'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'bagging_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'feature_fraction'</span>: <span class="number">0.9</span>,</span><br><span class="line">        <span class="string">'feature_fraction_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'max_bin'</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">'max_depth'</span>: max_depths[<span class="number">0</span>],</span><br><span class="line">        <span class="string">'num_rounds'</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">'metric'</span> : <span class="string">'auc'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">%time model_f1 = lgb.train(params, train_set=train_set,  valid_sets=valid_set, verbose_eval=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<pre><code>[5]    valid_0&#39;s auc: 0.710928
[10]    valid_0&#39;s auc: 0.723954
[15]    valid_0&#39;s auc: 0.731661
[20]    valid_0&#39;s auc: 0.736653
[25]    valid_0&#39;s auc: 0.740424
[30]    valid_0&#39;s auc: 0.744678
[35]    valid_0&#39;s auc: 0.749056
[40]    valid_0&#39;s auc: 0.752277
[45]    valid_0&#39;s auc: 0.754501
[50]    valid_0&#39;s auc: 0.756448
[55]    valid_0&#39;s auc: 0.758097
[60]    valid_0&#39;s auc: 0.75991
[65]    valid_0&#39;s auc: 0.761418
[70]    valid_0&#39;s auc: 0.762683
[75]    valid_0&#39;s auc: 0.764243
[80]    valid_0&#39;s auc: 0.765646
[85]    valid_0&#39;s auc: 0.766883
[90]    valid_0&#39;s auc: 0.767921
[95]    valid_0&#39;s auc: 0.769111
[100]    valid_0&#39;s auc: 0.770006
[105]    valid_0&#39;s auc: 0.770934
[110]    valid_0&#39;s auc: 0.772012
[115]    valid_0&#39;s auc: 0.772747
[120]    valid_0&#39;s auc: 0.773835
[125]    valid_0&#39;s auc: 0.774486
[130]    valid_0&#39;s auc: 0.775258
[135]    valid_0&#39;s auc: 0.775887
[140]    valid_0&#39;s auc: 0.776838
[145]    valid_0&#39;s auc: 0.777587
[150]    valid_0&#39;s auc: 0.778113
[155]    valid_0&#39;s auc: 0.778714
[160]    valid_0&#39;s auc: 0.77929
[165]    valid_0&#39;s auc: 0.779884
[170]    valid_0&#39;s auc: 0.780354
[175]    valid_0&#39;s auc: 0.781586
[180]    valid_0&#39;s auc: 0.782002
[185]    valid_0&#39;s auc: 0.782517
[190]    valid_0&#39;s auc: 0.783075
[195]    valid_0&#39;s auc: 0.783496
[200]    valid_0&#39;s auc: 0.784083
CPU times: user 8min 20s, sys: 3 s, total: 8min 23s
Wall time: 4min 25s
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">        <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">        <span class="string">'metric'</span>: <span class="string">'binary_logloss'</span>,</span><br><span class="line">        <span class="string">'boosting'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">        <span class="string">'learning_rate'</span>: <span class="number">0.3</span> ,</span><br><span class="line">        <span class="string">'verbose'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">'num_leaves'</span>: num_leaves,</span><br><span class="line">        <span class="string">'bagging_fraction'</span>: <span class="number">0.95</span>,</span><br><span class="line">        <span class="string">'bagging_freq'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'bagging_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'feature_fraction'</span>: <span class="number">0.9</span>,</span><br><span class="line">        <span class="string">'feature_fraction_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'max_bin'</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">'max_depth'</span>: max_depths[<span class="number">1</span>],</span><br><span class="line">        <span class="string">'num_rounds'</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">'metric'</span> : <span class="string">'auc'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">%time model_f2 = lgb.train(params, train_set=train_set,  valid_sets=valid_set, verbose_eval=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<pre><code>[5]    valid_0&#39;s auc: 0.727917
[10]    valid_0&#39;s auc: 0.742629
[15]    valid_0&#39;s auc: 0.74811
[20]    valid_0&#39;s auc: 0.754257
[25]    valid_0&#39;s auc: 0.758256
[30]    valid_0&#39;s auc: 0.76119
[35]    valid_0&#39;s auc: 0.763674
[40]    valid_0&#39;s auc: 0.76626
[45]    valid_0&#39;s auc: 0.7681
[50]    valid_0&#39;s auc: 0.769933
[55]    valid_0&#39;s auc: 0.771692
[60]    valid_0&#39;s auc: 0.773121
[65]    valid_0&#39;s auc: 0.774693
[70]    valid_0&#39;s auc: 0.776149
[75]    valid_0&#39;s auc: 0.777157
[80]    valid_0&#39;s auc: 0.778674
[85]    valid_0&#39;s auc: 0.780085
[90]    valid_0&#39;s auc: 0.78098
[95]    valid_0&#39;s auc: 0.782016
[100]    valid_0&#39;s auc: 0.783028
[105]    valid_0&#39;s auc: 0.783782
[110]    valid_0&#39;s auc: 0.784875
[115]    valid_0&#39;s auc: 0.785417
[120]    valid_0&#39;s auc: 0.786042
[125]    valid_0&#39;s auc: 0.78665
[130]    valid_0&#39;s auc: 0.787237
[135]    valid_0&#39;s auc: 0.787897
[140]    valid_0&#39;s auc: 0.788426
[145]    valid_0&#39;s auc: 0.788904
[150]    valid_0&#39;s auc: 0.789517
[155]    valid_0&#39;s auc: 0.78991
[160]    valid_0&#39;s auc: 0.790561
[165]    valid_0&#39;s auc: 0.791319
[170]    valid_0&#39;s auc: 0.791855
[175]    valid_0&#39;s auc: 0.792519
[180]    valid_0&#39;s auc: 0.792922
[185]    valid_0&#39;s auc: 0.793727
[190]    valid_0&#39;s auc: 0.794061
[195]    valid_0&#39;s auc: 0.794584
[200]    valid_0&#39;s auc: 0.794811
CPU times: user 9min 27s, sys: 1.28 s, total: 9min 28s
Wall time: 4min 51s
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">        <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">        <span class="string">'metric'</span>: <span class="string">'binary_logloss'</span>,</span><br><span class="line">        <span class="string">'boosting'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">        <span class="string">'learning_rate'</span>: <span class="number">0.3</span> ,</span><br><span class="line">        <span class="string">'verbose'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">'num_leaves'</span>: num_leaves,</span><br><span class="line">        <span class="string">'bagging_fraction'</span>: <span class="number">0.95</span>,</span><br><span class="line">        <span class="string">'bagging_freq'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'bagging_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'feature_fraction'</span>: <span class="number">0.9</span>,</span><br><span class="line">        <span class="string">'feature_fraction_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'max_bin'</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">'max_depth'</span>: max_depths[<span class="number">2</span>],</span><br><span class="line">        <span class="string">'num_rounds'</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">'metric'</span> : <span class="string">'auc'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">%time model_f3 = lgb.train(params, train_set=train_set,  valid_sets=valid_set, verbose_eval=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<pre><code>[5]    valid_0&#39;s auc: 0.734133
[10]    valid_0&#39;s auc: 0.749742
[15]    valid_0&#39;s auc: 0.75615
[20]    valid_0&#39;s auc: 0.761276
[25]    valid_0&#39;s auc: 0.766358
[30]    valid_0&#39;s auc: 0.769127
[35]    valid_0&#39;s auc: 0.771531
[40]    valid_0&#39;s auc: 0.773761
[45]    valid_0&#39;s auc: 0.775287
[50]    valid_0&#39;s auc: 0.777329
[55]    valid_0&#39;s auc: 0.779154
[60]    valid_0&#39;s auc: 0.780391
[65]    valid_0&#39;s auc: 0.782072
[70]    valid_0&#39;s auc: 0.783786
[75]    valid_0&#39;s auc: 0.784989
[80]    valid_0&#39;s auc: 0.785685
[85]    valid_0&#39;s auc: 0.786851
[90]    valid_0&#39;s auc: 0.787643
[95]    valid_0&#39;s auc: 0.788312
[100]    valid_0&#39;s auc: 0.789305
[105]    valid_0&#39;s auc: 0.790256
[110]    valid_0&#39;s auc: 0.791037
[115]    valid_0&#39;s auc: 0.79177
[120]    valid_0&#39;s auc: 0.792466
[125]    valid_0&#39;s auc: 0.792988
[130]    valid_0&#39;s auc: 0.793478
[135]    valid_0&#39;s auc: 0.793961
[140]    valid_0&#39;s auc: 0.794871
[145]    valid_0&#39;s auc: 0.795495
[150]    valid_0&#39;s auc: 0.795952
[155]    valid_0&#39;s auc: 0.796269
[160]    valid_0&#39;s auc: 0.796888
[165]    valid_0&#39;s auc: 0.797808
[170]    valid_0&#39;s auc: 0.7982
[175]    valid_0&#39;s auc: 0.798443
[180]    valid_0&#39;s auc: 0.798959
[185]    valid_0&#39;s auc: 0.799395
[190]    valid_0&#39;s auc: 0.799687
[195]    valid_0&#39;s auc: 0.800153
[200]    valid_0&#39;s auc: 0.800409
CPU times: user 11min 16s, sys: 1.54 s, total: 11min 17s
Wall time: 5min 47s
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">        <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">        <span class="string">'metric'</span>: <span class="string">'binary_logloss'</span>,</span><br><span class="line">        <span class="string">'boosting'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">        <span class="string">'learning_rate'</span>: <span class="number">0.3</span> ,</span><br><span class="line">        <span class="string">'verbose'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">'num_leaves'</span>: num_leaves,</span><br><span class="line">        <span class="string">'bagging_fraction'</span>: <span class="number">0.95</span>,</span><br><span class="line">        <span class="string">'bagging_freq'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'bagging_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'feature_fraction'</span>: <span class="number">0.9</span>,</span><br><span class="line">        <span class="string">'feature_fraction_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'max_bin'</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">'max_depth'</span>: max_depths[<span class="number">3</span>],</span><br><span class="line">        <span class="string">'num_rounds'</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">'metric'</span> : <span class="string">'auc'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">%time model_f4 = lgb.train(params, train_set=train_set,  valid_sets=valid_set, verbose_eval=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<pre><code>[5]    valid_0&#39;s auc: 0.736351
[10]    valid_0&#39;s auc: 0.754592
[15]    valid_0&#39;s auc: 0.76195
[20]    valid_0&#39;s auc: 0.766405
[25]    valid_0&#39;s auc: 0.770538
[30]    valid_0&#39;s auc: 0.772566
[35]    valid_0&#39;s auc: 0.775789
[40]    valid_0&#39;s auc: 0.777994
[45]    valid_0&#39;s auc: 0.779658
[50]    valid_0&#39;s auc: 0.781394
[55]    valid_0&#39;s auc: 0.783194
[60]    valid_0&#39;s auc: 0.784808
[65]    valid_0&#39;s auc: 0.786109
[70]    valid_0&#39;s auc: 0.787265
[75]    valid_0&#39;s auc: 0.788079
[80]    valid_0&#39;s auc: 0.789109
[85]    valid_0&#39;s auc: 0.78986
[90]    valid_0&#39;s auc: 0.790613
[95]    valid_0&#39;s auc: 0.791347
[100]    valid_0&#39;s auc: 0.79209
[105]    valid_0&#39;s auc: 0.793348
[110]    valid_0&#39;s auc: 0.79409
[115]    valid_0&#39;s auc: 0.794754
[120]    valid_0&#39;s auc: 0.795411
[125]    valid_0&#39;s auc: 0.795866
[130]    valid_0&#39;s auc: 0.796604
[135]    valid_0&#39;s auc: 0.79781
[140]    valid_0&#39;s auc: 0.798172
[145]    valid_0&#39;s auc: 0.798723
[150]    valid_0&#39;s auc: 0.799132
[155]    valid_0&#39;s auc: 0.799488
[160]    valid_0&#39;s auc: 0.800115
[165]    valid_0&#39;s auc: 0.800509
[170]    valid_0&#39;s auc: 0.800784
[175]    valid_0&#39;s auc: 0.801118
[180]    valid_0&#39;s auc: 0.801448
[185]    valid_0&#39;s auc: 0.801882
[190]    valid_0&#39;s auc: 0.8022
[195]    valid_0&#39;s auc: 0.802578
[200]    valid_0&#39;s auc: 0.802953
CPU times: user 12min 34s, sys: 1.44 s, total: 12min 36s
Wall time: 6min 27s
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">        <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">        <span class="string">'metric'</span>: <span class="string">'binary_logloss'</span>,</span><br><span class="line">        <span class="string">'boosting'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">        <span class="string">'learning_rate'</span>: <span class="number">0.3</span> ,</span><br><span class="line">        <span class="string">'verbose'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">'num_leaves'</span>: num_leaves,</span><br><span class="line">        <span class="string">'bagging_fraction'</span>: <span class="number">0.95</span>,</span><br><span class="line">        <span class="string">'bagging_freq'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'bagging_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'feature_fraction'</span>: <span class="number">0.9</span>,</span><br><span class="line">        <span class="string">'feature_fraction_seed'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'max_bin'</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="string">'max_depth'</span>: max_depths[<span class="number">4</span>],</span><br><span class="line">        <span class="string">'num_rounds'</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">'metric'</span> : <span class="string">'auc'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">%time model_f5 = lgb.train(params, train_set=train_set,  valid_sets=valid_set, verbose_eval=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<pre><code>[5]    valid_0&#39;s auc: 0.739442
[10]    valid_0&#39;s auc: 0.757442
[15]    valid_0&#39;s auc: 0.766439
[20]    valid_0&#39;s auc: 0.77132
[25]    valid_0&#39;s auc: 0.774735
[30]    valid_0&#39;s auc: 0.777071
[35]    valid_0&#39;s auc: 0.779247
[40]    valid_0&#39;s auc: 0.781616
[45]    valid_0&#39;s auc: 0.782953
[50]    valid_0&#39;s auc: 0.785154
[55]    valid_0&#39;s auc: 0.786877
[60]    valid_0&#39;s auc: 0.787993
[65]    valid_0&#39;s auc: 0.788839
[70]    valid_0&#39;s auc: 0.790254
[75]    valid_0&#39;s auc: 0.791088
[80]    valid_0&#39;s auc: 0.792455
[85]    valid_0&#39;s auc: 0.79365
[90]    valid_0&#39;s auc: 0.794445
[95]    valid_0&#39;s auc: 0.795072
[100]    valid_0&#39;s auc: 0.796276
[105]    valid_0&#39;s auc: 0.797737
[110]    valid_0&#39;s auc: 0.798265
[115]    valid_0&#39;s auc: 0.799021
[120]    valid_0&#39;s auc: 0.799964
[125]    valid_0&#39;s auc: 0.800469
[130]    valid_0&#39;s auc: 0.801445
[135]    valid_0&#39;s auc: 0.801851
[140]    valid_0&#39;s auc: 0.802299
[145]    valid_0&#39;s auc: 0.802599
[150]    valid_0&#39;s auc: 0.803381
[155]    valid_0&#39;s auc: 0.803696
[160]    valid_0&#39;s auc: 0.803926
[165]    valid_0&#39;s auc: 0.80443
[170]    valid_0&#39;s auc: 0.804694
[175]    valid_0&#39;s auc: 0.804897
[180]    valid_0&#39;s auc: 0.80524
[185]    valid_0&#39;s auc: 0.805486
[190]    valid_0&#39;s auc: 0.805804
[195]    valid_0&#39;s auc: 0.806059
[200]    valid_0&#39;s auc: 0.806525
CPU times: user 14min 7s, sys: 1.66 s, total: 14min 9s
Wall time: 7min 14s
</code></pre>
<h2 id="6-Model-Evaluation-on-LGBM-models"><a href="#6-Model-Evaluation-on-LGBM-models" class="headerlink" title="6.Model Evaluation on LGBM models"></a>6.Model Evaluation on LGBM models</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluation_lgbm</span><span class="params">(model, X =X_validset , y= y_validset)</span>:</span></span><br><span class="line">    </span><br><span class="line">    out = model.predict(X)</span><br><span class="line">    preds = out&gt;=<span class="number">0.5</span></span><br><span class="line">    acc = accuracy_score(preds, y)</span><br><span class="line">    print(<span class="string">"Evaluation acc:"</span>, acc)</span><br><span class="line">    <span class="keyword">return</span> acc</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_validset.shape</span><br></pre></td></tr></table></figure>




<pre><code>(1475484, 27)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acc_1 = evaluation_lgbm(model_f1)</span><br><span class="line">acc_2 = evaluation_lgbm(model_f2)</span><br><span class="line">acc_3 = evaluation_lgbm(model_f3)</span><br><span class="line">acc_4 = evaluation_lgbm(model_f4)</span><br><span class="line">acc_5 = evaluation_lgbm(model_f5)</span><br></pre></td></tr></table></figure>

<pre><code>Evaluation acc: 0.709764389176704
Evaluation acc: 0.719106408473423
Evaluation acc: 0.7236893114395005
Evaluation acc: 0.7258221708944319
Evaluation acc: 0.728842196865571
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eval_df = pd.DataFrame(&#123;<span class="string">"Lgbm with max_depth"</span>:max_depths,<span class="string">"Validation Accuracy"</span>:[acc_1,acc_2,acc_3,acc_4,acc_5]&#125;)</span><br><span class="line">eval_df</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Lgbm with max_depth</th>
      <th>Validation Accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10</td>
      <td>0.709764</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15</td>
      <td>0.719106</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>0.723689</td>
    </tr>
    <tr>
      <th>3</th>
      <td>25</td>
      <td>0.725822</td>
    </tr>
    <tr>
      <th>4</th>
      <td>30</td>
      <td>0.728842</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="Create-Submission-Files"><a href="#Create-Submission-Files" class="headerlink" title="Create Submission Files"></a>Create Submission Files</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">models = [model_f1,model_f2,model_f3,model_f4,model_f5]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(models)):</span><br><span class="line">  preds_test = models[i].predict(test_data)</span><br><span class="line">  submission = pd.DataFrame()</span><br><span class="line">  submission[<span class="string">'id'</span>] = ids</span><br><span class="line">  submission[<span class="string">'target'</span>] = preds_test</span><br><span class="line">  submission.to_csv(root + <span class="string">'submission_lgbm_model_'</span>+ str(i)+<span class="string">'.csv.gz'</span>, compression = <span class="string">'gzip'</span>, index=<span class="literal">False</span>, float_format = <span class="string">'%.5f'</span>)</span><br><span class="line">  print(<span class="string">"Predictions from model "</span>,i,<span class="string">": "</span>,preds_test)</span><br></pre></td></tr></table></figure>

<pre><code>Predictions from model  0 :  [0.47177512 0.48584262 0.19651648 ... 0.39917036 0.30263348 0.36468783]
Predictions from model  1 :  [0.45280296 0.55415074 0.17824637 ... 0.41500494 0.30757934 0.34520384]
Predictions from model  2 :  [0.39847416 0.48724786 0.15954141 ... 0.38293317 0.27657349 0.28451098]
Predictions from model  3 :  [0.3825275  0.39659855 0.15904321 ... 0.3515784  0.21812496 0.28995803]
Predictions from model  4 :  [0.3951268  0.45704878 0.14609333 ... 0.35033303 0.23065677 0.2885925 ]
</code></pre>
<h2 id="Scores-from-kaggle-test-set"><a href="#Scores-from-kaggle-test-set" class="headerlink" title="Scores from kaggle test set"></a>Scores from kaggle test set</h2><table>
<thead>
<tr>
<th>Model name</th>
<th>private score</th>
<th>public score</th>
</tr>
</thead>
<tbody><tr>
<td>LGBM Boosting Machine Model 4</td>
<td>0.67423</td>
<td>0.67256</td>
</tr>
<tr>
<td>LGBM Boosting Machine Model 3</td>
<td>0.67435</td>
<td>0.67241</td>
</tr>
<tr>
<td>LGBM Boosting Machine Model 2</td>
<td>0.67416</td>
<td>0.67208</td>
</tr>
<tr>
<td>LGBM Boosting Machine Model 1</td>
<td>0.67416</td>
<td>0.67188</td>
</tr>
<tr>
<td>LGBM Boosting Machine Model 0</td>
<td>0.67206</td>
<td>0.66940</td>
</tr>
</tbody></table>
<h1 id="4-Wide-amp-Depth-neural-network-model"><a href="#4-Wide-amp-Depth-neural-network-model" class="headerlink" title="4. Wide &amp; Depth neural network model"></a>4. Wide &amp; Depth neural network model</h1><h3 id="Wide-and-Deep-model（2-branches–-gt-merge-two-branches–-gt-main-branch）"><a href="#Wide-and-Deep-model（2-branches–-gt-merge-two-branches–-gt-main-branch）" class="headerlink" title="Wide and Deep model（2 branches–&gt;merge two branches–&gt;main branch）"></a>Wide and Deep model（2 branches–&gt;merge two branches–&gt;main branch）</h3><p><img src="https://github.com/LianxinGao/kaggle/blob/master/pics/net.jpg?raw=true" alt="网络图"></p>
<p>This model converts categorical attributes into dense vectors using embedding network in neural network, which enable us to reduce the dimension of categorical data and extract main features like PCA.</p>
<p>Then it combines dense embedded vectors with numerical data for features selection and classifcation in the main branch.</p>
<p>The output is possibility that user may repeat listening to the music</p>
<h3 id="Label-Encoding-for-categorical-data"><a href="#Label-Encoding-for-categorical-data" class="headerlink" title="Label Encoding for categorical data"></a>Label Encoding for categorical data</h3><p>Convert categorical data into numerical labels before using embedding</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line">categorical_ls1 = [<span class="string">'source_system_tab'</span>, <span class="string">'source_screen_name'</span>,<span class="string">'source_type'</span>,<span class="string">'genre_ids'</span>,<span class="string">'gender'</span>]</span><br><span class="line">categorical_ls2 = [<span class="string">'artist_name'</span>,<span class="string">'composer'</span>, <span class="string">'lyricist'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">numerical_ls = [<span class="string">'song_length'</span>,<span class="string">'language'</span>,<span class="string">'bd'</span>,<span class="string">"registration_init_year"</span>,</span><br><span class="line">                <span class="string">"expiration_day"</span>,<span class="string">"expiration_month"</span>,<span class="string">"expiration_year"</span>,</span><br><span class="line">                <span class="string">"genre_count"</span>,<span class="string">"composer_count"</span>,<span class="string">"lyricist_count"</span>,<span class="string">"composer_artist_intersect"</span>,</span><br><span class="line">                <span class="string">"composer_lyricist_intersect"</span>,<span class="string">"artist_lyricist_intersect"</span>]</span><br><span class="line"></span><br><span class="line">max_values = &#123;&#125;</span><br><span class="line"><span class="comment"># labelencoders = &#123;&#125;</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> categorical_ls1:</span><br><span class="line">    print(col)</span><br><span class="line">    lbl = LabelEncoder()</span><br><span class="line">    df = pd.concat([X_trainset[col], X_validset[col],test_data[col]],ignore_index=<span class="literal">True</span>)</span><br><span class="line">    lbl.fit(df)</span><br><span class="line">    df = lbl.transform(list(df.values.astype(<span class="string">'str'</span>,copy=<span class="literal">False</span>)))</span><br><span class="line">    X_trainset[col] = lbl.transform(list(X_trainset[col].values.astype(<span class="string">'str'</span>,copy=<span class="literal">False</span>)))</span><br><span class="line">    X_validset[col] = lbl.transform(list(X_validset[col].values.astype(<span class="string">'str'</span>,copy=<span class="literal">False</span>)))</span><br><span class="line">    test_data[col] = lbl.transform(list(test_data[col].values.astype(<span class="string">'str'</span>,copy=<span class="literal">False</span>)))</span><br><span class="line">    max_values[col] = df.max() + <span class="number">2</span> <span class="comment">#set the range of embedding input larger</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute embedding dimensions</span></span><br><span class="line">emb_dims1 = []</span><br><span class="line">emb_dims2 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> categorical_ls1:</span><br><span class="line">    emb_dims1.append((max_values[i], min((max_values[i]+<span class="number">1</span>)//<span class="number">2</span>, <span class="number">50</span>)))</span><br></pre></td></tr></table></figure>

<pre><code>source_system_tab
source_screen_name
source_type
genre_ids
gender
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># max_values</span></span><br><span class="line">X_trainset.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
      <th>genre_count</th>
      <th>composer_count</th>
      <th>lyricist_count</th>
      <th>composer_artist_intersect</th>
      <th>composer_lyricist_intersect</th>
      <th>artist_lyricist_intersect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7066318</th>
      <td>BQ7nOoOUipsqjOBANK+ilA8F7TVaOHSI8gVPWElXsuI=</td>
      <td>FaTUlIiCh/6sEOasPm1vgIk9XqavgSGgRGYuOkzTF0o=</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>203520.0</td>
      <td>364</td>
      <td>田馥甄 (Hebe)</td>
      <td>倪子岡</td>
      <td>李格弟</td>
      <td>3.0</td>
      <td>5</td>
      <td>25.0</td>
      <td>0</td>
      <td>9</td>
      <td>2</td>
      <td>9</td>
      <td>2006</td>
      <td>11</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1471565</th>
      <td>Ul+UpO5PxuhCn040AK8gzR1A/mE/k3KbL13gO7Uc4Ts=</td>
      <td>+SstqMwhQPBQFTPBhLKPT642IiBDXzZFwlzsLl4cGXo=</td>
      <td>3</td>
      <td>8</td>
      <td>3</td>
      <td>283846.0</td>
      <td>371</td>
      <td>陳勢安 (Andrew Tan)</td>
      <td>覃嘉健</td>
      <td>馬嵩惟</td>
      <td>3.0</td>
      <td>13</td>
      <td>47.0</td>
      <td>0</td>
      <td>9</td>
      <td>1</td>
      <td>2</td>
      <td>2006</td>
      <td>30</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6176886</th>
      <td>sa6oKy94c62R5Eq0YHkNzZrJSo9j5E7JGjTDHnYRKqs=</td>
      <td>K6fBQxiNhgWazjXrZUGlZIm9ltT4o+Vq19sWmZRdAhg=</td>
      <td>2</td>
      <td>12</td>
      <td>2</td>
      <td>296960.0</td>
      <td>371</td>
      <td>蔡依林 (Jolin Tsai)</td>
      <td>郭子</td>
      <td>鄔裕康</td>
      <td>3.0</td>
      <td>5</td>
      <td>38.0</td>
      <td>1</td>
      <td>7</td>
      <td>27</td>
      <td>11</td>
      <td>2011</td>
      <td>30</td>
      <td>12</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3527889</th>
      <td>LG/BLgJxw5AvXy0pkgaHYYWeU7jKS+ms/51+7TaBY9Y=</td>
      <td>O+/KJ5a5GzbgLZrCOw/t/iDOPTrDcrz5ZnOtaK9blA8=</td>
      <td>3</td>
      <td>8</td>
      <td>0</td>
      <td>235403.0</td>
      <td>200</td>
      <td>ONE OK ROCK</td>
      <td>Toru/Taka</td>
      <td>Taka</td>
      <td>17.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
      <td>6</td>
      <td>2013</td>
      <td>1</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6073849</th>
      <td>KmAJtsNcrofH6qMoHvET89mQAlC1EN3r3r3rkfW2iT4=</td>
      <td>WogFv1yz1n49l4gNSbf76bWxas8nNvzHntrj4FuzC24=</td>
      <td>3</td>
      <td>22</td>
      <td>7</td>
      <td>210604.0</td>
      <td>371</td>
      <td>Twins</td>
      <td>no_data</td>
      <td>no_data</td>
      <td>24.0</td>
      <td>13</td>
      <td>28.0</td>
      <td>1</td>
      <td>9</td>
      <td>2</td>
      <td>11</td>
      <td>2016</td>
      <td>7</td>
      <td>10</td>
      <td>2017</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_validset.head()</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>msno</th>
      <th>song_id</th>
      <th>source_system_tab</th>
      <th>source_screen_name</th>
      <th>source_type</th>
      <th>song_length</th>
      <th>genre_ids</th>
      <th>artist_name</th>
      <th>composer</th>
      <th>lyricist</th>
      <th>language</th>
      <th>city</th>
      <th>bd</th>
      <th>gender</th>
      <th>registered_via</th>
      <th>registration_init_day</th>
      <th>registration_init_month</th>
      <th>registration_init_year</th>
      <th>expiration_day</th>
      <th>expiration_month</th>
      <th>expiration_year</th>
      <th>genre_count</th>
      <th>composer_count</th>
      <th>lyricist_count</th>
      <th>composer_artist_intersect</th>
      <th>composer_lyricist_intersect</th>
      <th>artist_lyricist_intersect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3400479</th>
      <td>RZDFiPWpvwi1RWF5NAPEkvmogqe+7rGys+zoLU9he2M=</td>
      <td>MvON55vzjT7QW7GSs/UVLZrE/LJpMAVFUjXwZczdw40=</td>
      <td>0</td>
      <td>11</td>
      <td>7</td>
      <td>356379.0</td>
      <td>97</td>
      <td>Nas</td>
      <td>Amy Winehouse| Salaam Remi| Nasir Jones p/k/a NAS</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>2</td>
      <td>7</td>
      <td>7</td>
      <td>12</td>
      <td>2010</td>
      <td>20</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2481022</th>
      <td>C3EZ5oh7XDt5fP9OY20RPlD8MA+rBknmvmDhA1tHGMU=</td>
      <td>5PvPCUIB7vVuCNpQRKXIOcWvh9EerujDAbrjV7G6ZE0=</td>
      <td>3</td>
      <td>8</td>
      <td>3</td>
      <td>216920.0</td>
      <td>349</td>
      <td>貴族精選</td>
      <td>no_data</td>
      <td>Super Market| Microdot</td>
      <td>31.0</td>
      <td>5</td>
      <td>27.0</td>
      <td>2</td>
      <td>3</td>
      <td>11</td>
      <td>12</td>
      <td>2012</td>
      <td>5</td>
      <td>1</td>
      <td>2018</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5808216</th>
      <td>O1pwjdTED6P3lKm52VBxVUtaSVc31S9PmIw+07WBNw4=</td>
      <td>va3+1L2wraJkzDbHjvdo+e+0TTJcLko0k0pqBn09nJE=</td>
      <td>3</td>
      <td>8</td>
      <td>3</td>
      <td>268225.0</td>
      <td>548</td>
      <td>Various Artists</td>
      <td>no_data</td>
      <td>no_data</td>
      <td>3.0</td>
      <td>13</td>
      <td>82.0</td>
      <td>0</td>
      <td>9</td>
      <td>29</td>
      <td>4</td>
      <td>2007</td>
      <td>23</td>
      <td>1</td>
      <td>2018</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>42686</th>
      <td>WFCCMzA4hADGBduTS6X8mXlutyiC0P33QkTG6zr5yCg=</td>
      <td>U9kojfZSKaiWOW94PKh1Riyv/zUWxmBRmv0XInQWLGw=</td>
      <td>7</td>
      <td>11</td>
      <td>7</td>
      <td>290063.0</td>
      <td>364</td>
      <td>周杰倫 (Jay Chou)</td>
      <td>周杰倫</td>
      <td>方文山</td>
      <td>3.0</td>
      <td>13</td>
      <td>32.0</td>
      <td>0</td>
      <td>7</td>
      <td>12</td>
      <td>12</td>
      <td>2010</td>
      <td>9</td>
      <td>9</td>
      <td>2017</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1850837</th>
      <td>h0fTru8nYMv9bR0j6kBh8kiXDaybzWBYaSHbUIVzeBs=</td>
      <td>J1sgBEFbcXSK6eiN7CK1WNxsso0/sY6t0BMX+c+iPNw=</td>
      <td>0</td>
      <td>11</td>
      <td>7</td>
      <td>220450.0</td>
      <td>111</td>
      <td>Usher</td>
      <td>no_data</td>
      <td>no_data</td>
      <td>52.0</td>
      <td>22</td>
      <td>28.0</td>
      <td>0</td>
      <td>9</td>
      <td>2</td>
      <td>1</td>
      <td>2008</td>
      <td>28</td>
      <td>9</td>
      <td>2017</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset, DataLoader</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TabularDataset</span><span class="params">(Dataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x_data, y_data, cat_cols1, cat_cols2, num_cols)</span>:</span></span><br><span class="line">        </span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        data: pandas data frame;</span></span><br><span class="line"><span class="string">        cat_cols: list of string, the names of the categorical columns in the data, will be passed through the embedding layers;</span></span><br><span class="line"><span class="string">        num_cols: list of string</span></span><br><span class="line"><span class="string">        y_data: the target</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.n = x_data.shape[<span class="number">0</span>]</span><br><span class="line">        self.y = y_data.astype(np.float32).reshape(<span class="number">-1</span>, <span class="number">1</span>)<span class="comment">#.values.reshape(-1, 1)</span></span><br><span class="line">       </span><br><span class="line">        self.cat_cols1 = cat_cols1</span><br><span class="line">        self.cat_cols2 = cat_cols2</span><br><span class="line">        self.num_cols = num_cols</span><br><span class="line">        </span><br><span class="line">        self.num_X = x_data[self.num_cols].astype(np.float32).values</span><br><span class="line">        self.cat_X1 = x_data[self.cat_cols1].astype(np.int64).values</span><br><span class="line">        self.cat_X2 = x_data[self.cat_cols2].astype(np.int64).values</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_data</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.num_X, self.cat_X1, self.cat_X2, self.y</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        total number of samples</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.n</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Generates one sample of data.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> [self.y[idx], self.num_X[idx], self.cat_X1[idx], self.cat_X2[idx]]</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">train_dataset = TabularDataset(x_data=X_trainset, y_data=y_trainset, cat_cols1=categorical_ls1, </span><br><span class="line">                               cat_cols2=[], num_cols=numerical_ls)</span><br><span class="line"></span><br><span class="line">val_dataset = TabularDataset(x_data=X_validset, y_data=y_validset, cat_cols1=categorical_ls1,</span><br><span class="line">                             cat_cols2=[], num_cols=numerical_ls)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FeedForwardNN</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, emb_dims1, emb_dims2, no_of_num, lin_layer_sizes, output_size, emb_dropout, lin_layer_dropouts, branch2_enable=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        emb_dims:           List of two element tuples;</span></span><br><span class="line"><span class="string">        no_of_num:          Integer, the number of continuous features in the data;</span></span><br><span class="line"><span class="string">        lin_layer_sizes:    List of integers. The size of each linear layer;</span></span><br><span class="line"><span class="string">        output_size:        Integer, the size of the final output;</span></span><br><span class="line"><span class="string">        emb_dropout:        Float, the dropout to be used after the embedding layers.</span></span><br><span class="line"><span class="string">        lin_layer_dropouts: List of floats, the dropouts to be used after each linear layer.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.branch2_enable = branch2_enable</span><br><span class="line">        <span class="comment"># embedding layers</span></span><br><span class="line">        self.emb_layers1 = nn.ModuleList([nn.Embedding(x, y) <span class="keyword">for</span> x, y <span class="keyword">in</span> emb_dims1])</span><br><span class="line">        self.emb_layers2 = nn.ModuleList([nn.Embedding(x, y) <span class="keyword">for</span> x, y <span class="keyword">in</span> emb_dims2])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算各个emb参数数量，为后续Linear layer的输入做准备</span></span><br><span class="line">        self.no_of_embs1 = sum([y <span class="keyword">for</span> x, y <span class="keyword">in</span> emb_dims1])</span><br><span class="line">        self.no_of_embs2 = sum([y <span class="keyword">for</span> x, y <span class="keyword">in</span> emb_dims2])</span><br><span class="line">        self.no_of_num = no_of_num</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 分支1</span></span><br><span class="line">        self.branch1 = nn.Linear(self.no_of_embs1, lin_layer_sizes[<span class="number">0</span>])</span><br><span class="line">        self.branch1_2 = nn.Linear(lin_layer_sizes[<span class="number">0</span>], lin_layer_sizes[<span class="number">1</span>])</span><br><span class="line">        nn.init.kaiming_normal_(self.branch1.weight.data)</span><br><span class="line">        nn.init.kaiming_normal_(self.branch1_2.weight.data)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 分支2</span></span><br><span class="line">        <span class="keyword">if</span> branch2_enable:</span><br><span class="line">            self.branch2 = nn.Linear(self.no_of_embs2, lin_layer_sizes[<span class="number">0</span>] * <span class="number">2</span>)</span><br><span class="line">            self.branch2_2 = nn.Linear(lin_layer_sizes[<span class="number">0</span>] * <span class="number">2</span>, lin_layer_sizes[<span class="number">1</span>] * <span class="number">2</span>)</span><br><span class="line">            nn.init.kaiming_normal_(self.branch2.weight.data)</span><br><span class="line">            nn.init.kaiming_normal_(self.branch2_2.weight.data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 主分支</span></span><br><span class="line"><span class="comment">#         self.main_layer1 = nn.Linear(lin_layer_sizes[1] * 3 + self.no_of_num, lin_layer_sizes[2])</span></span><br><span class="line">        self.main_layer1 = nn.Linear(<span class="number">77</span>, lin_layer_sizes[<span class="number">2</span>])</span><br><span class="line">        self.main_layer2 = nn.Linear(lin_layer_sizes[<span class="number">2</span>], lin_layer_sizes[<span class="number">3</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># batch normal</span></span><br><span class="line">        self.branch_bn_layers1 = nn.BatchNorm1d(lin_layer_sizes[<span class="number">0</span>])</span><br><span class="line">        self.branch_bn_layers2 = nn.BatchNorm1d(lin_layer_sizes[<span class="number">0</span>] * <span class="number">2</span>)</span><br><span class="line">        self.main_bn_layer = nn.BatchNorm1d(lin_layer_sizes[<span class="number">2</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Dropout Layers</span></span><br><span class="line">        self.emb_dropout_layer = nn.Dropout(emb_dropout)</span><br><span class="line">        self.dropout_layers = nn.ModuleList([nn.Dropout(size) <span class="keyword">for</span> size <span class="keyword">in</span> lin_layer_dropouts])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Output layer</span></span><br><span class="line">        self.output_layer = nn.Linear(lin_layer_sizes[<span class="number">-1</span>], output_size)</span><br><span class="line">        nn.init.kaiming_normal_(self.output_layer.weight.data)</span><br><span class="line">        self.sigmoid = nn.Sigmoid()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, num_data, cat_data1, cat_data2)</span>:</span></span><br><span class="line">        <span class="comment"># embedding categorical feature and cat them together</span></span><br><span class="line">        x1 = [emb_layer(torch.tensor(cat_data1[:, i])) <span class="keyword">for</span> i, emb_layer <span class="keyword">in</span> enumerate(self.emb_layers1)]</span><br><span class="line">        x1 = torch.cat(x1, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        x1 = self.emb_dropout_layer(F.relu(self.branch1(x1)))</span><br><span class="line">        x1 = self.branch_bn_layers1(x1)</span><br><span class="line">        x1 = self.dropout_layers[<span class="number">0</span>](F.relu(self.branch1_2(x1)))</span><br><span class="line">        <span class="keyword">if</span> self.branch2_enable:</span><br><span class="line">            x2 = [emb_layer(torch.tensor(cat_data2[:, i])) <span class="keyword">for</span> i, emb_layer <span class="keyword">in</span> enumerate(self.emb_layers2)]</span><br><span class="line">            x2 = torch.cat(x2, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            x2 = self.emb_dropout_layer(F.relu(self.branch2(x2)))</span><br><span class="line">            x2 = self.branch_bn_layers2(x2)</span><br><span class="line">            x2 = self.dropout_layers[<span class="number">0</span>](F.relu(self.branch2_2(x2)))</span><br><span class="line"></span><br><span class="line">            main = torch.cat([x1, x2, num_data], <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            main = torch.cat([x1, num_data], <span class="number">1</span>)</span><br><span class="line"><span class="comment">#         print("Main Shape: ", main.shape)</span></span><br><span class="line">        main = self.dropout_layers[<span class="number">1</span>](F.relu(self.main_layer1(main)))</span><br><span class="line">        main = self.main_bn_layer(main)</span><br><span class="line">        main = self.dropout_layers[<span class="number">2</span>](F.relu(self.main_layer2(main)))</span><br><span class="line"></span><br><span class="line">        out = self.output_layer(main)</span><br><span class="line">        out = self.sigmoid(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">batchsize = <span class="number">64</span></span><br><span class="line">train_dataloader = DataLoader(train_dataset, batchsize, shuffle=<span class="literal">True</span>, num_workers=<span class="number">2</span>)</span><br><span class="line">val_dataloader = DataLoader(val_dataset, <span class="number">64</span>, shuffle=<span class="literal">True</span>, num_workers=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># next(iter(train_dataloader))[3]</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">2020</span>)</span><br><span class="line">device = torch.device(<span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line">model = FeedForwardNN(emb_dims1=emb_dims1, </span><br><span class="line">                      emb_dims2=emb_dims2, </span><br><span class="line">                      no_of_num=len(numerical_ls),</span><br><span class="line">                      lin_layer_sizes=[<span class="number">128</span>,<span class="number">64</span>,<span class="number">32</span>,<span class="number">16</span>],</span><br><span class="line">                      output_size=<span class="number">1</span>,</span><br><span class="line">                      lin_layer_dropouts=[<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.05</span>],</span><br><span class="line">                      emb_dropout=<span class="number">0.05</span>).to(device)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">device,len(train_dataloader)</span><br></pre></td></tr></table></figure>




<pre><code>(device(type=&#39;cpu&#39;), 92218)
</code></pre>
<h2 id="5-Model-Training-and-Validation-on-Wide-and-Deep-model"><a href="#5-Model-Training-and-Validation-on-Wide-and-Deep-model" class="headerlink" title="5.Model Training and Validation on Wide and Deep model"></a>5.Model Training and Validation on Wide and Deep model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">no_of_epochs = <span class="number">2</span></span><br><span class="line">batch_num = <span class="number">4000</span></span><br><span class="line"><span class="comment"># criterion = torch.nn.MSELoss()</span></span><br><span class="line">criterion = torch.nn.BCELoss()</span><br><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line">lrscheduler = torch.optim.lr_scheduler.ReduceLROnPlateau(optimizer, mode=<span class="string">'max'</span>, factor=<span class="number">0.1</span>, patience=<span class="number">2</span>, threshold=<span class="number">0.9</span> )</span><br><span class="line">total_data = train_dataset.__len__()</span><br><span class="line">best_val_score = <span class="number">0.0</span></span><br><span class="line">best_model =<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">print_every = <span class="number">500</span></span><br><span class="line">steps = <span class="number">0</span></span><br><span class="line">running_loss = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(no_of_epochs):</span><br><span class="line">    model.train()</span><br><span class="line">    batch_cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> index, datas <span class="keyword">in</span> enumerate(train_dataloader):</span><br><span class="line">        <span class="keyword">if</span> batch_cnt == batch_num:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        steps += <span class="number">1</span></span><br><span class="line">        batch_cnt += <span class="number">1</span></span><br><span class="line">        y, num_x, cat_x1, cat_x2 = datas</span><br><span class="line">        cat_x1 = cat_x1.to(device)</span><br><span class="line">        cat_x2 = cat_x2.to(device)</span><br><span class="line">        num_x = num_x.to(device)</span><br><span class="line">        y  = y.to(device)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Forward Pass</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        preds = model.forward(num_x, cat_x1, cat_x2)</span><br><span class="line">        loss = criterion(preds, y)</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        running_loss += loss.item()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> steps % print_every == <span class="number">0</span>:</span><br><span class="line">            val_loss = <span class="number">0</span></span><br><span class="line">            model.eval()</span><br><span class="line">            val_acc = <span class="number">0.</span></span><br><span class="line">            total_len = <span class="number">0.</span></span><br><span class="line">            <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">                <span class="keyword">for</span> val_index, val_datas <span class="keyword">in</span> enumerate(val_dataloader):</span><br><span class="line">                    y, num_x, cat_x1, cat_x2 = val_datas</span><br><span class="line">                    cat_x1 = cat_x1.to(device)</span><br><span class="line">                    cat_x2 = cat_x2.to(device)</span><br><span class="line">                    num_x = num_x.to(device)</span><br><span class="line">                    y  = y.to(device)</span><br><span class="line">                    </span><br><span class="line">                    out = model.forward(num_x, cat_x1, cat_x2)</span><br><span class="line">                    batch_loss = criterion(out, y)</span><br><span class="line">                    val_acc += ((out&gt;<span class="number">0.5</span>)==y ).sum().detach().to(<span class="string">'cpu'</span>).numpy()</span><br><span class="line">                    total_len += len(out)</span><br><span class="line">                    </span><br><span class="line">                    val_loss += batch_loss.item()</span><br><span class="line"></span><br><span class="line">            val_acc /= total_len</span><br><span class="line">            <span class="keyword">if</span> val_acc&gt; best_val_score:</span><br><span class="line">                  best_val_score = val_acc</span><br><span class="line">                  torch.save(model,<span class="string">"checkpoint.pt"</span>)</span><br><span class="line">                      </span><br><span class="line">                      <span class="comment"># print("Checkpoint saved.")</span></span><br><span class="line">            <span class="comment"># update scheduler</span></span><br><span class="line">            lrscheduler.step(val_loss)</span><br><span class="line">            print(<span class="string">f"Epoch <span class="subst">&#123;epoch+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;no_of_epochs&#125;</span>.."</span></span><br><span class="line">                     <span class="string">f"Train loss:<span class="subst">&#123;running_loss/print_every:<span class="number">.4</span>f&#125;</span>.."</span></span><br><span class="line">                     <span class="string">f"Validation loss:<span class="subst">&#123;val_loss/len(val_dataloader):<span class="number">.4</span>f&#125;</span>.."</span></span><br><span class="line">                 <span class="string">f"Validation Acc:<span class="subst">&#123;val_acc:<span class="number">.4</span>f&#125;</span>.."</span></span><br><span class="line">                 <span class="string">f"Best Validation Acc:<span class="subst">&#123;best_val_score:<span class="number">.4</span>f&#125;</span>.."</span>)</span><br><span class="line">            running_loss = <span class="number">0</span></span><br><span class="line">            model.train()</span><br><span class="line">print(<span class="string">"Training Completed"</span>)</span><br><span class="line">best_model = torch.load(<span class="string">"checkpoint.pt"</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Epoch 1/2..Train loss:0.6945..Validation loss:0.6925..Validation Acc:0.5302..Best Validation Acc:0.5302..
Epoch 1/2..Train loss:0.6742..Validation loss:0.6663..Validation Acc:0.6229..Best Validation Acc:0.6229..
Epoch 1/2..Train loss:0.6640..Validation loss:0.6618..Validation Acc:0.6245..Best Validation Acc:0.6245..
Epoch 1/2..Train loss:0.6623..Validation loss:0.6768..Validation Acc:0.6252..Best Validation Acc:0.6252..
Epoch 1/2..Train loss:0.6628..Validation loss:0.6648..Validation Acc:0.6249..Best Validation Acc:0.6252..
Epoch 1/2..Train loss:0.6636..Validation loss:0.6656..Validation Acc:0.6253..Best Validation Acc:0.6253..
Epoch 1/2..Train loss:0.6623..Validation loss:0.6674..Validation Acc:0.6254..Best Validation Acc:0.6254..
Epoch 1/2..Train loss:0.6640..Validation loss:0.6649..Validation Acc:0.6255..Best Validation Acc:0.6255..
Epoch 2/2..Train loss:0.6597..Validation loss:0.6638..Validation Acc:0.6256..Best Validation Acc:0.6256..
Epoch 2/2..Train loss:0.6605..Validation loss:0.6584..Validation Acc:0.6259..Best Validation Acc:0.6259..
Epoch 2/2..Train loss:0.6609..Validation loss:0.6636..Validation Acc:0.6263..Best Validation Acc:0.6263..
Epoch 2/2..Train loss:0.6602..Validation loss:0.6620..Validation Acc:0.6263..Best Validation Acc:0.6263..
Epoch 2/2..Train loss:0.6647..Validation loss:0.6658..Validation Acc:0.6264..Best Validation Acc:0.6264..
Epoch 2/2..Train loss:0.6615..Validation loss:0.6644..Validation Acc:0.6262..Best Validation Acc:0.6264..
Epoch 2/2..Train loss:0.6641..Validation loss:0.6764..Validation Acc:0.6254..Best Validation Acc:0.6264..
Epoch 2/2..Train loss:0.6600..Validation loss:0.6926..Validation Acc:0.6263..Best Validation Acc:0.6264..
Training Completed
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">f"Best Validation Acc:<span class="subst">&#123;best_val_score:<span class="number">.4</span>f&#125;</span>.."</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Best Validation Acc:0.6264..
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = torch.load(<span class="string">"checkpoint.pt"</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test_dataset = TabularDataset(x_data=test_data, y_data=np.zeros(len(test_data)), cat_cols1=categorical_ls1,</span><br><span class="line">                             cat_cols2=[], num_cols=numerical_ls)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluation</span><span class="params">(test_dataloder)</span>:</span></span><br><span class="line">    </span><br><span class="line">    model.eval()</span><br><span class="line">    total_cnt = <span class="number">0.</span></span><br><span class="line">    correct_cnt = <span class="number">0.</span></span><br><span class="line">    acc = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> test_index, test_datas <span class="keyword">in</span> enumerate(test_dataloder):</span><br><span class="line">                        y, num_x, cat_x1, cat_x2 = test_datas</span><br><span class="line">                        cat_x1 = cat_x1.to(device)</span><br><span class="line">                        cat_x2 = cat_x2.to(device)</span><br><span class="line">                        num_x = num_x.to(device)</span><br><span class="line">                        y  = y.to(device)            </span><br><span class="line">                        out = model.forward(num_x, cat_x1, cat_x2)</span><br><span class="line">                        correct_cnt += ((out&gt;<span class="number">0.5</span>)==y ).sum().detach().to(<span class="string">'cpu'</span>).numpy()</span><br><span class="line">                        total_cnt += len(out)</span><br><span class="line"><span class="comment">#                         out = out.squeeze().to("cpu").numpy().tolist()</span></span><br><span class="line">                        </span><br><span class="line">        acc = <span class="number">100</span>* correct_cnt / total_cnt</span><br><span class="line">        print(<span class="string">"Evaluation Acc: %.4f %%"</span>%(acc))</span><br><span class="line">    <span class="keyword">return</span> acc</span><br></pre></td></tr></table></figure>

<h2 id="6-Model-Evaluation-on-Wide-and-Deep-model-using-validation-set"><a href="#6-Model-Evaluation-on-Wide-and-Deep-model-using-validation-set" class="headerlink" title="6.Model Evaluation on Wide and Deep model using validation set"></a>6.Model Evaluation on Wide and Deep model using validation set</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acc = evaluation(val_dataloader)</span><br></pre></td></tr></table></figure>

<pre><code>Evaluation Acc: 62.6432 %
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict_test</span><span class="params">(test_dataset)</span>:</span></span><br><span class="line">    preds = []</span><br><span class="line">    model.eval()</span><br><span class="line">    test_dataloder = DataLoader(test_dataset, <span class="number">200</span>, shuffle=<span class="literal">False</span>, num_workers=<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> test_index, test_datas <span class="keyword">in</span> enumerate(test_dataloder):</span><br><span class="line">                        y, num_x, cat_x1, cat_x2 = test_datas</span><br><span class="line">                        cat_x1 = cat_x1.to(device)</span><br><span class="line">                        cat_x2 = cat_x2.to(device)</span><br><span class="line">                        num_x = num_x.to(device)</span><br><span class="line">                        y  = y.to(device)            </span><br><span class="line">                        out = model.forward(num_x, cat_x1, cat_x2)</span><br><span class="line">                        out = out.squeeze().to(<span class="string">"cpu"</span>).numpy().tolist()</span><br><span class="line"><span class="comment">#                         print(out)</span></span><br><span class="line">                        preds.extend(out)</span><br><span class="line">                        </span><br><span class="line">    <span class="keyword">return</span> np.array(preds)</span><br></pre></td></tr></table></figure>

<h2 id="Make-Predictions-and-submission"><a href="#Make-Predictions-and-submission" class="headerlink" title="Make Predictions and submission"></a>Make Predictions and submission</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">preds = predict_test(test_dataset)</span><br><span class="line">submission = pd.DataFrame()</span><br><span class="line">submission[<span class="string">'id'</span>] = ids</span><br><span class="line">submission[<span class="string">'target'</span>] = preds</span><br><span class="line">submission.to_csv(root + <span class="string">'submission_WideAndDeep_model.csv.gz'</span>, compression = <span class="string">'gzip'</span>, index=<span class="literal">False</span>, float_format = <span class="string">'%.5f'</span>)</span><br><span class="line">print(<span class="string">"Model Predictions: "</span>,preds)</span><br><span class="line"><span class="comment"># !kaggle competitions submit -c ./train/data -f submission_lgbm_model.csv.gz -m "Message"</span></span><br></pre></td></tr></table></figure>

<pre><code>Model Predictions:  [0.60901934 0.60901934 0.35112065 ... 0.54463851 0.48204085 0.54300648]
</code></pre>
<p>submission_WideAndDeep_model.csv.gz<br>WideAndDeep_model<br>0.61628<br>0.61117</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perf_df = pd.DataFrame(&#123;<span class="string">"model name"</span>:[<span class="string">'Wide and Deep model'</span>],<span class="string">"private_score"</span>:[<span class="number">0.61628</span>], <span class="string">"public score"</span>: [<span class="number">0.61117</span>]&#125;)</span><br><span class="line">perf_df</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model name</th>
      <th>private_score</th>
      <th>public score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Wide and Deep model</td>
      <td>0.61628</td>
      <td>0.61117</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model_names = [<span class="string">"lgbm model 0"</span>,<span class="string">"lgbm model 1"</span>,<span class="string">"lgbm model 2"</span>,<span class="string">"lgbm model 3"</span>,<span class="string">"lgbm model 4"</span>]</span><br><span class="line">private_score = [<span class="number">0.67206</span>,<span class="number">0.67416</span>,<span class="number">0.67416</span>,<span class="number">0.67435</span>,<span class="number">0.67423</span>]</span><br><span class="line">public_score = [<span class="number">0.66940</span>,<span class="number">0.67188</span>,<span class="number">0.67208</span>,<span class="number">0.67241</span>,<span class="number">0.67256</span>]</span><br><span class="line">perf_df = pd.DataFrame(&#123;<span class="string">"model name"</span>:model_names,<span class="string">"max_depth:"</span>:max_depths,<span class="string">"private_score"</span>:private_score, <span class="string">"public score"</span>: public_score&#125;)</span><br><span class="line">perf_df</span><br></pre></td></tr></table></figure>




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model name</th>
      <th>max_depth:</th>
      <th>private_score</th>
      <th>public score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>lgbm model 0</td>
      <td>10</td>
      <td>0.67206</td>
      <td>0.66940</td>
    </tr>
    <tr>
      <th>1</th>
      <td>lgbm model 1</td>
      <td>15</td>
      <td>0.67416</td>
      <td>0.67188</td>
    </tr>
    <tr>
      <th>2</th>
      <td>lgbm model 2</td>
      <td>20</td>
      <td>0.67416</td>
      <td>0.67208</td>
    </tr>
    <tr>
      <th>3</th>
      <td>lgbm model 3</td>
      <td>25</td>
      <td>0.67435</td>
      <td>0.67241</td>
    </tr>
    <tr>
      <th>4</th>
      <td>lgbm model 4</td>
      <td>30</td>
      <td>0.67423</td>
      <td>0.67256</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="7-Summary-1"><a href="#7-Summary-1" class="headerlink" title="7. Summary"></a>7. Summary</h1><p>Type answers here</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/LGBM/">LGBM</a><a class="link-muted mr-2" rel="tag" href="/tags/Boosting-Machine/">Boosting Machine</a><a class="link-muted mr-2" rel="tag" href="/tags/Wide-and-Deep/">Wide and Deep</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://ppoffice.github.io/hexo-theme-icarus-categorites-Plugins/Share/" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/12/08/report/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">CPSC 6300 Final Report</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/11/23/ML-K-mean-Cluster/"><span class="level-item">ML-K-mean-Cluster</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "kvXCKmDNxnA2486N29e5cP7i-MdYXbMMI",
            appKey: "0Lv5b0SqotzkGHQvD64u4AKo",
            
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "en",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://github.com/wenkangwei" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Data-Collection/"><span class="level-start"><span class="level-item">Data Collection</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Data-Structure/"><span class="level-start"><span class="level-item">Data Structure</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Data-Structure/Sorting/"><span class="level-start"><span class="level-item">Sorting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Deep-Learning/"><span class="level-start"><span class="level-item">Deep Learning</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Machine-Learning/Accuracy-Improvement/"><span class="level-start"><span class="level-item">Accuracy Improvement</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/NLP/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Parallel-Computing/"><span class="level-start"><span class="level-item">Parallel Computing</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/PySpark/"><span class="level-start"><span class="level-item">PySpark</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Recommendation-System/"><span class="level-start"><span class="level-item">Recommendation System</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Report/"><span class="level-start"><span class="level-item">Report</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Searching/"><span class="level-start"><span class="level-item">Searching</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Searching/Data-Strucure/"><span class="level-start"><span class="level-item">Data Strucure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Statistic/"><span class="level-start"><span class="level-item">Statistic</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Amdahl-s-Law/"><span class="tag">Amdahl&#039;s Law</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Backpropagation/"><span class="tag">Backpropagation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bagging/"><span class="tag">Bagging</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BeautifulSoup/"><span class="tag">BeautifulSoup</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Binary-Tree/"><span class="tag">Binary Tree</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blending/"><span class="tag">Blending</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Boosting/"><span class="tag">Boosting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Boosting-Machine/"><span class="tag">Boosting Machine</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BuckSort/"><span class="tag">BuckSort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Collaborative-Filtering/"><span class="tag">Collaborative Filtering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Confusion-Metric/"><span class="tag">Confusion Metric</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Convolution-Neural-Network/"><span class="tag">Convolution Neural Network</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cross-Validation/"><span class="tag">Cross Validation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/D3-js/"><span class="tag">D3.js</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DCN/"><span class="tag">DCN</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DIN/"><span class="tag">DIN</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Analysis/"><span class="tag">Data Analysis</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Mining/"><span class="tag">Data Mining</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Datawhale-Team-Learning/"><span class="tag">Datawhale Team Learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DeepFM/"><span class="tag">DeepFM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dropout/"><span class="tag">Dropout</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ensemble-Learning/"><span class="tag">Ensemble Learning</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GNN/"><span class="tag">GNN</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph/"><span class="tag">Graph</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Holdout/"><span class="tag">Holdout</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hypothesis-Test/"><span class="tag">Hypothesis Test</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Icarus/"><span class="tag">Icarus</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Independence-Test/"><span class="tag">Independence Test</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K-Mean-Clustering/"><span class="tag">K-Mean Clustering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/KMean-Clustering/"><span class="tag">KMean Clustering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LGBM/"><span class="tag">LGBM</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Machine-Learning/"><span class="tag">Machine Learning</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Markdown/"><span class="tag">Markdown</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Model-Evaluation/"><span class="tag">Model Evaluation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Model-Selection/"><span class="tag">Model Selection</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Natural-Language-Representations/"><span class="tag">Natural Language Representations</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nature-Language-Processing/"><span class="tag">Nature Language Processing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Negative-Sampling/"><span class="tag">Negative Sampling</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NeuralFM/"><span class="tag">NeuralFM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/P-value/"><span class="tag">P-value</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Parallel-Computing/"><span class="tag">Parallel Computing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Parallel-Speedup/"><span class="tag">Parallel Speedup</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PySpark/"><span class="tag">PySpark</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROC-curve/"><span class="tag">ROC curve</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Recommendation-System/"><span class="tag">Recommendation System</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regression/"><span class="tag">Regression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regular-Expression/"><span class="tag">Regular Expression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sorting/"><span class="tag">Sorting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Stacking/"><span class="tag">Stacking</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Traversal/"><span class="tag">Traversal</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unsupervised-Learning/"><span class="tag">Unsupervised Learning</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Variable-Selection/"><span class="tag">Variable Selection</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web-Scrapping/"><span class="tag">Web Scrapping</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Wide-and-Deep/"><span class="tag">Wide and Deep</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Wide-and-Deep-Model/"><span class="tag">Wide and Deep Model</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Wide-Deep-Model/"><span class="tag">Wide&amp;Deep Model</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Word-Embedding/"><span class="tag">Word Embedding</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Word-vector/"><span class="tag">Word vector</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binary-search/"><span class="tag">binary search</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bubble-sort/"><span class="tag">bubble sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/commands/"><span class="tag">commands</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/insertion-sort/"><span class="tag">insertion sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/merge-sort/"><span class="tag">merge sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/non-parametric-learning/"><span class="tag">non-parametric learning</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/quick-sort/"><span class="tag">quick sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/review/"><span class="tag">review</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-06-18T23:00:02.000Z">2021-06-18</time></p><p class="title is-6"><a class="link-muted" href="/2021/06/18/GNN-2-MessagePassing/">GNN-2-MessagePassing</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Deep-Learning/">Deep Learning</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-06-16T03:16:25.000Z">2021-06-15</time></p><p class="title is-6"><a class="link-muted" href="/2021/06/15/GNN-1-Basic/">GNN-1-Basic</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Deep-Learning/">Deep Learning</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-05-20T21:29:11.000Z">2021-05-20</time></p><p class="title is-6"><a class="link-muted" href="/2021/05/20/Recommendation-System-6-DCN/">Recommendation System-6-DCN</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Recommendation-System/">Recommendation System</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-05-18T07:03:39.000Z">2021-05-18</time></p><p class="title is-6"><a class="link-muted" href="/2021/05/18/ensemble-learning-project-HappinessPrediction/">ensemble-learning-project-HappinessPrediction</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Machine-Learning/">Machine Learning</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-05-13T05:48:29.000Z">2021-05-13</time></p><p class="title is-6"><a class="link-muted" href="/2021/05/13/ensemble-learning-Stacking/">ensemble-learning-Stacking</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Machine-Learning/">Machine Learning</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avatar.jpg" alt="Wenkang Wei"></figure><p class="title is-size-4 is-block line-height-inherit">Wenkang Wei</p><p class="is-size-6 is-block">computer engineering| machine learning</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Clemson,SC</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">37</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">18</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">69</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/wenkangwei" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/wenkangwei"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/wenkang-wei-588811167"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex" href="#Use-7z-to-uncompress-the-csv-files"><span class="mr-2">1</span><span>Use 7z to uncompress the csv files</span></a></li><li><a class="is-flex" href="#KKBox-Music-Recommendation-System"><span class="mr-2">2</span><span>KKBox-Music Recommendation System</span></a><ul class="menu-list"><li><a class="is-flex" href="#Goal-of-this-project"><span class="mr-2">2.1</span><span>Goal of this project</span></a></li><li><a class="is-flex" href="#0-Data-Collection-and-Description"><span class="mr-2">2.2</span><span>0. Data Collection and Description</span></a></li><li><a class="is-flex" href="#1-Data-Cleaning-and-Exploratory-Data-Analysis-EDA"><span class="mr-2">2.3</span><span>1. Data Cleaning and Exploratory Data Analysis (EDA)</span></a></li><li><a class="is-flex" href="#2-Data-Preprocessing"><span class="mr-2">2.4</span><span>2. Data Preprocessing</span></a></li><li><a class="is-flex" href="#3-Data-Pipeline-Extract-Transformation-Load-ETL"><span class="mr-2">2.5</span><span>3. Data Pipeline: Extract, Transformation, Load (ETL)</span></a></li><li><a class="is-flex" href="#4-Machine-Learning-Modeling"><span class="mr-2">2.6</span><span>4. Machine Learning Modeling</span></a></li><li><a class="is-flex" href="#5-Model-Training-and-validation"><span class="mr-2">2.7</span><span>5. Model Training and validation</span></a></li><li><a class="is-flex" href="#6-Model-Evaluation"><span class="mr-2">2.8</span><span>6. Model Evaluation</span></a></li><li><a class="is-flex" href="#7-Summary"><span class="mr-2">2.9</span><span>7. Summary</span></a></li></ul></li><li><a class="is-flex" href="#1-Exploratory-Data-Analysis"><span class="mr-2">3</span><span>1. Exploratory Data Analysis</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-1-Take-a-look-to-the-info-and-format-of-data"><span class="mr-2">3.1</span><span>1.1 Take a look to the info and format of data</span></a></li><li><a class="is-flex" href="#We-can-see-that-attributes-source-system-tab-source-screen-name-source-type-contain-missing-values"><span class="mr-2">3.2</span><span>We can see that attributes: source_system_tab, source_screen_name, source_type contain missing values</span></a></li><li><a class="is-flex" href="#In-test-dataset-We-can-see-that-attributes-that-contain-missing-values"><span class="mr-2">3.3</span><span>In test dataset,  We can see that attributes that contain missing values:</span></a></li><li><a class="is-flex" href="#Attributes-that-contain-missing-values-are"><span class="mr-2">3.4</span><span>Attributes that contain missing values are</span></a></li><li><a class="is-flex" href="#1-2-Explore-Song-information"><span class="mr-2">3.5</span><span>1.2 Explore Song information</span></a><ul class="menu-list"><li><a class="is-flex" href="#We-can-see-that-local-library-and-local-playlist-are-the-main-sources-that-users-repeat-playing-music-and-Most-of-users-more-prefer-to-play-music-from-local-library-than-to-play-music-online"><span class="mr-2">3.5.1</span><span>We can see that local library and local playlist are the main sources that users repeat playing music and Most of users more prefer to play music from local library than to play music online</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#Analyze-Relationship-between-Target-and-members-info"><span class="mr-2">4</span><span>Analyze Relationship between Target and members info</span></a><ul class="menu-list"><li><a class="is-flex" href="#Parse-the-datetime-data"><span class="mr-2">4.1</span><span>Parse the datetime data</span></a></li><li><a class="is-flex" href="#Visualize-distribution-of-age-bd-attribution"><span class="mr-2">4.2</span><span>Visualize distribution of age: bd attribution</span></a></li><li><a class="is-flex" href="#We-can-see-that-bd-age-has-outliers-outside-range-0-100-so-we-want-to-replace-the-incorrect-bd-with-NaN"><span class="mr-2">4.3</span><span>We can see that bd/age has outliers outside range [0,100], so we want to replace the incorrect bd with NaN</span></a></li></ul></li><li><a class="is-flex" href="#2-Data-Preprocessing-1"><span class="mr-2">5</span><span>2. Data Preprocessing</span></a><ul class="menu-list"><li><a class="is-flex" href="#2-1-Filling-missing-values"><span class="mr-2">5.1</span><span>2.1 Filling missing values</span></a></li><li><a class="is-flex" href="#2-2-Data-Transformation"><span class="mr-2">5.2</span><span>2.2 Data Transformation</span></a></li></ul></li><li><a class="is-flex" href="#3-Data-Extract-Transform-and-Load-ETL"><span class="mr-2">6</span><span>3. Data Extract, Transform and Load (ETL)</span></a><ul class="menu-list"><li><a class="is-flex" href="#3-1-Transformation-Function-for-Data-cleaning"><span class="mr-2">6.1</span><span>3.1 Transformation Function for Data cleaning</span></a></li><li><a class="is-flex" href="#3-2-Transform-the-composer-artist-lyricist-to-counts-as-new-features"><span class="mr-2">6.2</span><span>3.2 Transform the composer, artist, lyricist to counts as new features</span></a><ul class="menu-list"><li><a class="is-flex" href="#3-2-1-Transform-train-set"><span class="mr-2">6.2.1</span><span>3.2.1 Transform train set</span></a></li><li><a class="is-flex" href="#3-2-2-Transform-Testset"><span class="mr-2">6.2.2</span><span>3.2.2 Transform Testset</span></a></li><li><a class="is-flex" href="#3-2-3-Split-validation-set-and-trainset"><span class="mr-2">6.2.3</span><span>3.2.3 Split validation set and trainset</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#4-LGBM-Modeling"><span class="mr-2">7</span><span>4. LGBM Modeling</span></a><ul class="menu-list"><li><a class="is-flex" href="#5-Model-Training-and-Validation-on-LGBM-models"><span class="mr-2">7.1</span><span>5.Model Training and Validation on LGBM models</span></a></li><li><a class="is-flex" href="#6-Model-Evaluation-on-LGBM-models"><span class="mr-2">7.2</span><span>6.Model Evaluation on LGBM models</span></a></li><li><a class="is-flex" href="#Create-Submission-Files"><span class="mr-2">7.3</span><span>Create Submission Files</span></a></li><li><a class="is-flex" href="#Scores-from-kaggle-test-set"><span class="mr-2">7.4</span><span>Scores from kaggle test set</span></a></li></ul></li><li><a class="is-flex" href="#4-Wide-amp-Depth-neural-network-model"><span class="mr-2">8</span><span>4. Wide &amp; Depth neural network model</span></a><ul class="menu-list"><ul class="menu-list"><li><a class="is-flex" href="#Wide-and-Deep-model（2-branches–-gt-merge-two-branches–-gt-main-branch）"><span class="mr-2">8.1.1</span><span>Wide and Deep model（2 branches–&gt;merge two branches–&gt;main branch）</span></a></li><li><a class="is-flex" href="#Label-Encoding-for-categorical-data"><span class="mr-2">8.1.2</span><span>Label Encoding for categorical data</span></a></li></ul><li><a class="is-flex" href="#5-Model-Training-and-Validation-on-Wide-and-Deep-model"><span class="mr-2">8.2</span><span>5.Model Training and Validation on Wide and Deep model</span></a></li><li><a class="is-flex" href="#6-Model-Evaluation-on-Wide-and-Deep-model-using-validation-set"><span class="mr-2">8.3</span><span>6.Model Evaluation on Wide and Deep model using validation set</span></a></li><li><a class="is-flex" href="#Make-Predictions-and-submission"><span class="mr-2">8.4</span><span>Make Predictions and submission</span></a></li></ul></li><li><a class="is-flex" href="#7-Summary-1"><span class="mr-2">9</span><span>7. Summary</span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/icon.png" alt="Wenkang&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2021 Wenkang Wei</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://github.com/wenkangwei/wenkangwei.github.io`',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>