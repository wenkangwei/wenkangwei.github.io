<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>GNN-4-EdgePrediction - Wenkang&#039;s Blog</title><meta description=""><meta property="og:type" content="article"><meta property="og:title" content="GNN-4-EdgePrediction"><meta property="og:url" content="https://github.com/wenkangwei/"><meta property="og:site_name" content="Wenkang&#039;s Blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://raw.githubusercontent.com/wenkangwei/Datawhale-Team-Learning/main/GNN/Task-4-LinkPrediction/InMemoryDataset.png"><meta property="og:image" content="https://raw.githubusercontent.com/wenkangwei/Datawhale-Team-Learning/main/GNN/Task-4-LinkPrediction/output_9_2.png"><meta property="article:published_time" content="2021-06-27T04:26:51.000Z"><meta property="article:modified_time" content="2021-06-27T06:27:36.696Z"><meta property="article:author" content="Wenkang Wei"><meta property="article:tag" content="GNN"><meta property="article:tag" content="Graph"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://raw.githubusercontent.com/wenkangwei/Datawhale-Team-Learning/main/GNN/Task-4-LinkPrediction/InMemoryDataset.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/wenkangwei/wenkangwei.github.io%60/2021/06/27/GNN-4-EdgePrediction/"},"headline":"Wenkang's Blog","image":["https://raw.githubusercontent.com/wenkangwei/Datawhale-Team-Learning/main/GNN/Task-4-LinkPrediction/InMemoryDataset.png","https://raw.githubusercontent.com/wenkangwei/Datawhale-Team-Learning/main/GNN/Task-4-LinkPrediction/output_9_2.png"],"datePublished":"2021-06-27T04:26:51.000Z","dateModified":"2021-06-27T06:27:36.696Z","author":{"@type":"Person","name":"Wenkang Wei"},"description":""}</script><link rel="canonical" href="https://github.com/wenkangwei/wenkangwei.github.io%60/2021/06/27/GNN-4-EdgePrediction/"><link rel="icon" href="/images/icon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/icon.png" alt="Wenkang&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2021-06-27T04:26:51.000Z" title="2021-06-27T04:26:51.000Z">2021-06-27</time><span class="level-item"><a class="link-muted" href="/categories/Deep-Learning/">Deep Learning</a></span><span class="level-item">19 minutes read (About 2906 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span> visits</span></div></div><h1 class="title is-3 is-size-4-mobile">GNN-4-EdgePrediction</h1><div class="content"><img src= https://miro.medium.com/max/723/0*4sbvBTWVmXnEC53v.png>
<a id="more"></a>

<h1 id="GNN-Task-4-GraphDataset-and-LinkPrediction"><a href="#GNN-Task-4-GraphDataset-and-LinkPrediction" class="headerlink" title="GNN-Task-4 GraphDataset and LinkPrediction"></a>GNN-Task-4 GraphDataset and LinkPrediction</h1><h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h2><p>在GNN图神经网络的使用中，我们经常要根据实际问题和数据去自定义自己的数据集。另外，图神经网络的任务里面也会经常涉及到各种不同的预测任务(node classification, regression, link prediction等)。 所以这次的内容主要介绍一下内容</p>
<ul>
<li>怎么用torch geometric的InMemoeryDataset 去搭建自定义的数据集来加载基于内存(数据完全放在内存里面)的数据集，并且自己尝试搭建一个来实践</li>
<li>搭建自己的GNN和图数据集进行link的预测</li>
<li><em>另外鉴于前几次Datawhale对GNN博客作业评分标准不明确(一些优秀作业简单写几段自己的总结就确实实验或者是大部分是代码基本没有理论，他们的分数都比我理论+实践+自己读完paper后的理解总结的博客高分)，我这里就不参考他们提供的内容做了，直接根据自己的理解写自己的东西</em></li>
</ul>
<h2 id="2-self-defined-PyG-Dataset"><a href="#2-self-defined-PyG-Dataset" class="headerlink" title="2. self-defined PyG Dataset"></a>2. self-defined PyG Dataset</h2><p>首先这一节主要介绍怎么使用 torch_geometric 里面的InMemoryDataset,之后自己写一个自定义的InMemoryDataset的数据并测试不同的数据集</p>
<h3 id="2-1-Introduction-to-InMemoryDataset"><a href="#2-1-Introduction-to-InMemoryDataset" class="headerlink" title="2.1 Introduction to InMemoryDataset"></a>2.1 Introduction to InMemoryDataset</h3><p>先来看看 InMemoryDataset的官方解释:<br><code>class InMemoryDataset(root: Optional[str] = None, transform: Optional[Callable] = None, pre_transform: Optional[Callable] = None, pre_filter: Optional[Callable] = None)</code><br>Dataset base class for creating graph datasets which fit completely into CPU memory. See here for the accompanying tutorial.<br>PARAMETERS</p>
<ul>
<li><p><code>root (string, optional)</code> – 用于存放数据集的根目录路径(默认为None)</p>
</li>
<li><p><code>transform (callable, optional)</code> – A function/transform that takes in an torch_geometric.data.Data object and returns a transformed version. </p>
</li>
<li><p><code>pre_transform (callable, optional)</code> – A function/transform that takes in an torch_geometric.data.Data object and returns a transformed version. The data object will be transformed before being saved to disk. (default: None)</p>
</li>
<li><p><code>pre_filter (callable, optional)</code> – A function that takes in an torch_geometric.data.Data object and returns a boolean value, indicating whether the data object should be included in the final dataset. (default: None)</p>
</li>
</ul>
<p>由于InMemoryDataset 继承了torch_geometric.data.Dataset 基类，而这个基类调用<strong>init__函数会调用download, process等函数， 以下是是Dataset 和InMemoryDataset 的构建函数__init</strong>()的源码， 以及我自己画的执行的流程图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dataset</span><span class="params">(torch.utils.data.Dataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, root: Optional[str] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 transform: Optional[Callable] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 pre_transform: Optional[Callable] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 pre_filter: Optional[Callable] = None)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> isinstance(root, str):</span><br><span class="line">            root = osp.expanduser(osp.normpath(root))</span><br><span class="line"></span><br><span class="line">        self.root = root</span><br><span class="line">        self.transform = transform</span><br><span class="line">        self.pre_transform = pre_transform</span><br><span class="line">        self.pre_filter = pre_filter</span><br><span class="line">        self._indices: Optional[Sequence] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'download'</span> <span class="keyword">in</span> self.__class__.__dict__.keys():</span><br><span class="line">            self._download()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'process'</span> <span class="keyword">in</span> self.__class__.__dict__.keys():</span><br><span class="line">            self._process()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wenkangwei/Datawhale-Team-Learning/main/GNN/Task-4-LinkPrediction/InMemoryDataset.png" alt="image.png"></p>
<h3 id="2-2-Practice-InMemoryDataset-Class"><a href="#2-2-Practice-InMemoryDataset-Class" class="headerlink" title="2.2 Practice: InMemoryDataset Class"></a>2.2 <strong>Practice: InMemoryDataset Class</strong></h3><p><strong>由于datawhale里面的参考代码不通用，这里我重新把这个自定义的InMemoryDataset重新写了使它能够加载不同的dataset比如Cora, Citeseer, PudMed等以及 transductive和inductive的版本</strong>, 这个版本的InMemoryDataset 支持：</p>
<ul>
<li>下载不同的dataset</li>
<li>下载transductive或者inductive版本的dataset</li>
<li>可以更改下载数据集源的url</li>
<li>可以自定义要下载哪些文件,直接把要下载的文件名以list的形式输入到raw_file_names即可</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch_geometric.data <span class="keyword">import</span> InMemoryDataset, download_url</span><br><span class="line"><span class="keyword">from</span> torch_geometric.io <span class="keyword">import</span> read_planetoid_data</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDatasetMem</span><span class="params">(InMemoryDataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, root, url =None, raw_file_names= None, dataset_name=<span class="string">"citeseer"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 version=<span class="string">"ind"</span>, transform=None, pre_transform=None)</span>:</span></span><br><span class="line">        <span class="string">r"""Dataset base class for creating graph datasets which fit completely</span></span><br><span class="line"><span class="string">    into CPU memory.</span></span><br><span class="line"><span class="string">    See `here &lt;https://pytorch-geometric.readthedocs.io/en/latest/notes/</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        root (string, optional): Root directory where the dataset should be</span></span><br><span class="line"><span class="string">            saved. (default: :obj:`None`)</span></span><br><span class="line"><span class="string">        transform (callable, optional): A function/transform that takes in an</span></span><br><span class="line"><span class="string">            :obj:`torch_geometric.data.Data` object and returns a transformed</span></span><br><span class="line"><span class="string">            version. The data object will be transformed before every access.</span></span><br><span class="line"><span class="string">            (default: :obj:`None`)</span></span><br><span class="line"><span class="string">        pre_transform (callable, optional): A function/transform that takes in</span></span><br><span class="line"><span class="string">            an :obj:`torch_geometric.data.Data` object and returns a</span></span><br><span class="line"><span class="string">            transformed version. The data object will be transformed before</span></span><br><span class="line"><span class="string">            being saved to disk. (default: :obj:`None`)</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        pre_filter (callable, optional): A function that takes in an</span></span><br><span class="line"><span class="string">            :obj:`torch_geometric.data.Data` object and returns a boolean</span></span><br><span class="line"><span class="string">            value, indicating whether the data object should be included in the</span></span><br><span class="line"><span class="string">            final dataset. (default: :obj:`None`)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    自定义参数:</span></span><br><span class="line"><span class="string">         url:  url to data source website to download dataset</span></span><br><span class="line"><span class="string">         raw_file_names: raw_file_name to download</span></span><br><span class="line"><span class="string">         dataset_name: name of dataset to download, like PudMed, Cora, Citeseer</span></span><br><span class="line"><span class="string">         version:  </span></span><br><span class="line"><span class="string">             "ind": inductive version of dataset (predict on unseen node)</span></span><br><span class="line"><span class="string">             "trans": transductive version of dataset (train and predict on all visited node)</span></span><br><span class="line"><span class="string">         </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">        self.dataset_name = dataset_name</span><br><span class="line">        self.root = root</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> url != <span class="literal">None</span>:</span><br><span class="line">            self.url = url</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.url = <span class="string">"https://github.com/kimiyoung/planetoid/raw/master/data"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> version == <span class="string">"ind"</span> <span class="keyword">or</span> version == <span class="string">"trans"</span>:</span><br><span class="line">            self.version = version</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">f"No such version: <span class="subst">&#123;version&#125;</span>"</span>)</span><br><span class="line">            self.version = <span class="string">""</span></span><br><span class="line">            <span class="keyword">assert</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> raw_file_names!=<span class="literal">None</span>:</span><br><span class="line">            self.raw_files = raw_file_names</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            names = [<span class="string">'x'</span>, <span class="string">'tx'</span>, <span class="string">'allx'</span>, <span class="string">'y'</span>, <span class="string">'ty'</span>, <span class="string">'ally'</span>, <span class="string">'graph'</span>, <span class="string">'test.index'</span>]</span><br><span class="line">            self.raw_files = [<span class="string">f'<span class="subst">&#123;self.version&#125;</span>.<span class="subst">&#123;self.dataset_name.lower()&#125;</span>.<span class="subst">&#123;name&#125;</span>'</span> <span class="keyword">for</span> name <span class="keyword">in</span> names]</span><br><span class="line">        <span class="comment"># call the initialize function from InMemoryDataset to </span></span><br><span class="line">        <span class="comment"># download and process the dataset and save the processed dataset to processed_data.pt file</span></span><br><span class="line">        super(MyDatasetMem, self).__init__(root, transform, pre_transform)</span><br><span class="line">        print(<span class="string">"Processed data path: "</span>,self.processed_paths[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#load the saved processed dataset</span></span><br><span class="line">        self.data, self.slices = torch.load(self.processed_paths[<span class="number">0</span>])</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">raw_dir</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        return directory that stores the raw data files</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> osp.join(self.root, <span class="string">'raw'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">raw_file_names</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">r"""The name of the files to find in the :obj:`self.raw_dir` folder in</span></span><br><span class="line"><span class="string">        order to skip the download."""</span></span><br><span class="line">        <span class="keyword">return</span> self.raw_files</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">processed_file_names</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">r"""The name of the files to find in the :obj:`self.processed_dir`</span></span><br><span class="line"><span class="string">        folder in order to skip the processing."""</span></span><br><span class="line">        <span class="comment"># Note: processed data is stored into torch.pt file</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;self.dataset_name&#125;</span>_processed_data.pt'</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        download data from url based on file names to raw directory</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> self.raw_file_names:</span><br><span class="line">            download_url(<span class="string">'&#123;&#125;/&#123;&#125;'</span>.format(self.url, file), self.raw_dir)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Load dataset from local directory</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        data = read_planetoid_data(self.raw_dir, self.dataset_name.lower())</span><br><span class="line">        data = data <span class="keyword">if</span> self.pre_transform <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> self.pre_transform(data)</span><br><span class="line">        torch.save(self.collate([data]), self.processed_paths[<span class="number">0</span>])</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(data,)</span>:</span></span><br><span class="line">        print(<span class="string">"Number of classes: "</span>,data.num_classes)</span><br><span class="line">        print(<span class="string">"Number of nodes: "</span>,data[<span class="number">0</span>].num_nodes)</span><br><span class="line">        print(<span class="string">"Number of edges: "</span>,data[<span class="number">0</span>].num_edges)</span><br><span class="line">        print(<span class="string">"Number of features: "</span>,data[<span class="number">0</span>].num_features)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">mydataset =MyDatasetMem( root= <span class="string">"./dataset/MyDatasetMed"</span>, url =<span class="literal">None</span>, raw_file_names= <span class="literal">None</span>, dataset_name=<span class="string">"citeseer"</span>,</span><br><span class="line">                 version=<span class="string">"ind"</span>, transform=<span class="literal">None</span>, pre_transform=<span class="literal">None</span>)     </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">info(mydataset)</span><br></pre></td></tr></table></figure>

<pre><code>Processing...
Done!
Processed data path:  dataset/MyDatasetMed/processed/citeseer_processed_data.pt
Number of classes:  6
Number of nodes:  3327
Number of edges:  9104
Number of features:  3703
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mydataset_Cora =MyDatasetMem( root= <span class="string">"./dataset/MyDatasetMed"</span>, url =<span class="literal">None</span>, raw_file_names= <span class="literal">None</span>, dataset_name=<span class="string">"Cora"</span>,</span><br><span class="line">                 version=<span class="string">"ind"</span>, transform=<span class="literal">None</span>, pre_transform=<span class="literal">None</span>)     </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">info(mydataset_Cora)</span><br></pre></td></tr></table></figure>

<pre><code>Processing...
Done!
Processed data path:  dataset/MyDatasetMed/processed/Cora_processed_data.pt
Number of classes:  7
Number of nodes:  2708
Number of edges:  10556
Number of features:  1433
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mydataset_PubMed =MyDatasetMem( root= <span class="string">"./dataset/MyDatasetMed"</span>, url =<span class="literal">None</span>, raw_file_names= <span class="literal">None</span>, dataset_name=<span class="string">"pubmed"</span>,</span><br><span class="line">                 version=<span class="string">"ind"</span>, transform=<span class="literal">None</span>, pre_transform=<span class="literal">None</span>)     </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">info(mydataset_PubMed)</span><br></pre></td></tr></table></figure>

<pre><code>Processing...
Done!
Processed data path:  dataset/MyDatasetMed/processed/pubmed_processed_data.pt
Number of classes:  3
Number of nodes:  19717
Number of edges:  88648
Number of features:  500
</code></pre>
<img src=https://cdn.analyticsvidhya.com/wp-content/uploads/2019/12/lp_1.png>

<h2 id="3-Link-Prediction"><a href="#3-Link-Prediction" class="headerlink" title="3. Link Prediction"></a>3. Link Prediction</h2><p>图数据里面常见的任务包括了node prediction， edge prediction (classification 或者 regression)以及graph prediction等。这里介绍link prediction。 linke prediction 的目标是要判断在图里面的一对节点在未来会不会形成新的连接关系(有向或者无向)。<br>在实际应用场景， link prediction有大量的重要的应用比如：</p>
<ul>
<li>预测用户会不会买商品，买和被卖的关系就是一个有向的link</li>
<li>推荐不同机构里面员工相互合作，这个合作关系也是一个连接edge prediction的任务</li>
<li>提取社交网络里面人与人之间的关系，预测哪些人能够相互喜欢，从而相互推荐也是个link prediction的任务<img src=https://cdn.analyticsvidhya.com/wp-content/uploads/2019/12/lp_10-300x225.png>

</li>
</ul>
<h3 id="Link-prediction在GNN里面的预测原理"><a href="#Link-prediction在GNN里面的预测原理" class="headerlink" title="Link prediction在GNN里面的预测原理"></a>Link prediction在GNN里面的预测原理</h3><p>参考下面一副图， 这个图里面有7个节点, 从A到E。而实线是已经知道的link，而虚线是要预测的link<br><img src=https://cdn.analyticsvidhya.com/wp-content/uploads/2019/12/lp_1.png></p>
<p>以GNN表示Node Embedding时，假设每个node有自己的embedding， dimension= 3， 那么我们有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">node A: [a1, a2, a3]</span><br><span class="line">node B: [b1, b2, b3]</span><br><span class="line">node C: [c1, c2, c3]</span><br><span class="line">node D: [d1, d2, d3]</span><br><span class="line">node E: [e1, e2, e3]</span><br><span class="line">node F: [f1, f2, f3]</span><br><span class="line"></span><br><span class="line">已经知道的edge:</span><br><span class="line">source: [A,B,C,C,A,D]</span><br><span class="line">target: [B,C,E,G,D,F]</span><br></pre></td></tr></table></figure>

<p>那么在GNN里面计算一条undirected link的存在的possibility就是直接计算两个nodes之间的相似度之后把它通过logistics变成概率就可以变成这条link出现的可能性。比如计算节点A和节点B的link的出现的概率:</p>
<p>$$<br>\mathbf{P}(AB) = \sigma(\mathbf{v}_ a \cdot \mathbf{v}_ b)<br>$$</p>
<p>其中 $\mathbf{v}_ a \cdot \mathbf{v}_ b= a1\times b1 + a2\times b2 + a3\times b3$ 是两个节点的embedding的点乘，即相乘后再用sum来reduce，$\sigma$是sigmoid 函数把相似度投映到[0, 1]概率区间，代表这条无向边出现的概率。</p>
<p>除了用GNN这种计算相似度的方法来计算link的概率外，也有像matrix factorization矩阵分解来预测边的值以及计算节点的出现frequency来计算节点与节点之间的关系(Common Neighbors之类的算法)。 可以参考以下的博客:</p>
<ul>
<li><a href="https://medium.com/neo4j/link-prediction-with-neo4j-part-1-an-introduction-713aa779fd9">https://medium.com/neo4j/link-prediction-with-neo4j-part-1-an-introduction-713aa779fd9</a></li>
<li><a href="https://www.analyticsvidhya.com/blog/2020/01/link-prediction-how-to-predict-your-future-connections-on-facebook/">https://www.analyticsvidhya.com/blog/2020/01/link-prediction-how-to-predict-your-future-connections-on-facebook/</a></li>
</ul>
<h2 id="4-Assignment"><a href="#4-Assignment" class="headerlink" title="4. Assignment"></a>4. Assignment</h2><ol>
<li><p>尝试使用PyG中的不同的网络层去代替GCNConv，以及不同的层数和不同的out_channels，来实现节点分类任务。</p>
</li>
<li><p>在边预测任务中，尝试用torch_geometric.nn.Sequential容器构造图神经网络。</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> LeakyReLU, Dropout, BCEWithLogitsLoss, Linear</span><br><span class="line"><span class="keyword">from</span> torch_geometric.datasets <span class="keyword">import</span> Planetoid</span><br><span class="line"><span class="keyword">from</span> torch_geometric <span class="keyword">import</span> transforms <span class="keyword">as</span> T </span><br><span class="line"><span class="keyword">from</span> torch_geometric.utils <span class="keyword">import</span> train_test_split_edges, negative_sampling</span><br><span class="line"><span class="keyword">from</span> torch_geometric.nn <span class="keyword">import</span> GCNConv, GATConv, Sequential</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define Mynet</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyNet</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, in_channels, out_channels,hidden_channels_ls= [<span class="number">128</span>,<span class="number">128</span>], dropout_rate=<span class="number">0.5</span>,random_seed=None)</span>:</span></span><br><span class="line">        super(MyNet, self).__init__()</span><br><span class="line">        torch.manual_seed(random_seed)</span><br><span class="line">        </span><br><span class="line">        hidden_channels_ls = [in_channels] + hidden_channels_ls</span><br><span class="line">        self.conv_ls =[]</span><br><span class="line">        <span class="comment"># Task 1:  使用PyG中的不同的网络层去代替GCNConv，以及不同的层数和不同的out_channels，来实现节点分类任务。</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(hidden_channels_ls)<span class="number">-1</span>):</span><br><span class="line">            hd_in_channel = hidden_channels_ls[i]</span><br><span class="line">            hd_out_channel = hidden_channels_ls[i+<span class="number">1</span>]</span><br><span class="line">            <span class="comment"># input: x and edge_index output: x</span></span><br><span class="line">            self.conv_ls.append( (GATConv(hd_in_channel, hd_out_channel), <span class="string">'x, edge_index -&gt; x'</span>) ) </span><br><span class="line">            self.conv_ls.append( (LeakyReLU(negative_slope=<span class="number">0.5</span>)) ) </span><br><span class="line">            self.conv_ls.append( (Dropout(dropout_rate)) ) </span><br><span class="line">        <span class="comment"># Task 2: 在边预测任务中，尝试用torch_geometric.nn.Sequential容器构造图神经网络。</span></span><br><span class="line">        self.conv_seq = Sequential(<span class="string">'x, edge_index'</span>, self.conv_ls)</span><br><span class="line">        <span class="comment"># classifier</span></span><br><span class="line">        self.dropout = Dropout( dropout_rate)</span><br><span class="line">        self.linear = Linear(hidden_channels_ls[<span class="number">-1</span>], out_channels)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(self, x, edge_index)</span>:</span></span><br><span class="line">        x = self.conv_seq(x, edge_index)</span><br><span class="line">        x = self.dropout(x)</span><br><span class="line">        x = self.linear(x)</span><br><span class="line">        <span class="keyword">return</span>  x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, z, pos_edge_index, neg_edge_index)</span>:</span></span><br><span class="line">        edge_index = torch.cat([pos_edge_index, neg_edge_index], dim=<span class="number">-1</span>)</span><br><span class="line">        <span class="comment"># multiply source and target node embedding and sum up all embedding feature values along column</span></span><br><span class="line">        <span class="comment"># It does dot product operation here to compute similarity between source and target nodes</span></span><br><span class="line">        <span class="keyword">return</span> (z[edge_index[<span class="number">0</span>]] * z[edge_index[<span class="number">1</span>]]).sum(dim=<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_all</span><span class="params">(self, z)</span>:</span></span><br><span class="line">        prob_adj = z @ z.t()</span><br><span class="line">        <span class="keyword">return</span> (prob_adj &gt; <span class="number">0</span>).nonzero(as_tuple=<span class="literal">False</span>).t()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_link_labels</span><span class="params">(pos_edge_index, neg_edge_index)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Concatenate positive edge and sampled negative  edge into a tensor</span></span><br><span class="line"><span class="string">    and mark them as 1 or 0 label</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    num_links = pos_edge_index.size(<span class="number">1</span>) + neg_edge_index.size(<span class="number">1</span>)</span><br><span class="line">    link_labels = torch.zeros(num_links, dtype=torch.float)</span><br><span class="line">    link_labels[:pos_edge_index.size(<span class="number">1</span>)] = <span class="number">1.</span></span><br><span class="line">    <span class="keyword">return</span> link_labels</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(data, model, optimizer, loss_fn,device)</span>:</span></span><br><span class="line">    model.train()</span><br><span class="line"></span><br><span class="line">    neg_edge_index = negative_sampling(</span><br><span class="line">        edge_index=data.train_pos_edge_index,</span><br><span class="line">        num_nodes=data.num_nodes,</span><br><span class="line">        num_neg_samples=data.train_pos_edge_index.size(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    z = model.encode(data.x.to(device), data.train_pos_edge_index.to(device))</span><br><span class="line">    </span><br><span class="line">    link_logits = model.decode(z, data.train_pos_edge_index, neg_edge_index)</span><br><span class="line">    <span class="comment">#print("link shape: ",link_logits.shape)</span></span><br><span class="line">    link_labels = get_link_labels(data.train_pos_edge_index, neg_edge_index).to(data.x.device)</span><br><span class="line">    loss = loss_fn(link_logits, link_labels)</span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@torch.no_grad()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(data, model,device)</span>:</span></span><br><span class="line">    model.eval()</span><br><span class="line"></span><br><span class="line">    z = model.encode(data.x, data.train_pos_edge_index)</span><br><span class="line"></span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> prefix <span class="keyword">in</span> [<span class="string">'val'</span>, <span class="string">'test'</span>]:</span><br><span class="line">        pos_edge_index = data[<span class="string">f'<span class="subst">&#123;prefix&#125;</span>_pos_edge_index'</span>].to(device)</span><br><span class="line">        neg_edge_index = data[<span class="string">f'<span class="subst">&#123;prefix&#125;</span>_neg_edge_index'</span>].to(device)</span><br><span class="line">        <span class="comment"># make prediction on link from model</span></span><br><span class="line">        link_logits = model.decode(z, pos_edge_index, neg_edge_index).to(device)</span><br><span class="line">        <span class="comment"># convert prediction values to possibility</span></span><br><span class="line">        link_probs = link_logits.sigmoid()</span><br><span class="line">        <span class="comment"># compute loss for link</span></span><br><span class="line">        link_labels = get_link_labels(pos_edge_index, neg_edge_index)</span><br><span class="line">        results.append(roc_auc_score(link_labels.cpu(), link_probs.cpu()))</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(dataset)</span>:</span></span><br><span class="line">    <span class="comment"># load self-defined dataset: 这里调用之前学的 自定义的 InMemoryDataset</span></span><br><span class="line">    epochs = <span class="number">300</span></span><br><span class="line">    random_seed = <span class="number">2021</span></span><br><span class="line">    np.random.RandomState(random_seed)</span><br><span class="line">    torch.manual_seed(random_seed)</span><br><span class="line">    </span><br><span class="line">    data = dataset[<span class="number">0</span>]</span><br><span class="line">    data.train_mask = data.val_mask = data.test_mask = data.y = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    device = torch.device(<span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line">    print(<span class="string">f"Using device: <span class="subst">&#123;device&#125;</span>"</span>)</span><br><span class="line">    print()</span><br><span class="line">    data = train_test_split_edges(data,val_ratio = <span class="number">0.05</span>, test_ratio = <span class="number">0.1</span>)</span><br><span class="line">    print(<span class="string">"Data info:"</span>)</span><br><span class="line">    print(data)</span><br><span class="line">    data.to(device)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># define loss, optimizer and model: 这里调用选取要用的loss，模型，优化器等配置</span></span><br><span class="line">    model = MyNet( in_channels = data.num_features, out_channels = <span class="number">64</span>,</span><br><span class="line">                  hidden_channels_ls= [<span class="number">128</span>,<span class="number">128</span>], dropout_rate=<span class="number">0.5</span>, random_seed= random_seed).to(device)</span><br><span class="line">    </span><br><span class="line">    loss_fn = BCEWithLogitsLoss()</span><br><span class="line">    optimizer = torch.optim.Adam(model.parameters(), lr = <span class="number">1e-2</span>)</span><br><span class="line">    <span class="comment"># train model： 模型训练</span></span><br><span class="line">    best_val_auc = test_auc = <span class="number">0</span></span><br><span class="line">    loss_ls = [<span class="number">0</span>]</span><br><span class="line">    val_auc_ls = [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">1</span>, epochs+<span class="number">1</span>):</span><br><span class="line">        loss = train(data, model, optimizer, loss_fn, device)</span><br><span class="line">        loss_ls.append(loss.detach().item())</span><br><span class="line">        <span class="comment"># validation and test </span></span><br><span class="line">        val_auc, tmp_test_auc = test(data, model,device)</span><br><span class="line">        <span class="comment">#val_auc =val_auc.detach()</span></span><br><span class="line">        <span class="comment">#tmp_test_auc = tmp_test_auc.detach()</span></span><br><span class="line">        val_auc_ls.append(val_auc)</span><br><span class="line">        <span class="keyword">if</span> best_val_auc &lt; val_auc:</span><br><span class="line">            best_val_auc = val_auc</span><br><span class="line">            test_auc = tmp_test_auc</span><br><span class="line">        <span class="keyword">if</span> epoch%<span class="number">20</span> ==<span class="number">0</span>:</span><br><span class="line">            print(<span class="string">f'Epoch: <span class="subst">&#123;epoch:<span class="number">03</span>d&#125;</span>, Loss: <span class="subst">&#123;loss:<span class="number">.4</span>f&#125;</span>, Val: <span class="subst">&#123;val_auc:<span class="number">.4</span>f&#125;</span>, '</span></span><br><span class="line">              <span class="string">f'Test: <span class="subst">&#123;test_auc:<span class="number">.4</span>f&#125;</span>'</span>)</span><br><span class="line">        </span><br><span class="line">            </span><br><span class="line">    <span class="comment"># Make final prediction on all links</span></span><br><span class="line">    z = model.encode(data.x, data.train_pos_edge_index)</span><br><span class="line">    final_edge_index = model.decode_all(z)</span><br><span class="line">    </span><br><span class="line">    torch.cuda.empty_cache()</span><br><span class="line">    t =[<span class="number">0</span>] + [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(epochs)]</span><br><span class="line">    </span><br><span class="line">    fig, ax = plt.subplots(<span class="number">2</span>, figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line">    sns.lineplot(t, loss_ls, ax= ax[<span class="number">0</span>])</span><br><span class="line">    sns.lineplot(t, val_auc_ls, ax= ax[<span class="number">1</span>])</span><br><span class="line">    ax[<span class="number">0</span>].set_xlabel(<span class="string">"epochs"</span>)</span><br><span class="line">    ax[<span class="number">1</span>].set_xlabel(<span class="string">"epochs"</span>)</span><br><span class="line">    ax[<span class="number">0</span>].set_ylabel(<span class="string">"loss"</span>)</span><br><span class="line">    ax[<span class="number">1</span>].set_ylabel(<span class="string">"AUC"</span>)</span><br><span class="line">    ax[<span class="number">0</span>].set_title(<span class="string">"BCELoss"</span>)</span><br><span class="line">    ax[<span class="number">1</span>].set_title(<span class="string">"Validation AUC"</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mydataset =MyDatasetMem( root= <span class="string">"./dataset/MyDatasetMed"</span>, url =<span class="literal">None</span>, raw_file_names= <span class="literal">None</span>, dataset_name=<span class="string">"citeseer"</span>,</span><br><span class="line">                 version=<span class="string">"ind"</span>, transform=T.NormalizeFeatures())</span><br></pre></td></tr></table></figure>

<pre><code>Processed data path:  dataset/MyDatasetMed/processed/processed_data.pt
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main(mydataset)</span><br></pre></td></tr></table></figure>

<pre><code>Using device: cuda

Data info:
Data(test_neg_edge_index=[2, 455], test_pos_edge_index=[2, 455], train_neg_adj_mask=[3327, 3327], train_pos_edge_index=[2, 7740], val_neg_edge_index=[2, 227], val_pos_edge_index=[2, 227], x=[3327, 3703])
Epoch: 020, Loss: 0.6077, Val: 0.7825, Test: 0.7407
Epoch: 040, Loss: 0.5646, Val: 0.7975, Test: 0.7761
Epoch: 060, Loss: 0.5200, Val: 0.8195, Test: 0.8342
Epoch: 080, Loss: 0.5082, Val: 0.8164, Test: 0.8379
Epoch: 100, Loss: 0.5093, Val: 0.8038, Test: 0.8379
Epoch: 120, Loss: 0.5089, Val: 0.8023, Test: 0.8379
Epoch: 140, Loss: 0.5087, Val: 0.7941, Test: 0.8379
Epoch: 160, Loss: 0.4914, Val: 0.8296, Test: 0.8425
Epoch: 180, Loss: 0.4879, Val: 0.8310, Test: 0.8361
Epoch: 200, Loss: 0.4980, Val: 0.8348, Test: 0.8297
Epoch: 220, Loss: 0.4865, Val: 0.8287, Test: 0.8265
Epoch: 240, Loss: 0.4870, Val: 0.8295, Test: 0.8265
Epoch: 260, Loss: 0.4869, Val: 0.8362, Test: 0.8459
Epoch: 280, Loss: 0.4825, Val: 0.8473, Test: 0.8488
Epoch: 300, Loss: 0.4821, Val: 0.8434, Test: 0.8483
</code></pre>
<p><img src="https://raw.githubusercontent.com/wenkangwei/Datawhale-Team-Learning/main/GNN/Task-4-LinkPrediction/output_9_2.png" alt="png"></p>
<ol start="3">
<li>如下方代码所示，我们以data.train_pos_edge_index为实际参数来进行训练集负样本采样，但这样采样得到的负样本可能包含一些验证集的正样本与测试集的正样本，即可能将真实的正样本标记为负样本，由此会产生冲突。但我们还是这么做，这是为什么？</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">neg_edge_index = negative_sampling(</span><br><span class="line">    edge_index=data.train_pos_edge_index,</span><br><span class="line">    num_nodes=data.num_nodes,</span><br><span class="line">    num_neg_samples=data.train_pos_edge_index.size(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p>这里的原因有可能是因为在negative_sampling里面设置的force_undirect 默认是False,即采样的边是有向的，但是我们输入的采样的边是无向的，这样在negative sampling时把正样本(已经知道的边)也采样进去可以考虑一条边的不同方向。</p>
<h2 id="5-Reference"><a href="#5-Reference" class="headerlink" title="5. Reference"></a>5. Reference</h2><p>[1] Datawhale <a href="https://github.com/datawhalechina/team-learning-nlp/blob/master/GNN/Markdown%E7%89%88%E6%9C%AC/6-2-%E8%8A%82%E7%82%B9%E9%A2%84%E6%B5%8B%E4%B8%8E%E8%BE%B9%E9%A2%84%E6%B5%8B%E4%BB%BB%E5%8A%A1%E5%AE%9E%E8%B7%B5.md">https://github.com/datawhalechina/team-learning-nlp/blob/master/GNN/Markdown%E7%89%88%E6%9C%AC/6-2-%E8%8A%82%E7%82%B9%E9%A2%84%E6%B5%8B%E4%B8%8E%E8%BE%B9%E9%A2%84%E6%B5%8B%E4%BB%BB%E5%8A%A1%E5%AE%9E%E8%B7%B5.md</a><br>[2] PyG 源码: <a href="https://github.com/rusty1s/pytorch_geometric/blob/master/examples/link_pred.py">https://github.com/rusty1s/pytorch_geometric/blob/master/examples/link_pred.py</a></p>
<p>[3] <a href="https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html">https://pytorch-geometric.readthedocs.io/en/latest/modules/nn.html</a><br>[4] <a href="https://medium.com/neo4j/link-prediction-with-neo4j-part-1-an-introduction-713aa779fd9">https://medium.com/neo4j/link-prediction-with-neo4j-part-1-an-introduction-713aa779fd9</a><br>[5] <a href="https://www.analyticsvidhya.com/blog/2020/01/link-prediction-how-to-predict-your-future-connections-on-facebook/">https://www.analyticsvidhya.com/blog/2020/01/link-prediction-how-to-predict-your-future-connections-on-facebook/</a></p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/GNN/">GNN</a><a class="link-muted mr-2" rel="tag" href="/tags/Graph/">Graph</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://ppoffice.github.io/hexo-theme-icarus-categorites-Plugins/Share/" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/07/01/GNN-5-ClusterGCN/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">GNN-5-ClusterGCN</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/06/23/GNN-3-NodeEmbedding/"><span class="level-item">GNN-3-NodeEmbedding</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "kvXCKmDNxnA2486N29e5cP7i-MdYXbMMI",
            appKey: "0Lv5b0SqotzkGHQvD64u4AKo",
            
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "en",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://github.com/wenkangwei" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Data-Collection/"><span class="level-start"><span class="level-item">Data Collection</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Data-Structure/"><span class="level-start"><span class="level-item">Data Structure</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Data-Structure/Sorting/"><span class="level-start"><span class="level-item">Sorting</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Deep-Learning/"><span class="level-start"><span class="level-item">Deep Learning</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Exploratory-Data-Analysis/"><span class="level-start"><span class="level-item">Exploratory Data Analysis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Icarus/"><span class="level-start"><span class="level-item">Icarus</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Icarus/Hexo/"><span class="level-start"><span class="level-item">Hexo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Icarus/Hexo/Website/"><span class="level-start"><span class="level-item">Website</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Machine-Learning/Accuracy-Improvement/"><span class="level-start"><span class="level-item">Accuracy Improvement</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/NLP/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Parallel-Computing/"><span class="level-start"><span class="level-item">Parallel Computing</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/PySpark/"><span class="level-start"><span class="level-item">PySpark</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/PySpark/Hadoop/"><span class="level-start"><span class="level-item">Hadoop</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Recommendation-System/"><span class="level-start"><span class="level-item">Recommendation System</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Report/"><span class="level-start"><span class="level-item">Report</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/SQL/"><span class="level-start"><span class="level-item">SQL</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Searching/"><span class="level-start"><span class="level-item">Searching</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Searching/Data-Strucure/"><span class="level-start"><span class="level-item">Data Strucure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Statistic/"><span class="level-start"><span class="level-item">Statistic</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Website/"><span class="level-start"><span class="level-item">Website</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Website/ICarus/"><span class="level-start"><span class="level-item">ICarus</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Website/ICarus/Hexo/"><span class="level-start"><span class="level-item">Hexo</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Amdahl-s-Law/"><span class="tag">Amdahl&#039;s Law</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Backpropagation/"><span class="tag">Backpropagation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bagging/"><span class="tag">Bagging</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BeautifulSoup/"><span class="tag">BeautifulSoup</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Binary-Tree/"><span class="tag">Binary Tree</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blending/"><span class="tag">Blending</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Boosting/"><span class="tag">Boosting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Boosting-Machine/"><span class="tag">Boosting Machine</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BuckSort/"><span class="tag">BuckSort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Collaborative-Filtering/"><span class="tag">Collaborative Filtering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Confusion-Metric/"><span class="tag">Confusion Metric</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Convolution-Neural-Network/"><span class="tag">Convolution Neural Network</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cross-Validation/"><span class="tag">Cross Validation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/D3-js/"><span class="tag">D3.js</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DCN/"><span class="tag">DCN</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DIN/"><span class="tag">DIN</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Analysis/"><span class="tag">Data Analysis</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Mining/"><span class="tag">Data Mining</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Visualization/"><span class="tag">Data Visualization</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Datawhale-Team-Learning/"><span class="tag">Datawhale Team Learning</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DeepFM/"><span class="tag">DeepFM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dropout/"><span class="tag">Dropout</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/EGES/"><span class="tag">EGES</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ensemble-Learning/"><span class="tag">Ensemble Learning</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FFM-Model/"><span class="tag">FFM Model</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GATE/"><span class="tag">GATE</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GNN/"><span class="tag">GNN</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph/"><span class="tag">Graph</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph-Embedding/"><span class="tag">Graph Embedding</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Holdout/"><span class="tag">Holdout</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hypothesis-Test/"><span class="tag">Hypothesis Test</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Independence-Test/"><span class="tag">Independence Test</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Installation/"><span class="tag">Installation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K-Mean-Clustering/"><span class="tag">K-Mean Clustering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/KMean-Clustering/"><span class="tag">KMean Clustering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LGBM/"><span class="tag">LGBM</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Machine-Learning/"><span class="tag">Machine Learning</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Markdown/"><span class="tag">Markdown</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Model-Evaluation/"><span class="tag">Model Evaluation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Model-Selection/"><span class="tag">Model Selection</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Natural-Language-Representations/"><span class="tag">Natural Language Representations</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nature-Language-Processing/"><span class="tag">Nature Language Processing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Negative-Sampling/"><span class="tag">Negative Sampling</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NeuralFM/"><span class="tag">NeuralFM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/P-value/"><span class="tag">P-value</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Parallel-Computing/"><span class="tag">Parallel Computing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Parallel-Speedup/"><span class="tag">Parallel Speedup</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PySpark/"><span class="tag">PySpark</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROC-curve/"><span class="tag">ROC curve</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Recommendation-System/"><span class="tag">Recommendation System</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regression/"><span class="tag">Regression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regular-Expression/"><span class="tag">Regular Expression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scala/"><span class="tag">Scala</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shell-Tutorial/"><span class="tag">Shell Tutorial</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sorting/"><span class="tag">Sorting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark/"><span class="tag">Spark</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Stacking/"><span class="tag">Stacking</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swing/"><span class="tag">Swing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Traversal/"><span class="tag">Traversal</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tutorial/"><span class="tag">Tutorial</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unsupervised-Learning/"><span class="tag">Unsupervised Learning</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Variable-Selection/"><span class="tag">Variable Selection</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WSDM/"><span class="tag">WSDM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web-Scrapping/"><span class="tag">Web Scrapping</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Wide-and-Deep/"><span class="tag">Wide and Deep</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Wide-and-Deep-Model/"><span class="tag">Wide and Deep Model</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Wide-Deep-Model/"><span class="tag">Wide&amp;Deep Model</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Word-Embedding/"><span class="tag">Word Embedding</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Word-vector/"><span class="tag">Word vector</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/binary-search/"><span class="tag">binary search</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bubble-sort/"><span class="tag">bubble sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/commands/"><span class="tag">commands</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/insertion-sort/"><span class="tag">insertion sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/merge-sort/"><span class="tag">merge sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/non-parametric-learning/"><span class="tag">non-parametric learning</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/quick-sort/"><span class="tag">quick sort</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/review/"><span class="tag">review</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/statistic-analytics-tool/"><span class="tag">statistic analytics tool</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-12-26T17:19:40.000Z">2021-12-26</time></p><p class="title is-6"><a class="link-muted" href="/2021/12/27/Scala-1-BasicGrammar/">Scala-1-BasicGrammar</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Scala/">Scala</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-11-14T04:31:03.000Z">2021-11-13</time></p><p class="title is-6"><a class="link-muted" href="/2021/11/14/PySpark-Note-SparkSubmit/">PySpark-Note-SparkSubmit</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/PySpark/">PySpark</a> / <a class="link-muted" href="/categories/PySpark/Hadoop/">Hadoop</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-10-06T00:15:17.000Z">2021-10-05</time></p><p class="title is-6"><a class="link-muted" href="/2021/10/06/Data-Analysis-1-Visualization/">Data-Analysis-1-Visualization</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Exploratory-Data-Analysis/">Exploratory Data Analysis</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-09-23T03:54:49.000Z">2021-09-22</time></p><p class="title is-6"><a class="link-muted" href="/2021/09/23/Shell-Tutorial/">Shell-Tutorial</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Shell/">Shell</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-09-13T03:23:51.000Z">2021-09-12</time></p><p class="title is-6"><a class="link-muted" href="/2021/09/13/Recommendation-System-9-Swing/">Recommendation-System-9-Swing</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Recommendation-System/">Recommendation System</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/10/"><span class="level-start"><span class="level-item">October 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe to Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avatar.jpg" alt="Wenkang Wei"></figure><p class="title is-size-4 is-block line-height-inherit">Wenkang Wei</p><p class="is-size-6 is-block">computer engineering| machine learning</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Clemson,SC</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">60</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">29</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">80</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/wenkangwei" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/wenkangwei"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/wenkang-wei-588811167"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex" href="#GNN-Task-4-GraphDataset-and-LinkPrediction"><span class="mr-2">1</span><span>GNN-Task-4 GraphDataset and LinkPrediction</span></a><ul class="menu-list"><li><a class="is-flex" href="#1-Introduction"><span class="mr-2">1.1</span><span>1. Introduction</span></a></li><li><a class="is-flex" href="#2-self-defined-PyG-Dataset"><span class="mr-2">1.2</span><span>2. self-defined PyG Dataset</span></a><ul class="menu-list"><li><a class="is-flex" href="#2-1-Introduction-to-InMemoryDataset"><span class="mr-2">1.2.1</span><span>2.1 Introduction to InMemoryDataset</span></a></li><li><a class="is-flex" href="#2-2-Practice-InMemoryDataset-Class"><span class="mr-2">1.2.2</span><span>2.2 Practice: InMemoryDataset Class</span></a></li></ul></li><li><a class="is-flex" href="#3-Link-Prediction"><span class="mr-2">1.3</span><span>3. Link Prediction</span></a><ul class="menu-list"><li><a class="is-flex" href="#Link-prediction在GNN里面的预测原理"><span class="mr-2">1.3.1</span><span>Link prediction在GNN里面的预测原理</span></a></li></ul></li><li><a class="is-flex" href="#4-Assignment"><span class="mr-2">1.4</span><span>4. Assignment</span></a></li><li><a class="is-flex" href="#5-Reference"><span class="mr-2">1.5</span><span>5. Reference</span></a></li></ul></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/icon.png" alt="Wenkang&#039;s Blog" height="28"></a><p class="size-small"><span>&copy; 2021 Wenkang Wei</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://github.com/wenkangwei/wenkangwei.github.io`',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://s9.cnzz.com/z_stat.php?id=1280124407&amp;web_id=1280124407" async></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>